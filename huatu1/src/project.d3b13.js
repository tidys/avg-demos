window.__require=function e(t,i,n){function o(c,s){if(!i[c]){if(!t[c]){var r=c.split("/");if(r=r[r.length-1],!t[r]){var l="function"==typeof __require&&__require;if(!s&&l)return l(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+c+"'")}c=r}var d=i[c]={exports:{}};t[c][0].call(d.exports,function(e){return o(t[c][1][e]||e)},d,d.exports,e,t,i,n)}return i[c].exports}for(var a="function"==typeof __require&&__require,c=0;c<n.length;c++)o(n[c]);return o}({AVGPrefabPreload:[function(e,t,i){"use strict";cc._RF.push(t,"715b77R35dCzquGiAduS4J+","AVGPrefabPreload"),t.exports={prefabs:{QTENode:{url:"prefab/qte/QTENode",prefab:null},QTEProgress:{url:"prefab/qte/QTEProgress",prefab:null},QTEMask:{url:"prefab/qte/QTEMask",prefab:null},Loading:{url:"loading/Loading",prefab:null},BagItemList:{url:"prefab/bag/BagItemList",prefab:null},BagItemDetails:{url:"prefab/bag/BagItemDetails",prefab:null},BagGetItems:{url:"prefab/bag/BagGetItems",prefab:null},BagGoodsItem:{url:"prefab/bag/GoodsItem",prefab:null},BagEditorTips:{url:"prefab/bag/TipsNode",prefab:null},ResMissingTexture:{url:"resMissing",prefab:null},PhoneIM:{url:"prefab/phoneIM/PhoneIM",prefab:null},PhoneMessage:{url:"prefab/phoneIM/MessageItem",prefab:null}},preloadGamePrefabs:function(e){var t=this,i=Object.keys(this.prefabs).length,n=0,o=function(o){var a=t.prefabs[o],c=a.url;cc.log("\u9884\u52a0\u8f7dprefab: ".concat(c)),cc.loader.loadRes(c,function(t,o){t&&cc.warn(t),a.prefab=o,++n>=i&&e&&e()})};for(var a in this.prefabs)o(a)}},cc._RF.pop()},{}],Account:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}cc._RF.push(t,"715beEJ1FNK1pIpg/J0hSHt","Account");var c=e("ValueMerge"),s=e("Archive"),r=function(){function e(t){n(this,e),this.id=t,this.plotSkipArray={},this.globalValues={},this.curUseArchiveID=null,this.archives={},this.globalValues=c.MergeGlobalData(null)}return a(e,[{key:"init",value:function(e){var t=!1;this.plotSkipArray=e.plotSkipArray,this.globalValues=c.MergeGlobalData(e.globalValues);var i=e.archives;if(i)for(var n in i){var o=new s(n);o.init(i[n])&&(t=!0),this.archives[n]=o}return t}}]),e}();t.exports=r,cc._RF.pop()},{Archive:"Archive",ValueMerge:"ValueMerge"}],ActionSpeed:[function(e,t,i){"use strict";cc._RF.push(t,"4cdd69ceUpCxZhM0H6hQbHJ","ActionSpeed"),cc._RF.pop()},{}],Animation:[function(e,t,i){"use strict";cc._RF.push(t,"d0adaNFRYFCzoEDqsv3eUKo","Animation");var n=AvgData.ActionType,o=AvgData.AvgType,a=AvgData.Type.Shake,c=e("AudioMgr");e("GameUtil");cc.Class({extends:cc.Component,properties:{action:{default:n.None.type,displayName:"\u52a8\u4f5c"},delayTime:{default:0,displayName:"\u5ef6\u8fdf\u65f6\u95f4"},actionTime:{default:0,displayName:"\u52a8\u753b\u65f6\u957f"},shakeStrength:{default:a.low.type,displayName:"\u9707\u52a8\u5f3a\u5ea6"},blinkCount:{default:1,displayName:"\u95ea\u70c1\u6b21\u6570"},scaleSize1:{default:1,displayName:"\u7f29\u653e\u6bd4\u4f8b"},scaleSize2:{default:1,displayName:"\u7f29\u653e\u6bd4\u4f8b"},moveBegan:{default:cc.v2(0,0),displayName:"\u5f00\u59cb\u5750\u6807"},moveEnd:{default:cc.v2(0,0),displayName:"\u7ed3\u675f\u5750\u6807"},_recordData:null,actionData:null,timeLineData:null},_record:function(){this._recordData={x:this.node.x,y:this.node.y,active:this.node.active,scaleX:this.node.scaleX,scaleY:this.node.scaleY}},_recover:function(){this.node.stopAllActions(),this._recordData&&(this.node.x=this._recordData.x,this.node.y=this._recordData.y,this.node.active=this._recordData.active,this.node.scaleX=this._recordData.scaleX,this.node.scaleY=this._recordData.scaleY)},onLoad:function(){},onAniAdd:function(){var e=this.action;if(e===n.Move.type);else if(e===n.Scale.type);else if(e===n.Shake.type);else if(e===n.FadeOut.type);else if(e===n.FadeIn.type)if(this.node.avgSyncData.type===o.VideoPlot.type){var t=this.node.getComponent("MoviePlayer");t&&t.initOpacityFadeIn()}else if(this.node.avgSyncData.type===o.QTE.type){var i=this.node.getComponent("QTE");i&&i.hideQTE()}else this.node.opacity=0;else n.None.type},setTimeLineData:function(e){this.timelineData=e},setActionData:function(e){this.actionData=e;var t=e.action;if(t){var i=this.action=t.type;this.actionTime=t.time||0,i===n.Move.type?(this.moveBegan=cc.v2(t.x1||0,t.y1||0),this.moveEnd=cc.v2(t.x2||0,t.y2||0)):i===n.Scale.type?(this.scaleSize1=t.scaleFrom/100,this.scaleSize2=t.scaleTo/100):i===n.Shake.type?this.shakeStrength=t.strength:i===n.FadeOut.type||i===n.FadeIn.type||n.None.type}},onDestroy:function(){if(this.action===n.FadeOut.type){var e=cc.delayTime(this.delayTime),t=cc.fadeOut(this.actionTime),i=cc.callFunc(this._actionOver.bind(this)),o=cc.sequence([e,t,i]);this.node.stopAllActions(),this.node.runAction(o)}},_actionOver:function(){var e=this._getActionName(this.action);cc.log("\u6267\u884c\u52a8\u4f5c\u7ed3\u675f:".concat(e))},getCurActionName:function(){return this._getActionName(this.action)},_getActionName:function(e){return e===n.FadeIn.type?n.FadeIn.name:e===n.FadeOut.type?n.FadeOut.name:e===n.Shake.type?n.Shake.name:e===n.Scale.type?n.Scale.name:e===n.Move.type?n.Move.name:e===AvgData.Type.ActionAudioType.Play.type?AvgData.Type.ActionAudioType.Play.name:n.None.name},genAction:function(){var e=this,t=this.actionData.action.delay||0,i=null,a=!1,s=this.node.avgSyncData.type;if(s===o.AudioBg.type||s===o.AudioEffect.type||s===o.AudioAside.type){var r=this._genAudioAction(this.action);i=r.action,a=r.isBreak}else if(s===o.AudioBgStopGlobal.type)i=cc.callFunc(function(){c.stopGlobalBgMusic()});else if(s===o.Effect.type);else if(s===o.VideoPlot.type)if(this.action===AvgData.Type.ActionVideoType.Play.type){a=!0;var l=this.actionData.action,d=(l.loop,l.volume),u=(l.time,l.isFullPlay),h=(this.node.avgSyncData,this.node.getComponent("MoviePlayer"));i=cc.callFunc(function(){h&&(h.setVolume(d),h.adjustVideo(),h.setPlayFinishCallBack(function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPieceAnimationSpawnNext,e.node.uuid)}),setTimeout(function(){console.log("\u64ad\u653e [\u89c6\u9891\u64ad\u653e] \u52a8\u753b"),u?h.playMovieFull(l):h.playMovieFragment(l)},20))})}else if(this.action===AvgData.Type.ActionVideoType.FadeIn.type||this.action===AvgData.Type.ActionVideoType.FadeOut.type){var g=this.node.getComponent("MoviePlayer");g&&g.runOpacityAction(this.action,this.actionTime,t),i=cc.delayTime(this.actionTime)}else i=this._genElementAction(this.action);else s===o.QTE.type?this.action===n.FadeIn.type&&(a=!0,i=this._genElementAction(this.action)):i=this.actionTime>0?this._genElementAction(this.action):cc.delayTime(0);return i&&(i=cc.sequence([cc.delayTime(t),i])),{isBreak:a,action:i}},_genAudioEffectAction:function(e,t,i){return cc.callFunc(function(){c.playEffect(e,t,i)})},_audioPlayCycleEnd:function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPieceAnimationSpawnNext,this.node.uuid)},_genAudioAction:function(t){var i=!1,n=AvgData.AvgType,o=this.actionData.action,a=o.loop,s=(o.volume,o.time,this.node.avgSyncData),r=e("Assets").getUrlByUUID(s.src),l=s.type,d=null;l===n.AudioBg.type?s.globalPlay?d=cc.callFunc(function(){c.bgAudioSrc!==r&&c.playMusic(r,o)}):a?(i=!1,d=this._genAudioEffectAction(r,o)):(i=!0,d=this._genAudioEffectAction(r,o,{endCB:this._audioPlayCycleEnd.bind(this)})):l===n.AudioEffect.type?a?(i=!1,d=this._genAudioEffectAction(r,o)):(i=!0,d=this._genAudioEffectAction(r,o,{endCB:this._audioPlayCycleEnd.bind(this)})):l===n.AudioAside.type&&(a?(i=!1,d=this._genAudioEffectAction(r,o)):(i=!0,d=this._genAudioEffectAction(r,o,{endCB:this._audioPlayCycleEnd.bind(this)})));return AvgData.Type.ActionAudioType.Play.type,{isBreak:i,action:d}},_genElementAction:function(e){var t=this,i=null;if(e===n.FadeOut.type)this.node.opacity=255,i=cc.fadeOut(this.actionTime);else if(e===n.FadeIn.type)this.node.opacity=0,i=cc.fadeIn(this.actionTime);else if(e===n.FadeOut.type)i=cc.fadeOut(this.actionTime);else if(e===n.Shake.type){for(var o=[],c=[{strength:a.lower.type,count:3,max:10},{strength:a.low.type,count:5,max:12},{strength:a.normal.type,count:7,max:15},{strength:a.high.type,count:9,max:20},{strength:a.higher.type,count:11,max:25}],s=0,r=0,l=0;l<c.length;l++){var d=c[l];if(d.strength===this.shakeStrength){s=d.count,r=d.max;break}}s=Math.floor(this.actionTime/.05);var u=this.node.getPosition();if(s>0&&r>0){for(var h=0;h<s;h++){var g=u.x+this._randomPos(r),p=u.y+this._randomPos(r),f=cc.moveTo(.05,cc.v2(g,p));o.push(f)}this._record(),o.push(cc.callFunc(function(){t._recover()})),i=cc.sequence(o)}else cc.log("\u672a\u67e5\u627e\u5230\u6643\u52a8\u7684\u914d\u7f6e!")}else e===n.Scale.type?(this.node.setScale(this.scaleSize1),i=cc.scaleTo(this.actionTime,this.scaleSize2)):e===n.Move.type&&(this.node.setPosition(this.moveBegan),i=cc.moveTo(this.actionTime,this.moveEnd));return i},_randomByMaxValue:function(e){return Math.floor(Math.random()*e)},_randomPos:function(e){return this._randomByMaxValue(2)%2==0?this._randomByMaxValue(e):-this._randomByMaxValue(e)}}),cc._RF.pop()},{Assets:"Assets",AudioMgr:"AudioMgr",GameUtil:"GameUtil"}],Archive:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}cc._RF.push(t,"49d0cEBooNJq7z1fLYPeDk7","Archive");var c=e("ValueMerge"),s=function(){function e(t){n(this,e),this.id=t,this.name="",this.time="",this.progress="",this.normalValues={},this.bag={},this.normalValues=c.MergeNormalData(null),this._initBag()}return a(e,[{key:"_getCfgGoods",value:function(){return cc.StoryConfig.file.goods.data.goods}},{key:"_initBag",value:function(){var e=this,t=this._getCfgGoods();t&&t.forEach(function(t){if(t.ownByDefault){var i=AvgData.genUUID();e.bag[i]={id:i,uuid:t.uuid,num:t.ownByDefaultCount}}})}},{key:"init",value:function(e){return this.name=e.name,this.time=e.time,this.progress=e.progress,this.normalValues=c.MergeNormalData(e.normalValues),this._mergeBagData(e.bag)}},{key:"_findItemCfgByUUID",value:function(e){for(var t=this._getCfgGoods(),i=0;i<t.length;i++){var n=t[i];if(n.uuid===e)return n}return null}},{key:"_replaceBagItemID",value:function(e){var t=e.id;this._deleteBagGoodsByUUID(e.uuid),this.bag[t]=e}},{key:"_deleteBagGoodsByUUID",value:function(e){for(var t in this.bag){this.bag[t].uuid===e&&delete this.bag[t]}}},{key:"_mergeBagData",value:function(e){var t=!1;for(var i in e){var n=e[i];this._findItemCfgByUUID(n.uuid)?this._replaceBagItemID(n):(cc.log("\u5220\u9664\u5df2\u7ecf\u5931\u6548\u7684\u7269\u54c1:".concat(n.uuid)),this._deleteBagGoodsByUUID(n.uuid),t=!0)}return t}}]),e}();t.exports=s,cc._RF.pop()},{ValueMerge:"ValueMerge"}],ArrowNode:[function(e,t,i){"use strict";cc._RF.push(t,"446d0kpMuhHLYyceaN7x+L5","ArrowNode");var n=AvgData.Type.QTEEmitType;cc.Class({extends:cc.Component,properties:{arrow:cc.Animation,direction:null},start:function(){},onPause:function(e){e?(this.arrow.pause(),cc.director.getScheduler().pauseTarget(this),this.node.pauseAllActions()):(this.arrow.resume(),cc.director.getScheduler().resumeTarget(this),this.node.resumeAllActions())},setArrowDirection:function(e){this.direction=e,this.arrow.node.opacity=255,this.arrow.node.scaleX=1,this.arrow.stop(),this.unschedule(this._repeatSchedule),n.SlideLeft.type===e?(this.node.scaleX=-1,this.node.angle=0):n.SlideRight.type===e?(this.node.scaleX=1,this.node.angle=0):n.SlideUp.type===e?(this.node.scaleX=1,this.node.angle=90):n.SlideDown.type===e?(this.node.scaleX=1,this.node.angle=-90):n.SlideLeftRight.type===e?(this.node.scaleX=1,this.node.angle=0):n.SlideUpDown.type===e&&(this.node.scaleX=1,this.node.angle=90),AVG_EDITOR||this._startAnimation(e)},_startAnimation:function(e){var t=this.arrow.defaultClip.duration;n.SlideLeft.type===e?(this.node.scaleX=-1,this.node.angle=0,this.arrow.defaultClip.wrapMode=cc.WrapMode.Loop,this.arrow.play()):n.SlideRight.type===e?(this.node.scaleX=1,this.node.angle=0,this.arrow.defaultClip.wrapMode=cc.WrapMode.Loop,this.arrow.play()):n.SlideUp.type===e?(this.node.scaleX=1,this.node.angle=90,this.arrow.defaultClip.wrapMode=cc.WrapMode.Loop,this.arrow.play()):n.SlideDown.type===e?(this.node.scaleX=1,this.node.angle=-90,this.arrow.defaultClip.wrapMode=cc.WrapMode.Loop,this.arrow.play()):n.SlideLeftRight.type===e?(this.node.scaleX=1,this.node.angle=0,this.arrow.play(),this.schedule(this._repeatSchedule,t)):n.SlideUpDown.type===e&&(this.node.scaleX=1,this.node.angle=90,this.arrow.play(),this.schedule(this._repeatSchedule,t))},runPreviewArrow:function(){var e=this,t=this.direction;this.setArrowDirection(t),this._startAnimation(t);var i=this.arrow.defaultClip.duration,o=null;n.SlideLeft.type===t?o=2*i:n.SlideRight.type===t?o=2*i:n.SlideUp.type===t?o=2*i:n.SlideDown.type===t?o=2*i:n.SlideLeftRight.type===t?o=2*i*2:n.SlideUpDown.type===t&&(o=2*i*2),this.node.stopAllActions(),o&&this.node.runAction(cc.sequence(cc.delayTime(o),cc.callFunc(function(){e.stopPreview()})))},stopPreview:function(){this.setArrowDirection(this.direction)},_repeatSchedule:function(){this.arrow.node.scaleX=0,this.node.scaleX=-this.node.scaleX,this.arrow.play()},playResultAni:function(e,t){this.arrow.stop();if(this.unschedule(this._repeatSchedule),e){this.arrow.node.stopAllActions();var i=this.arrow.node.scaleX>0?2:-2,n=cc.scaleTo(.5,i,this.node.scaleY+.3).easing(cc.easeOut(3));this.arrow.node.runAction(cc.sequence(n,cc.delayTime(.5),cc.callFunc(function(){t&&t()})))}else{var o=cc.moveBy(.5,cc.v2(this.node.x,this.node.y-300)).easing(cc.easeIn(3)),a=cc.spawn([o,cc.fadeOut(.5)]);this.node.runAction(cc.sequence(a,cc.delayTime(.5),cc.callFunc(function(){t&&t()})))}}}),cc._RF.pop()},{}],Assets:[function(e,t,i){"use strict";cc._RF.push(t,"ee7d1VM4ohDdbmZBuZsUCEk","Assets"),t.exports={getRealUrl:function(e){var t=window.__AvgAssets;if(t){for(var i in t){var n=t[i],o=n.md5;if(e===n.path)return o}return console.error("\u672a\u83b7\u53d6md5\u6587\u4ef6:".concat(e)),null}return e},getUrlByUUID:function(e){var t=window.__AvgAssets;if(t){for(var i in t){var n=t[i],o=n.md5;n.path;if(e===i)return o}return null}var a=this._getUrlByUUID(e);return a&&a.path?a.path:null},_getUrlByUUID:function(t){var i=e("StoryConfig").file.assets.data;return i&&i[t]?i[t]:null}},cc._RF.pop()},{StoryConfig:"StoryConfig"}],AudioDanceBtn:[function(e,t,i){"use strict";cc._RF.push(t,"6d3ccN3VaZIqpDdTBsqDNBd","AudioDanceBtn"),cc.Class({extends:cc.Component,properties:{line:[e("DanceLine")],clickCB:null},onLoad:function(){this.stopDance()},onClickBtn:function(){this.isDance?this.stopDance():this.startDance(),this.clickCB&&this.clickCB(this.isDance)},start:function(){},startDance:function(){this.isDance=!0,this.line.forEach(function(e){e.dance()})},stopDance:function(){this.isDance=!1,this.line.forEach(function(e){e.stopDance()})}}),cc._RF.pop()},{DanceLine:"DanceLine"}],AudioMgr:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}cc._RF.push(t,"b4fc5OYSVFKuKONXXnsSY7F","AudioMgr");var c={In:"fade-in",Out:"fade-out"},s=!1,r=new(function(){function e(){n(this,e),this.fadeArray=[]}return a(e,[{key:"add",value:function(e){this.fadeArray.push(e)}},{key:"removeFadeByAudioID",value:function(e){for(var t=0;t<this.fadeArray.length;){var i=this.fadeArray[t];i.audioID===e?(i.clean(),this.fadeArray.splice(t,1)):t++}}},{key:"removeFade",value:function(e){for(var t=0;t<this.fadeArray.length;){var i=this.fadeArray[t];i.audioID===e.audioID&&e.type===i.type?(i.clean(),this.fadeArray.splice(t,1)):t++}}},{key:"pause",value:function(){this.fadeArray.forEach(function(e){e.timer&&e.timer.pause()})}},{key:"resume",value:function(){this.fadeArray.forEach(function(e){e.timer&&e.timer.resume()})}}]),e}()),l=function(){function e(){n(this,e),this.timerID=null,this.numTotal=0,this.numCur=0,this.cb=null,this._isPaused=s}return a(e,[{key:"run",value:function(e,t){this.cb=t;this.numTotal=1e3*e/200,this.numCur=0,this.timerID=setInterval(this._onSchedule.bind(this),200)}},{key:"_onSchedule",value:function(){this._isPaused||(this.numCur++,this.numCur>=this.numTotal?(this.cb&&this.cb(1),clearInterval(this.timerID)):this.cb&&this.cb(this.numCur/this.numTotal))}},{key:"stop",value:function(){this.timerID&&(clearInterval(this.timerID),this.timerID=null)}},{key:"pause",value:function(){this._isPaused=!0}},{key:"resume",value:function(){this._isPaused=!1}}]),e}(),d=function(){function e(t,i,o,a){var s=this;n(this,e),this.type=c.Out,this.volume=i,this.time=o,this.audioID=t,this.totalTime=a,this.timer=null,null!==a&&o>a?cc.error("\u7528\u6237\u8bbe\u7f6e\u6de1\u51fa\u65f6\u95f4:".concat(o,"s, \u4f46\u662f\u7528\u6237\u53c8\u8981\u6c42\u97f3\u9891\u53ea\u64ad\u653e").concat(a,"s,\u81ea\u76f8\u77db\u76fe!")):(this.endTimerID=setInterval(function(){var e=cc.audioEngine.getCurrentTime(t);(s.totalTime||cc.audioEngine.getDuration(t))-e<=s.time&&(clearInterval(s.endTimerID),s.endTimerID=null,s.createTimer())},100),r.add(this))}return a(e,[{key:"createTimer",value:function(){this.timer=new l,this.timer.run(this.time,this.updateVolume.bind(this)),this.updateVolume(0)}},{key:"_calcVolume",value:function(){return h.calcVolume(this.volume)}},{key:"updateVolume",value:function(e){var t=this._calcVolume();cc.audioEngine.setVolume(this.audioID,t*(1-e)),e>=1&&r.removeFade(this)}},{key:"clean",value:function(){this.timer&&this.timer.stop(),clearInterval(this.endTimerID)}}]),e}(),u=function(){function e(t,i,o){n(this,e),this.type=c.In,this.volume=i,this.time=o,this.audioID=t,this.timer=new l,this.timer.run(o,this.updateVolume.bind(this)),this.updateVolume(0),r.add(this)}return a(e,[{key:"_calcVolume",value:function(){return h.calcVolume(this.volume)}},{key:"updateVolume",value:function(e){var t=this._calcVolume();cc.audioEngine.setVolume(this.audioID,t*e),e>=1&&r.removeFade(this)}},{key:"clean",value:function(){this.timer.stop()}}]),e}(),h=(e("LocalStorage"),{_stopBgAudioFlag:!1,bgAudioCfg:{id:null,volume:1},allPieceAudioInfo:[],tagAudioID:{},updateAllAudioPlayRate:function(e){var t=cc.audioEngine._id2audio;for(var i in t)this._updateAudioPlayBackRate(i,e)},setAudioPlayBackRate:function(e){var t=GameDB.MultipleSpeed;this._updateAudioPlayBackRate(e,t)},_updateAudioPlayBackRate:function(e,t){if(void 0!==e){var i=cc.audioEngine._id2audio[e];if(i){var n=i._element;n&&(n instanceof HTMLAudioElement?n.playbackRate=t:n._currentSource&&(n._currentSource.playbackRate.value=t))}}},init:function(){var e=this;cc.ObserverMgr.addEventListener(cc.AvgMsg.Msg.PauseStory,function(t,i){s=!!i;var n=e.allPieceAudioInfo;null!==e.bgAudioCfg.id&&(n=n.concat([e.bgAudioCfg]));for(var o=0;o<n.length;o++){var a=n[o];i?cc.audioEngine.pause(a.id):(cc.audioEngine.resume(a.id),e.setAudioPlayBackRate(a.id))}i?r.pause():r.resume()},this),cc.ObserverMgr.addEventListener(cc.AvgMsg.Msg.UpdateGameMultipleSpeed,function(t,i){e.updateAllAudioPlayRate(i)},this)},_checkAudioSrc:function(e){return!!e||(cc.warn("\u65e0\u6548\u7684\u97f3\u9891\u6587\u4ef6: ".concat(e)),!1)},stopAll:function(){this.onLoadPieceEvent(),cc.audioEngine.stop(this.bgAudioCfg.id),cc.audioEngine.stopAllEffects()},_playAudioMusicFade:function(e,t){var i=this;r.removeFadeByAudioID(this.bgAudioCfg.id),cc.audioEngine.stop(this.bgAudioCfg.id),this.bgAudioCfg=t;var n=cc.audioEngine.playMusic(e,!1);this.setAudioPlayBackRate(n),t.id=n,s&&cc.audioEngine.pause(n),this._dealAudioFade(n,t,function(){t.loop&&i._playAudioMusicFade(e,t)})},_playAudioEffectFade:function(e,t,i){var n=this,o=cc.audioEngine.playEffect(e,!1);this.setAudioPlayBackRate(o),t.id=o,s&&cc.audioEngine.pause(o),this._dealAudioFade(o,t,function(){i&&i.endCB&&i.endCB(),t.loop&&n._playAudioEffectFade(e,t,i)})},_dealAudioFade:function(e,t,i){var n=t.volume,o=t.loop,a=t.time,c=this.calcVolume(n);if(cc.audioEngine.setVolume(e,c),cc.audioEngine.setFinishCallback(e,function(){setTimeout(function(){i&&i()})}),t.fadeIn){var s=t.fadeInTime;s>=2&&new u(e,n,s)}if(t.fadeOut){var r=t.fadeOutTime;if(r>=2){var l=null;o||(l=a),new d(e,n,r,l)}}},playMusic:function(e,t){var i=this;this._stopBgAudioFlag=!1,this._checkAudioSrc(e)&&cc.loader.load(e,function(e,n){i._stopBgAudioFlag?(cc.audioEngine.stop(i.bgAudioCfg.id),r.removeFadeByAudioID(i.bgAudioCfg.id)):i._playAudioMusicFade(n,t)})},stopGlobalBgMusic:function(){this._stopBgAudioFlag=!0,cc.audioEngine.stop(this.bgAudioCfg.id),r.removeFadeByAudioID(this.bgAudioCfg.id)},calcVolume:function(e){return e/100*GameDB.MusicVolume},updateAllAudioVolume:function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.UpdateVolume);var e=this.allPieceAudioInfo;null!==this.bgAudioCfg.id&&(e=e.concat([this.bgAudioCfg]));for(var t=0;t<e.length;t++){var i=e[t];if(i){var n=this.calcVolume(i.volume);cc.audioEngine.setVolume(i.id,n)}}},onLoadPieceEvent:function(){for(var e=this.allPieceAudioInfo,t=0;t<e.length;t++){var i=e[t].id;cc.audioEngine.stopEffect(i),r.removeFadeByAudioID(i)}this.allPieceAudioInfo=[],this.tagAudioID={},this._stopBgAudioFlag=!1},playEffect:function(e,t,i){var n=this;this._checkAudioSrc(e)&&cc.loader.load(e,function(e,o){n.allPieceAudioInfo.push(t),n._playAudioEffectFade(o,t,i)})},playTagEffect:function(e,t,i){var n=this;this._checkAudioSrc(t)&&cc.loader.load(t,function(t,o){n.allPieceAudioInfo.push(i),n._playAudioEffectFade(o,i),n.tagAudioID[e.toString()]=i})},stopTagEffect:function(e){var t=this.tagAudioID[e.toString()].id;cc.audioEngine.stopEffect(t),r.removeFadeByAudioID(t),delete this.tagAudioID[e.toString()]}});window.AudioMgr=h,t.exports=h,cc._RF.pop()},{LocalStorage:"LocalStorage"}],AudioPlayTest:[function(e,t,i){"use strict";cc._RF.push(t,"59b33clG3VMAJW6zS6L+wI+","AudioPlayTest"),cc.Class({extends:cc.Component,properties:{},start:function(){},onBtnClick:function(){var t=e("AudioMgr"),i={loop:!1,volume:100,fadeIn:!0,fadeInTime:2,fadeOut:!0,fadeOutTime:2,time:35};cc.loader.loadRes("alisi.mp3",function(e,n){if(e)cc.log(e);else if(t._playAudioMusicFade(n,i),void 0!==i.id){var o=cc.audioEngine._id2audio[i.id]._element;o&&(o instanceof HTMLAudioElement||o._currentSource&&(o._currentSource.playbackRate.value=2))}})}}),cc._RF.pop()},{AudioMgr:"AudioMgr"}],AudioUtil:[function(e,t,i){"use strict";cc._RF.push(t,"2191a5gKyBKqLp3AINPBCpy","AudioUtil"),t.exports={playAudio:function(t){cc.loader.loadRes(t,function(t,i){if(!t){var n=e("AudioMgr"),o=n.calcVolume(100),a=cc.audioEngine.playEffect(i);n.setAudioPlayBackRate(a),cc.audioEngine.setVolume(a,o)}})}},cc._RF.pop()},{AudioMgr:"AudioMgr"}],AvgBackground:[function(e,t,i){"use strict";cc._RF.push(t,"8cc00qVy+1BCZ3sl3BGV1Kg","AvgBackground");var n={initBg:function(){if(cc.sys.isBrowser){var e=document.getElementById("Cocos2dGameContainer");e&&(e.style.backgroundColor="black")}}};t.exports=window.AvgBackground=n,cc._RF.pop()},{}],AvgBag:[function(e,t,i){"use strict";cc._RF.push(t,"7fa3aWRGH9CLLMqFVIZpyop","AvgBag");var n=AvgData.AvgType;t.exports={createBagItemList:function(e){var t=AvgPlayer.PreloadPrefab.prefabs.BagItemList.prefab;if(!t)return null;var i=cc.instantiate(t);i.name=n.AvgBagItemList.type,AvgPlayer.setHitTestFlag(i,!0,!0),i.avgSyncData=e;var o=i.getComponent("BagItemList");return o.scroll.content.height=0,AvgPlayer.setHitTestFlag(o.bgNode,!0,!1),AvgPlayer.setOwn(o.bgNode,i),AvgPlayer.setHitTestFlag(o.scroll.node,!0,!1,{size:!0}),AvgPlayer.setOwn(o.scroll.node,i),AvgPlayer.setHitTestFlag(o.backNode,!0,!1),AvgPlayer.setOwn(o.backNode,i),i.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(i.avgSyncData));AvgPlayer.setNodeBaseProperty(i,e),AVG_EDITOR?(o.disableScrollEvent(),o.updateBagItemInEditor(e)):o.setListData(GameDB.getBagData()),o.updateBagItemList(e),AvgPlayer.setSubElementData(o.bgNode,e.bg),AvgPlayer.setSubElementData(o.backNode,e.back),AvgPlayer.setSubElementData(o.scroll.node,e.list)},i.avgSyncData2Node(),i.avgSyncNode2Data=function(){var e=i.avgSyncData;AvgPlayer.syncNode2Data(i),e.bg.size.width=o.bgNode.width,e.bg.size.height=o.bgNode.height,e.bg.position.x=o.bgNode.x,e.bg.position.y=o.bgNode.y,e.back.size.width=o.backNode.width,e.back.size.height=o.backNode.height,e.back.position.x=o.backNode.x,e.back.position.y=o.backNode.y},e.uuid=i.uuid,i},_initSubElement:function(e,t){AvgPlayer.setHitTestFlag(e,!0,!1),AvgPlayer.setOwn(e,t)},createBagItemDetails:function(e){var t=this,i=AvgPlayer.PreloadPrefab.prefabs.BagItemDetails.prefab;if(!i)return null;var o=cc.instantiate(i);o.name=n.AvgBagItemDetails.type,AvgPlayer.setHitTestFlag(o,!0,!0),o.avgSyncData=e;var a=o.getComponent("BagItemDetails");return this._initSubElement(a.bgNode,o),this._initSubElement(a.iconSprite.node,o),this._initSubElement(a.numberBgNode,o),this._initSubElement(a.nameLabel.node,o),this._initSubElement(a.descNode,o),this._initSubElement(a.playBtnSprite.node,o),this._initSubElement(a.useBtnSprite.node,o),o.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(o.avgSyncData));AvgPlayer.setNodeBaseProperty(o,e),a.updateBagItemDetails(e),AVG_EDITOR&&a.updateBagItemDetailsInEditor(),AvgPlayer.setSubElementData(a.bgNode,e.bg),AvgPlayer.setSubElementData(a.iconSprite.node,e.icon),AvgPlayer.setSubElementData(a.numberBgNode,e.itemNum),AvgPlayer.setSubElementData(a.nameLabel.node,e.itemName),AvgPlayer.setSubElementData(a.descNode,e.itemDesc),AvgPlayer.setSubElementData(a.playBtnSprite.node,e.playBtn),AvgPlayer.setSubElementData(a.useBtnSprite.node,e.useBtn)},o.avgSyncData2Node(),o.avgSyncNode2Data=function(){var e=o.avgSyncData;AvgPlayer.syncNode2Data(o),t._syncPosAndSize(e.bg,a.bgNode),t._syncPosAndSize(e.icon,a.iconSprite.node),t._syncPosAndSize(e.itemName,a.nameLabel.node),t._syncPosAndSize(e.itemDesc,a.descNode),t._syncPosAndSize(e.itemNum,a.numberBgNode),t._syncPosAndSize(e.playBtn,a.playBtnSprite.node),t._syncPosAndSize(e.useBtn,a.useBtnSprite.node)},e.uuid=o.uuid,o},_syncPosAndSize:function(e,t){e.position.x=t.x,e.position.y=t.y,e.size.width=t.width,e.size.height=t.height},createBagGetItems:function(e){var t=this,i=AvgPlayer.PreloadPrefab.prefabs.BagGetItems.prefab;if(!i)return null;var o=cc.instantiate(i);o.name=n.AvgBagGetItems.type,AvgPlayer.setHitTestFlag(o,!0,!0),o.avgSyncData=e;var a=o.getComponent("BagGetItems");a.createTips(),this._initSubElement(a.titleNode,o),this._initSubElement(a.jumpBtn.node,o),this._initSubElement(a.bgSprite.node,o);for(var c=[],s=AvgPlayer.PreloadPrefab.prefabs.BagGoodsItem.prefab,r=0;r<e.items.length;r++){var l=cc.instantiate(s),d=l.getComponent("GoodsItem");AvgPlayer.setHitTestFlag(l,!1,!0),this._initSubElement(d.nameLabel.node,o),this._initSubElement(d.numNode,o),this._initSubElement(d.iconSprite.node,o),this._initSubElement(d.descNode,o),c.push(d),a.node.addChild(l)}return a.itemArray=c,o.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(o.avgSyncData));AvgPlayer.setNodeBaseProperty(o,e),AvgPlayer.setSubElementData(a.titleNode,e.title),AvgPlayer.setSubElementData(a.jumpBtn.node,e.jumpBtn),AvgPlayer.setSubElementData(a.bgSprite.node,e.bg),a.setBagGetItemsAvgData(e);for(var t=0;t<c.length;t++){var i=c[t],n=e.items[t];AvgPlayer.setSubElementData(i.nameLabel.node,n.itemName),AvgPlayer.setSubElementData(i.numNode,n.itemNum),AvgPlayer.setSubElementData(i.iconSprite.node,n.icon),AvgPlayer.setSubElementData(i.descNode,n.itemDesc),i.setGoodsItemAvgData(n)}AVG_EDITOR&&a.updateBagGetItemsInEditor()},o.avgSyncData2Node(),o.avgSyncNode2Data=function(){var e=o.avgSyncData;AvgPlayer.syncNode2Data(o),t._syncPosAndSize(e.title,a.titleNode),t._syncPosAndSize(e.jumpBtn,a.jumpBtn.node),t._syncPosAndSize(e.bg,a.bgSprite.node);for(var i=0;i<c.length;i++){var n=c[i];t._syncPosAndSize(e.items[i].itemName,n.nameLabel.node),t._syncPosAndSize(e.items[i].itemNum,n.numNode),t._syncPosAndSize(e.items[i].icon,n.iconSprite.node),t._syncPosAndSize(e.items[i].itemDesc,n.descNode)}},e.uuid=o.uuid,o}},cc._RF.pop()},{}],AvgEnv:[function(e,t,i){"use strict";cc._RF.push(t,"285dft0GopH/ZUbhtbrXUrJ","AvgEnv"),window.AVG_EDITOR=!1,cc._RF.pop()},{}],AvgGoods:[function(e,t,i){"use strict";cc._RF.push(t,"7ce72HYJUdPZ6p438pBDOLP","AvgGoods");var n={getItemData:function(e){for(var t=cc.StoryConfig.file.goods.data.goods,i=0;i<t.length;i++){var n=t[i];if(n.uuid===e)return n}return null},getItemDataByID:function(e){for(var t=cc.StoryConfig.file.goods.data.goods,i=0;i<t.length;i++){var n=t[i];if(n.id.toString()===e.toString())return n}return null}};t.exports=n,cc.AvgGoods=n,cc._RF.pop()},{}],AvgMsg:[function(e,t,i){"use strict";cc._RF.push(t,"68a2e2j6dNJ+6xG/SgSKE1/","AvgMsg");cc.AvgMsg=t.exports={Msg:{OnJumpNewPlot:"AvgMsg_Msg_OnJumpNewPlot",OnPieceTalkOver:"AvgMsg_Msg_OnPieceTalkOver",OnPieceAnimationPlayBefore:"AvgMsg_OnPieceAnimationPlayBefore",OnPlotMenuItemSelected:"AvgMsg_Msg_OnPlotMenuItemSelected",OnPlotMenuNoJump:"AvgMsg_Msg_OnPlotMenuNoJump",OnPlotMenuRemoveWithNoPlotEvents:"AvgMsg_Msg_OnPlotMenuRemoveWithNoPlotEvents",OnPlotMenuRemove:"AvgMsg_Msg_OnPlotMenuRemove",OnPlotMenuOffTouchEvent:"AvgMsg_Msg_OnPlotMenuOffTouchEvent",OnShieldStoryAnyTouch:"AvgMsg_Msg_OnShieldStoryAnyTouch",OnQTEProgress:"AvgMsg_Msg_OnQTEProgress",OnAllPieceQTERunResult:"AvgMsg_Msg_OnAllPieceQTERunResult",OnPieceAnimationSpawnReplay:"AvgMsg_Msg_OnPieceAnimationSpawnReplay",OnPieceAnimationSpawnNext:"AvgMsg_Msg_OnPieceAnimationSpawnNext",OnQTEReloadCurPiece:"AvgMsg_Msg_OnQTEReloadCurPiece",OnGoNextPiece:"AvgMsg_Msg_OnGoNextPiece",ShowValueEvenShowText:"AvgMsg_Msg_ShowValueEvenShowText",OnEnableGlobalTouch:"AvgMsg_Msg_OnEnableGlobalTouch",PieceHasOptions:"AvgMsg_Msg_PieceHasOptions",PieceShowOptions:"AvgMsg_Msg_PieceShowOptions",UserTouch:"AvgMsg_Msg_UserTouch",PieceAnimationOver:"AvgMsg_PieceAnimationOver",UiButtonClick:"AvgMsg_UiButtonClick",EnterGameFromFileItem:"AvgMsg_EnterGameFromFileItem",ShowAvgMenuLayer:"AvgMsg_ShowAvgMenuLayer",UpdateVolume:"AvgMsg_UpdateVolume",UpdateGameMultipleSpeed:"AvgMsg_UpdateGameMultipleSpeed",InSetLayerUpdateVolume:"AvgMsg_InSetLayerUpdateVolume",ActiveSkipBtn:"AvgMsg_ActiveSkipBtn",OnPieceTalkOverAutoRead:"AvgMsg_OnPieceTalkOverAutoRead",OnPlotMenuLimitTimeOver:"AvgMsg_OnPlotMenuLimitTimeOver",ClearAllUI:"AvgMsg_ClearAllUI",PauseStory:"AvgMsg_PauseStory",WindowResize:"AvgMsg_WindowResize",AddVideoPlayBtn:"AvgMsg_AddVideoPlayBtn",AddNodeToVideoBtnLayer:"AvgMsg_AddNodeToVideoBtnLayer",PasswordLockInputNum:"AvgMsg_PasswordLockInputNum",PasswordLockInputUpdate:"AvgMsg_PasswordLockInputUpdate",PasswordLockInputDel:"AvgMsg_PasswordLockInputDel",PasswordLockInputOpen:"AvgMsg_PasswordLockInputOpen",PasswordLockOpenSucceed:"AvgMsg_PasswordLockOpenSucceed",PasswordLockOpenFailed:"AvgMsg_PasswordLockOpenFailed",X5VideoFullScreen:"AvgMsg_X5VideoFullScreen",ShowSetPanel:"AvgMsg_ShowSetPanel",LoadingInfo:"AvgMsg_LoadingInfo",ShowAvgBagLayer:"AvgMsg_ShowAvgBagLayer",CloseAvgBagLayer:"AvgMsg_CloseAvgBagLayer",ShowBagItemDetails:"AvgMsg_ShowBagItemDetails",ShowBagGetItems:"AvgMsg_ShowBagGetItems",JumpBagListAndSelectGoods:"AvgMsg_JumpBagListAndSelectGoods",BagListItemSelect:"AvgMsg_BagListItemSelect",BagItemDisplay:"AvgMsg_BagItemDisplay",StoryEnd:"AvgMsg_StoryEnd",ShowVideoDebugView:"AvgMsg_ShowVideoDebugView"}},cc._RF.pop()},{}],AvgNodeRender:[function(e,t,i){"use strict";cc._RF.push(t,"5e40ezXfIpKRJDIFlqWbbk/","AvgNodeRender");var n={_updateNodePosAndSize:function(e,t){e&&(e.setPosition(t.position.x,t.position.y),e.setContentSize(t.size.width,t.size.height),void 0===t.active?e.active=!0:e.active=!!t.active)},Element:function(e,t){this._updateNodePosAndSize(e,t)},Image:function(e,t){this._updateNodePosAndSize(e,t);var i=e.getComponent(cc.Sprite);i&&t.texture&&AvgPlayer.setSpriteFrame(i,t.texture)},Button:function(e,t){this._updateNodePosAndSize(e,t)}};t.exports=window.AvgNodeRender=n,cc._RF.pop()},{}],AvgPlayer:[function(e,t,i){"use strict";cc._RF.push(t,"0a8c0CfHllKCZaMP/e2rPP8","AvgPlayer");var n=window.AvgData,o=n.Type,a=n.AvgType,c=(n.TimelineType,n.FontType,n.ActionType,n.ActionAudioType,n.ActionVideoType,n.ShakeStrength,n.startingMoment,n.DefaultValue),s=(n.ImageData,n.PlotMenuItemData),r=n.PlotMenuData,l=n.TalkData,d=n.TextData,u=(n.EventPlotData,n.EventValueData,n.UiCoverData),h=n.UiMenuData,g=n.UiEnvData,p=n.UiFileMgrData,f=n.PlotJumpData,v=n.AudioBgStopGlobalData,y=n.AudioBgData,m=n.AudioEffectData,_=n.AudioAsideData,A=n.EffectCfg,b=(n.EffectRainData,n.EffectSnowData,n.EffectWinData,n.VideoPlotData),S=n.ValueJudgeData,D=n.QTEData,T=(n.ActionNone,n.ActionMove,n.ActionFadeIn,n.ActionFadeOut,n.ActionShake,n.ActionScale,n.ActionAudioPlay,n.ActionVideoPlay,{AvgUI:e("AvgUI"),AvgBag:e("AvgBag"),MaskBeganGroup:null,PreloadPrefab:e("AVGPrefabPreload"),getAvgComp:function(e){for(var t in a){var i=a[t];if(i.type===e)return i.comp}},_isInit:!1,initSceneBg:function(){!1===this._isInit&&(this._isInit=!0,cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(){}))},insertUiCover:function(e,t){var i=new u;return e&&(i.size.width=e),t&&(i.size.height=t),this._createUiCover(i)},insertUiFileMgr:function(e,t){var i=new p;return e&&(i.size.width=e),t&&(i.size.height=t),this._createUiFileMgr(i)},insertUiMenu:function(e,t){var i=new h;return e&&(i.size.width=e),t&&(i.size.height=t),this._createUiMenu(i)},insertUiEnv:function(e,t){var i=new g;return e&&(i.size.width=e),t&&(i.size.height=t),this._createUiEnv(i)},insertImageBg:function(e,t){var i=new ImageBgData(e);return i.texture=t,this._createImage(i)},insertImageBgByData:function(e){return this._createImage(e)},insertImageDraw:function(e,t){var i=new ImageDrawData(e);return i.texture=t,this._createImage(i)},insertImageDrawByData:function(e){return this._createImage(e)},insertImageItem:function(e,t){var i=new ImageItemData(e);return i.texture=t,this._createImage(i)},insertImageItemByData:function(e){return this._createImage(e)},insertImageHead:function(e,t){var i=new ImageHeadData(e);return i.texture=t,this._createImage(i)},insertImageHeadByData:function(e){return this._createImage(e)},insertPlotMenu:function(e){var t=new r(e);return this._createPlotMenu(t)},insertPlotMenuByData:function(e){return this._createPlotMenu(e)},insertTalkVertical:function(e,t,i,n,o){var a=new l(e);return a.resetWithVertical(),a.setInfo(n,t,i,null,o),this._createTalk(a)},insertTalkHorizontal:function(e,t,i,n,o){var a=new l(e);return a.resetWithHorizontal(),a.setInfo(n,t,i,null,o),this._createTalk(a)},insertPhoneIMByData:function(e){return this._createPhoneIM(e)},insertTalkByData:function(e){return this._createTalk(e)},insertTextVertical:function(e,t){var i=new d(e);return this._createText(i)},insertTextHorizontal:function(e,t){var i=new d(e);return i.textFont.setData(t),this._createText(i)},insertTextByData:function(e){return this._createText(e)},insertPlotJump:function(e){var t=new f;return t.jumpPlotID=e,this._createPlotJump(t)},insertAudioBgStopGlobal:function(){var e=new v;return this._createAudio(e)},insertAudioBg:function(e){var t=new y;return t.src=e,this._createAudio(t)},insertAudioBgByData:function(e){return this._createAudio(e)},insertAudioEffect:function(e,t){var i=new m(e);return i.src=t,this._createAudio(i)},insertAudioEffectByData:function(e){return this._createAudio(e)},insertAudioAside:function(e,t){var i=new _(e);return i.src=t,this._createAudio(i)},insertAudioAsideByData:function(e){return this._createAudio(e)},insertVideoPlot:function(e,t,i){var n=new b(e,t);return i&&(i.zIndex&&(n.zIndex=i.zIndex),i.width&&(n.size.width=i.width),i.height&&(n.size.height=i.height),n.isRemote=!!i.isRemote),this._createVideoPlot(n)},insertVideoPlotByData:function(e){return this._createVideoPlot(e)},insertQTE:function(e){var t=new D(e);return this._createQTE(t)},insertQTEByData:function(e){return this._createQTE(e)},insertValueJudge:function(e){var t=new S(e);return this._createValueJudge(t)},addMaskBeganGroupComp:function(e){if(e){var t=e.getComponent("MaskBeganGroup");return t||(t=e.addComponent("MaskBeganGroup")),this.MaskBeganGroup=t,t}},_convert:function(e,t,i){var n=cc.view.getDesignResolutionSize();AVG_EDITOR&&(n=Editor.Set.DesignSize);var o=new cc.Node(a.Root.type);this.setHitTestFlag(o,!1,!0),o.type=a.Root.type,o.width=n.width,o.height=n.height;for(var c=e,s=0;s<c.length;s++){var r=c[s],l=null;r.type===a.ImageBg.type||r.type===a.ImageDraw.type||r.type===a.ImageHead.type||r.type===a.ImageItem.type||"image"===r.type?(l=this._createImage(r),this._addNormalElementEvent(l,r,t)):r.type===a.PlotMenu.type?l=this._createPlotMenu(r,t):r.type===a.Talk.type?l=this._createTalk(r):r.type===a.Text.type?(l=this._createText(r),this._addNormalElementEvent(l,r,t)):r.type===a.PasswordLock.type?(l=this._createPasswordLock(r),this._addPwdLockEvent(l,r,t)):r.type===a.AudioEffect.type?l=this._createAudio(r):r.type===a.AudioAside.type?l=this._createAudio(r):r.type===a.AudioBg.type?l=this._createAudio(r):r.type===a.PlotJump.type?l=this._createPlotJump(r):r.type===a.EffectWin.type||r.type===a.EffectSnow.type||r.type===a.EffectRain.type||r.type===a.EffectLeafFall.type||r.type===a.EffectFog.type||r.type===a.EffectLight.type||r.type===a.EffectFire.type||r.type===a.EffectSpotFire.type||r.type===a.EffectBoom.type||r.type===a.EffectBloodDown.type||r.type===a.EffectBloodDrip.type?l=this._createEffect(r):r.type===a.VideoPlot.type?(l=this._createVideoPlot(r),this._addNormalElementEvent(l,r,t)):r.type===a.UiCover.type?l=this._createUiCover(r):r.type===a.UiFileMgr.type?l=this._createUiFileMgr(r):r.type===a.UiEnv.type?l=this._createUiEnv(r):r.type===a.UiMenu.type?l=this._createUiMenu(r):r.type===a.AudioBgStopGlobal.type?l=this._createAudio(r):r.type===a.ValueJudge.type?(l=this._createValueJudge(r),this._addValueJudgeEvent(l,r,t)):r.type===a.QTE.type?(l=this._createQTE(r),this._addQTEEvent(l,r,t)):r.type===a.HelperInsertRole.type?AVG_EDITOR&&(l=this._createHelperRoleNode(r)):r.type===a.HelperInsertScene.type?AVG_EDITOR&&(l=this._createHelperSceneNode(r)):r.type===a.AvgBagItemList.type?l=this.AvgBag.createBagItemList(r):r.type===a.AvgBagItemDetails.type?l=this.AvgBag.createBagItemDetails(r):r.type===a.AvgBagGetItems.type?l=this.AvgBag.createBagGetItems(r):r.type===a.AvgBagBtn.type||r.type===a.AvgMenuBtn.type?l=this.AvgUI.createUiBtn(r):r.type===a.PhoneIM.type&&(l=this._createPhoneIM(r)),l&&(this._addElementAnimation(l,r,t),o.addChild(l,r.zIndex||0),AVG_EDITOR&&l.addComponent(cc.BlockInputEvents))}i&&i(null,o,e)},convertElementToNodeByData:function(e,t,i){this._convert(e,t,i)},convertElementToNode:function(e,t){var i=this,n=e.url,o=e.id;AVG_EDITOR&&cc.loader.removeItem(n),cc.loader.load(n,function(e,n){if(e)return t&&t(e,null);i._convert(n,o,t)})},_addNormalElementEvent:function(t,i,n){if(!AVG_EDITOR){var o=e("StoryData"),a=e("GameUtil"),c=(AvgData.AvgType,o.getPieceElementEventDataByID(n,i.id));if(c.length>0)if(a.filterPlotEvents(c).length<=1)for(var s=0;s<c.length;s++){t.addComponent("ElementEvent").setEventData(c[s])}else console.error("\u5143\u7d20[".concat(i.name,"]\u5305\u542b\u591a\u4e2a\u5267\u60c5\u4e8b\u4ef6"))}},_addPwdLockEvent:function(e,t,i){if(!AVG_EDITOR){var n=e.addComponent("PasswordLockEvent");n&&n.setPwdLockEventData(t,i)}},_addValueJudgeEvent:function(e,t,i){AVG_EDITOR||e.addComponent("ValueJudgeEvent").setValueJudgeEventData(t)},_addQTEEvent:function(e,t,i){AVG_EDITOR||e.addComponent("QTEEvent").setQTEEventData(t,i)},_addElementAnimation:function(t,i,n){if(!AVG_EDITOR){var o=e("StoryPieceAniMgr"),c=e("StoryData"),s=i.id,r=c.getPieceElementAnimationDataByID(n,s);if(r.length>0)for(var l=0;l<r.length;l++){var d=t.addComponent("Animation");d.setActionData(r[l]),o.addPieceAnimation(d)}else if(t.opacity=255,i.type===a.QTE.type)cc.error("\u914d\u7f6e\u51fa\u73b0\u5f02\u5e38:QTE[".concat(i.id,"]\u5fc5\u987b\u5e26\u6709\u9ed8\u8ba4\u7684\u6de1\u5165\u52a8\u753b,\u8be5QTE\u52a8\u753b\u643a\u5e26\u4e3a\u4e2a\u6570\u4e3a0,\u4f46\u662f\u8fd0\u884c\u65f6\u8fd8\u662f\u652f\u6301\u4e86\u64ad\u653e,QTE\u7684\u672a\u5b8c\u6210\u91cd\u65b0\u64ad\u653e\u4f1a\u5bfc\u81f4\u4e0d\u80fd\u91cd\u65b0\u64ad\u653e\u7684\u95ee\u9898")),t.getComponent("QTE").startUpQTE()}},convertNodeToElement:function(e){if(e.type===a.Root.type){for(var t=[],i=0;i<e.children.length;i++){var n=e.children[i];n.avgSyncNode2Data&&n.avgSyncNode2Data();var o=JSON.parse(JSON.stringify(n.avgSyncData));o.uuid&&delete o.uuid,t.push(o)}return t}return cc.log("\u672a\u77e5\u7684\u8282\u70b9"),null},syncNode2Data:function(e){var t=e.avgSyncData;t&&(t.position.x=e.x,t.position.y=e.y,t.size.width=e.width,t.size.height=e.height,t.scale.x=e.scaleX,t.scale.y=e.scaleY,t.color=e.color.toCSS())},setNodeBaseProperty:function(e,t){"string"==typeof t.position.x&&(cc.warn("property is string: x=".concat(t.position.x)),t.position.x=parseFloat(t.position.x)),"string"==typeof t.position.y&&(cc.warn("property is string: x=".concat(t.position.y)),t.position.y=parseFloat(t.position.y)),"string"==typeof t.size.height&&(cc.warn("property is string: x=".concat(t.size.height)),t.size.height=parseFloat(t.size.height)),"string"==typeof t.size.width&&(cc.warn("property is string: x=".concat(t.size.width)),t.size.width=parseFloat(t.size.width)),e.setPosition(cc.v2(t.position.x||0,t.position.y||0)),e.setContentSize(cc.size(t.size.width||0,t.size.height||0)),e.opacity=void 0!==t.opacity?t.opacity:255,e.active=!!t.active,e.scaleX=t.scale.x,e.scaleY=t.scale.y;var i=new cc.Color;e.color=i.fromHEX(t.color),e.id=t.id,e.type=t.type,e.zIndex=t.zIndex},_getUrlByUUID:function(t){var i=t;AVG_EDITOR?t&&(i=Editor.AssetDB.isValidByUUID(t)?Editor.AssetDB.uuidToFsPath(t):null):i=e("Assets").getUrlByUUID(t);return i},setSpriteFrame:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0,o=this._getUrlByUUID(t);if(e&&e.node&&e.node.isValid&&i&&(e.sizeMode=cc.Sprite.SizeMode.CUSTOM,e.node.setContentSize(cc.size(i.width,i.height))),!o){cc.error("\u53d1\u73b0\u65e0\u6548\u7684\u8d44\u6e90UUID: ".concat(t));var a=this.PreloadPrefab.prefabs.ResMissingTexture.prefab;return e.spriteFrame=a?new cc.SpriteFrame(a):null,void(i?(e.sizeMode=cc.Sprite.SizeMode.CUSTOM,e.node.setContentSize(cc.size(i.width,i.height)),n&&n(i.width,i.height)):n&&n(0,0))}cc.loader.load(o,function(t,o){t?cc.log(t):e.isValid&&e.node.isValid&&(i?(e.sizeMode=cc.Sprite.SizeMode.CUSTOM,n&&n(i.width,i.height)):(e.sizeMode=cc.Sprite.SizeMode.TRIMMED,n&&n(o.width,o.height)),e.spriteFrame=new cc.SpriteFrame(o||null))})},_createUiMenu:function(e){var t=new cc.Node(a.UiMenu.type);this._createUiBottom(t),t.setContentSize(e.size.width,e.size.height),t.addComponent(cc.BlockInputEvents),this.setHitTestFlag(t,!0,!0,{pos:e.lockPos,size:!0});var i=new cc.Node("bg");t.addChild(i,1);var n=i.addComponent(cc.Sprite),o=new cc.Node("buttons");this.setOwn(o,t),this.setHitTestFlag(o,!0,!1,{pos:!1,size:!0}),t.addChild(o,2);var c=o.addComponent(cc.Layout);c.type=cc.Layout.Type.VERTICAL,c.resizeMode=cc.Layout.ResizeMode.CONTAINER,c.spacingY=20;var s=new cc.Node("backNode");t.addChild(s,3);var r=s.addComponent(cc.Widget);r.alignMode=cc.Widget.AlignMode.ALWAYS,r.isAlignTop=!0,r.top=0,r.isAlignLeft=!0,r.left=0;var l=s.addComponent(cc.Sprite);this.setSpriteFrame(l,e.backBtnTexture),AVG_EDITOR||s.on(cc.Node.EventType.TOUCH_END,function(){t.destroy(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PauseStory,!1)});for(var d=e.buttons.items,u=0;u<d.length;u++){var h=d[u];if(this._enabledUIButton(h)){var g=this._createUiCoverButton(e.buttons.normalTexture,e.buttons.pressTexture,h);this.setHitTestFlag(g,!0,!1,{pos:!0,size:!1}),this.setOwn(g,t),o.addChild(g)}}return t.avgSyncData=e,t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));if(this.setSpriteFrame(n,e.bg.texture,{width:e.bg.size.width,height:e.bg.size.height},function(){}),e.style===AvgData.Type.UiCoverStyle.Custom)o.setPosition(e.buttons.position.x,e.buttons.position.y);else{var i=o.getComponent(cc.Widget);i||(i=o.addComponent(cc.Widget)),i.alignMode=cc.Widget.AlignMode.ALWAYS,e.style===AvgData.Type.UiCoverStyle.Default&&(i.isAlignLeft=!0,i.left=80,i.isAlignBottom=!0,i.bottom=80),setTimeout(function(){o.removeComponent(i)},100)}for(var a=o.children,c=0;c<a.length;c++){var s=a[c];s.updateTexture&&s.updateTexture(e)}}.bind(this),t.avgSyncData2Node(),t.avgSyncNode2Data=function(){this.syncNode2Data(t);var e=t.avgSyncData;e.style=AvgData.Type.UiCoverStyle.Custom,e.buttons.position=o.getPosition()}.bind(this),e.uuid=t.uuid,t},_createUiEnvItem:function(e,t){var i=new cc.Node;i.height=40;var n=new cc.Node("title");n.color=cc.color("#333333"),i.addChild(n),n.setPosition(-156,0);var o=n.addComponent(cc.Label);o.string=t.text,o.fontSize=25,o.lineHeight=28,o.horizontalAlign=cc.Label.HorizontalAlign.CENTER,o.verticalAlign=cc.Label.VerticalAlign.CENTER;var a=new cc.Node;i.addChild(a);var c=a.addComponent(cc.Slider);c.Direction=cc.Slider.Direction.Horizontal;var s=a.addComponent(cc.ProgressBar),r=a.addComponent(cc.Sprite);this.setSpriteFrame(r,e.progress1,null,function(e,t){s.totalLength=e});var l=new cc.Node("bar");a.addChild(l);var d=l.addComponent(cc.Sprite);d.SizeMode=cc.Sprite.SizeMode.CUSTOM,d.type=cc.Sprite.Type.TILED,s.barSprite=d,this.setSpriteFrame(d,e.progress2,null,function(){if(AVG_EDITOR)setTimeout(function(){s.progress=c.progress=.5},100);else{a.addComponent("UiEnv").setData(t);var e=new cc.Component.EventHandler;e.target=a,e.component="UiEnv",e.handler="onButtonClick",e.customEventData=t,c.slideEvents.push(e)}});var u=l.addComponent(cc.Widget);u.alignMode=cc.Widget.AlignMode.ALWAYS,u.isAlignLeft=!0,u.left=0;var h=new cc.Node("HandleNode");a.addChild(h);var g=h.addComponent(cc.Sprite);this.setSpriteFrame(g,e.progressButton);var p=h.addComponent(cc.Button);return c.handle=p,i},_createUiEnv:function(e){var t=new cc.Node(a.UiMenu.type);this._createUiBottom(t),t.setContentSize(e.size.width,e.size.height),t.addComponent(cc.BlockInputEvents),this.setHitTestFlag(t,!0,!0,{pos:e.lockPos,size:!0});var i=new cc.Node("bg");t.addChild(i,1);var n=i.addComponent(cc.Sprite),o=new cc.Node("title");o.color=cc.color("#333333"),t.addChild(o,2),o.setPosition(0,260);var c=o.addComponent(cc.Label);c.string="\u73af\u5883\u8bbe\u7f6e",c.fontSize=40,c.lineHeight=42,c.horizontalAlign=cc.Label.HorizontalAlign.CENTER,c.verticalAlign=cc.Label.VerticalAlign.CENTER;var s=new cc.Node("set-board-frame"),r=s.addComponent(cc.Sprite);t.addChild(s,3);var l=new cc.Node("layout-node");s.addChild(l);var d=l.addComponent(cc.Layout);d.type=cc.Layout.Type.VERTICAL,d.resizeMode=cc.Layout.ResizeMode.CONTAINER,d.spacingY=10;for(var u=0;u<e.sets.items.length;u++){var h=e.sets.items[u],g=this._createUiEnvItem(e.sets,h);h.type===AvgData.Type.UiButton.EnvSetTalkSpeed&&(g.active=!1),l.addChild(g)}var p=new cc.Node("backNode");t.addChild(p,4);var f=p.addComponent(cc.Widget);f.alignMode=cc.Widget.AlignMode.ALWAYS,f.isAlignTop=!0,f.top=0,f.isAlignLeft=!0,f.left=0;var v=p.addComponent(cc.Sprite);return this.setSpriteFrame(v,e.backBtnTexture),AVG_EDITOR||p.on(cc.Node.EventType.TOUCH_END,function(){t.destroy()}),t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));this.setSpriteFrame(n,e.bg.texture,{width:e.bg.size.width,height:e.bg.size.height},function(){}),this.setSpriteFrame(r,e.sets.boardTexture,e.sets.boardSize),s.setPosition(e.sets.position.x,e.sets.position.y)}.bind(this),t.avgSyncData=e,t.avgSyncData2Node(),t.avgSyncNode2Data=function(){this.syncNode2Data(t);var e=t.avgSyncData;e.sets.position.x=s.x,e.sets.position.y=s.y}.bind(this),e.uuid=t.uuid,t},_createUiFileItem:function(e,t){var i=new cc.Node,n=i.addComponent(cc.Sprite),o=new cc.Node("icon"),a=o.addComponent(cc.Sprite);o.y=25,i.addChild(o);var c=new cc.Node("name-node");c.setAnchorPoint(cc.v2(0,.5)),i.addChild(c),c.x=-92,c.y=-41,c.color=cc.color("#333333");var s=c.addComponent(cc.Label);s.fontSize=16,s.lineHeight=18,s.string=e.name,s.horizontalAlign=cc.Label.HorizontalAlign.CENTER,s.verticalAlign=cc.Label.VerticalAlign.CENTER;var r=new cc.Node("time-node");r.x=-92,r.y=-63,r.setAnchorPoint(cc.v2(0,.5)),i.addChild(r),r.color=cc.color("#333333");var l=r.addComponent(cc.Label);if(l.string=e.time,l.horizontalAlign=cc.Label.HorizontalAlign.CENTER,l.verticalAlign=cc.Label.VerticalAlign.CENTER,l.fontSize=16,l.lineHeight=18,i.updateTexture=function(t){var o=t.lists;if(this.setSpriteFrame(n,o.normalTexture,e.size),this.addButtonTexture(i,o.normalTexture,o.pressTexture),this.setSpriteFrame(a,o.iconTexture,o.iconSize),o.font){var d=o.font.size,u=o.font.color;l.fontSize=d,l.lineHeight=d+2,r.color=cc.color(u),s.fontSize=d,s.lineHeight=d+2,c.color=cc.color(u)}}.bind(this),i.updateTexture(t),!AVG_EDITOR){var d=i.addComponent("UiFileItem");d.timeLabel=l,d.nameLabel=s,d.iconSprite=a,d.setUiFileItemData(e)}return i},_createUiFileMgr:function(e){var t=new cc.Node(a.UiFileMgr.type);this._createUiBottom(t),t.setContentSize(e.size.width,e.size.height),t.addComponent(cc.BlockInputEvents),this.setHitTestFlag(t,!0,!0,{pos:e.lockPos,size:!0});var i=new cc.Node("bg");t.addChild(i,1);var n=i.addComponent(cc.Sprite),o=new cc.Node("title");o.color=cc.color("#333333"),t.addChild(o,2),o.setPosition(0,260);var c=o.addComponent(cc.Label);c.string="\u6863\u6848\u7ba1\u7406",c.fontSize=40,c.lineHeight=42,c.horizontalAlign=cc.Label.HorizontalAlign.CENTER,c.verticalAlign=cc.Label.VerticalAlign.CENTER;var s=new cc.Node("backNode");t.addChild(s,3);var r=s.addComponent(cc.Widget);r.alignMode=cc.Widget.AlignMode.ALWAYS,r.isAlignLeft=!0,r.left=0,r.isAlignTop=!0,r.top=0;var l=s.addComponent(cc.Sprite);this.setSpriteFrame(l,e.backBtnTexture),AVG_EDITOR||s.on(cc.Node.EventType.TOUCH_END,function(){t.destroy()});var d=new cc.Node("list-node");t.addChild(d,4),d.width=700;for(var u=e.lists.items,h=0;h<u.length;h++){var g=u[h],p=this._createUiFileItem(g,e);d.addChild(p)}var f=d.addComponent(cc.Layout);return f.type=cc.Layout.Type.GRID,f.resizeMode=cc.Layout.ResizeMode.CONTAINER,f.startAxis=cc.Layout.AxisDirection.HORIZONTAL,f.spacingX=35,f.spacingY=25,t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));this.setSpriteFrame(n,e.bg.texture,{width:e.bg.size.width,height:e.bg.size.height},function(){}),d.setPosition(e.lists.position.x,e.lists.position.y);for(var i=d.children,o=0;o<i.length;o++){var a=i[o];a.updateTexture&&a.updateTexture(e)}}.bind(this),t.avgSyncData=e,t.avgSyncData2Node(),t.avgSyncNode2Data=function(){this.syncNode2Data(t),t.avgSyncData.lists.position=d.getPosition()}.bind(this),e.uuid=t.uuid,t},_createUiCoverButton:function(e,t,i){var n=new cc.Node("button"),o=n.addComponent(cc.Sprite);this.setSpriteFrame(o,e,i.size),this.addButtonTexture(n,e,t);var a=i.position;n.setPosition(a.x,a.y);var c=new cc.Node("button-label");c.color=cc.color("#333333");var s=c.addComponent(cc.Label);return s.fontSize=40,s.lineHeight=42,s.horizontalAlign=cc.Label.HorizontalAlign.CENTER,s.verticalAlign=cc.Label.VerticalAlign.CENTER,n.addChild(c),n.updateTexture=function(e){var t=e.buttons;this.setSpriteFrame(o,t.normalTexture,i.size),t.normalTexture===AvgData.DefaultValue.UiButtonNormalTexture?s.string=i.text:s.string="",t.font&&(c.color=cc.color(t.font.color),s.fontSize=t.font.size,s.lineHeight=t.font.size+2)}.bind(this),AVG_EDITOR||n.on(cc.Node.EventType.TOUCH_END,function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.UiButtonClick,i.type)}),n},_createUiBottom:function(e){AVG_EDITOR||cc.loader.loadRes(T.PreloadPrefab.prefabs.QTEMask.url,function(t,i){if(!t&&e.isValid){var n=cc.instantiate(i);e.addChild(n,0);var o=cc.view.getVisibleSize();n.width=o.width,n.height=o.height,n.color=cc.Color.BLACK,n.opacity=255,n.name="ui-mask-node",n.getComponent(cc.BlockInputEvents)||n.addComponent(cc.BlockInputEvents)}})},_enabledUIButton:function(e){var t=e.type;return t!==AvgData.Type.UiButton.CoverSet&&t!==AvgData.Type.UiButton.MenuSet},_createUiCover:function(e){var t=new cc.Node(a.UiCover.type);this._createUiBottom(t),t.setContentSize(e.size.width,e.size.height),t.addComponent(cc.BlockInputEvents),this.setHitTestFlag(t,!0,!0,{pos:e.lockPos,size:!0});var i=new cc.Node("bg");t.addChild(i,1);var n=i.addComponent(cc.Sprite),o=new cc.Node("buttons");this.setOwn(o,t),this.setHitTestFlag(o,!0,!1,{pos:!1,size:!0}),t.addChild(o,2);var c=o.addComponent(cc.Layout);c.type=cc.Layout.Type.VERTICAL,c.resizeMode=cc.Layout.ResizeMode.CONTAINER,c.spacingY=20;for(var s=e.buttons.items,r=0;r<s.length;r++){var l=s[r];if(this._enabledUIButton(l)){var d=this._createUiCoverButton(e.buttons.normalTexture,e.buttons.pressTexture,l);this.setHitTestFlag(d,!0,!1,{pos:!0,size:!1}),this.setOwn(d,t),o.addChild(d)}}return t.avgSyncData=e,t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));if(this.setSpriteFrame(n,e.bg.texture,{width:e.bg.size.width,height:e.bg.size.height},function(){}),e.style===AvgData.Type.UiCoverStyle.Custom)o.setPosition(e.buttons.position.x,e.buttons.position.y);else{var i=o.getComponent(cc.Widget);i||(i=o.addComponent(cc.Widget)),i.alignMode=cc.Widget.AlignMode.ALWAYS,e.style===AvgData.Type.UiCoverStyle.Default&&(i.isAlignLeft=!0,i.left=80,i.isAlignBottom=!0,i.bottom=80),setTimeout(function(){o.removeComponent(i)},100)}for(var a=o.children,c=0;c<a.length;c++){var s=a[c];s.updateTexture&&s.updateTexture(e)}}.bind(this),t.avgSyncData2Node(),t.avgSyncNode2Data=function(){this.syncNode2Data(t);var e=t.avgSyncData;e.style=AvgData.Type.UiCoverStyle.Custom,e.buttons.position=o.getPosition()}.bind(this),e.uuid=t.uuid,t},_createImage:function(e){var t=new cc.Node("image");this.setHitTestFlag(t,!0,!1,{pos:e.lockPos});var i=t.addComponent(cc.Sprite);return t.avgSyncData=e,t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData)),n=e.size.width,o=e.size.height;this.setNodeBaseProperty(t,e),e.sizeMode===cc.Sprite.SizeMode.CUSTOM?this.setSpriteFrame(i,e.texture,{width:n,height:o}):(e.sizeMode,cc.Sprite.SizeMode.TRIMMED,this.setSpriteFrame(i,e.texture,null))}.bind(this),t.avgSyncData2Node(),t.avgSyncNode2Data=function(){this.syncNode2Data(t)}.bind(this),e.uuid=t.uuid,this.addBlockInputEventsInEditorEnv(t),t},addBlockInputEventsInEditorEnv:function(e){AVG_EDITOR&&e&&(e.getComponent(cc.BlockInputEvents)||e.addComponent(cc.BlockInputEvents))},setHitTestFlag:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;e&&(e.hitTestSelf=t,e.hitTestChildren=i,void 0===n&&(n={pos:!1,size:!1}),e.lockOptions={pos:n.pos,size:n.size})},_testCode:function(){var e=avgSyncData.file;AVG_EDITOR&&(e=Editor.Url("project://".concat(e))),cc.loader.loadRes("particle/rain.plist",cc.ParticleAsset,function(t,i){if(t);else{var n=rootNode.getComponent(cc.ParticleSystem);n||(n=rootNode.addComponent(cc.ParticleSystem)),n._plistFile=e,n._initWithDictionary(i)}}.bind(this))},_createVideoPlot:function(e){var t=new cc.Node(a.VideoPlot.type);this.setHitTestFlag(t,!0,!1,{size:!0,pos:!0});var i=t.addComponent("MoviePlayer");return i.initMoviePlayer(e),t.avgSyncData=e,t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData)),n=e.size.width,o=e.size.height;this.setNodeBaseProperty(t,e),t.setContentSize(cc.size(n,o)),i.updateVideoSrc(e),i.updateZIndex()}.bind(this),t.avgSyncData2Node(),t.avgSyncNode2Data=function(){this.syncNode2Data(t),i.updateZIndex()}.bind(this),e.uuid=t.uuid,this.addBlockInputEventsInEditorEnv(t),t},_createHelperSceneNode:function(e){var t=new cc.Node("node");return t.avgSyncData=e,t.avgSyncNode2Data=function(){},t.avgSyncData2Node=function(){},QuickInsert.addInsertSceneBtn(t,e),t},_createHelperRoleNode:function(e){var t=new cc.Node("node");return t.avgSyncData=e,t.avgSyncNode2Data=function(){},t.avgSyncData2Node=function(){},QuickInsert.addInsertRoleBtn(t,e),t},_createQTE:function(e){var t=new cc.Node("qte");this.setHitTestFlag(t,!0,!0,{size:!0,pos:!1}),t.avgSyncData=e;var i=new cc.Node("qte-root-node");t.addChild(i,3),this.setHitTestFlag(i,!0,!1,{size:!1,pos:!1}),this.setOwn(i,t);var n=t.addComponent("QTE");n.createQTE(e,i,function(e){});var o=n.createQTELabelNode(e);return this._addLabelComponent(o),this.setHitTestFlag(o,!0,!1,{size:!0,position:!1}),this.setOwn(o,t),t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));this.setSubElementData(i,e.qte),this.setSubElementData(o,e.tips);var a=n.calcQTENodeNewSize(e);e.qte.size={width:a.width,height:a.height},this.setNodeBaseProperty(t,e),i.setContentSize(a.width,a.height),i.setPosition(e.qte.position.x,e.qte.position.y),e.mask.active?this.setHitTestFlag(t,!0,!0,{size:!0,pos:!0}):this.setHitTestFlag(t,!0,!0,{size:!0,pos:!1}),n.updateQTE(e)}.bind(this),t.avgSyncData2Node(),t.avgSyncNode2Data=function(){var e=t.avgSyncData;this.syncNode2Data(t),e.qte.position={x:i.x,y:i.y},e.qte.size={width:i.width,height:i.height},n._updateQTENode(e),n.updateQTEMask(e.mask),e.tips.position&&(e.tips.position.x=o.x,e.tips.position.y=o.y)}.bind(this),e.uuid=t.uuid,this.addBlockInputEventsInEditorEnv(t),t},_createValueJudge:function(e){var t=new cc.Node("value-judge");return this.setHitTestFlag(t,!0,!1,{size:!0,pos:!0}),t.avgSyncData=e,t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));t.id=e.id,t.type=e.type}.bind(this),t.avgSyncNode2Data=function(){}.bind(this),t.avgSyncData2Node(),e.uuid=t.uuid,this.addBlockInputEventsInEditorEnv(t),t},_getEffectPrefab:function(e){var t,i=e.type,n={},c=e.state,s=e.direction;switch(i){case a.EffectRain.type:s===o.EffectDirection.Down.type?(n[o.EffectRainType.small.type]=A.com.rain.down.small,n[o.EffectRainType.middle.type]=A.com.rain.down.middle,n[o.EffectRainType.big.type]=A.com.rain.down.big):s===o.EffectDirection.Left.type?(n[o.EffectRainType.small.type]=A.com.rain.left.small,n[o.EffectRainType.middle.type]=A.com.rain.left.middle,n[o.EffectRainType.big.type]=A.com.rain.left.big):s===o.EffectDirection.Right.type&&(n[o.EffectRainType.small.type]=A.com.rain.right.small,n[o.EffectRainType.middle.type]=A.com.rain.right.middle,n[o.EffectRainType.big.type]=A.com.rain.right.big);break;case a.EffectSnow.type:s===o.EffectDirection.Down.type?(n[o.EffectSnowType.small.type]=A.com.snow.down.small,n[o.EffectSnowType.middle.type]=A.com.snow.down.middle,n[o.EffectSnowType.big.type]=A.com.snow.down.big):s===o.EffectDirection.Left.type?(n[o.EffectSnowType.small.type]=A.com.snow.left.small,n[o.EffectSnowType.middle.type]=A.com.snow.left.middle,n[o.EffectSnowType.big.type]=A.com.snow.left.big):s===o.EffectDirection.Right.type&&(n[o.EffectSnowType.small.type]=A.com.snow.right.small,n[o.EffectSnowType.middle.type]=A.com.snow.right.middle,n[o.EffectSnowType.big.type]=A.com.snow.right.big);break;case a.EffectLeafFall.type:n[o.EffectLeafFallType.small.type]=A.com.leaf.less,n[o.EffectLeafFallType.middle.type]=A.com.leaf.middle,n[o.EffectLeafFallType.big.type]=A.com.leaf.more;break;case a.EffectFog.type:n[o.EffectFogType.small.type]=A.com.fog.slow,n[o.EffectFogType.middle.type]=A.com.fog.common,n[o.EffectFogType.big.type]=A.com.fog.fast;break;case a.EffectLight.type:n[o.EffectLightType.small.type]=A.com.light.style1,n[o.EffectLightType.middle.type]=A.com.light.style2,n[o.EffectLightType.big.type]=A.com.light.style3;break;case a.EffectFire.type:n[o.EffectFireType.less.type]=A.com.fire.less,n[o.EffectFireType.middle.type]=A.com.fire.middle,n[o.EffectFireType.more.type]=A.com.fire.more;break;case a.EffectSpotFire.type:var r=null;r=this._getIsVerticalGame()?A.vertical:A.horizontal,n[o.EffectSpotFireType.less.type]=r.spotFire.small,n[o.EffectSpotFireType.middle.type]=r.spotFire.middle,n[o.EffectSpotFireType.more.type]=r.spotFire.big;break;case a.EffectBoom.type:n[o.EffectBoomType.one.type]=A.com.boom.one,n[o.EffectBoomType.more.type]=A.com.boom.more;break;case a.EffectBloodDown.type:var l=null;l=this._getIsVerticalGame()?A.vertical:A.horizontal,n[o.EffectBloodDownType.less.type]=l.bloodDown.style1,n[o.EffectBloodDownType.middle.type]=l.bloodDown.style2,n[o.EffectBloodDownType.more.type]=l.bloodDown.style3;break;case a.EffectBloodDrip.type:n[o.EffectBloodDripType.less.type]=A.com.bloodDrip.less,n[o.EffectBloodDripType.middle.type]=A.com.bloodDrip.middle,n[o.EffectBloodDripType.more.type]=A.com.bloodDrip.more}return(t=n[c])?cc.log("prefab: ".concat(t)):cc.error("\u672a\u53d1\u73b0\u7279\u6548\u7684prefab"),t},_createEffect:function(e){var t=new cc.Node("Particle_Effect_Node");return this.setHitTestFlag(t,!0,!1,{size:!0,pos:!1}),t.avgSyncData=e,t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));this.setNodeBaseProperty(t,e);var i=this._getEffectPrefab(e);i&&cc.loader.loadRes(i,cc.Prefab,function(i,n){if(i)cc.error(i);else{if(!t.isValid)return;t.destroyAllChildren();var o=cc.instantiate(n);t.EffectNode=o;var a=o.addComponent("ParticleCtrl");a.setAvgEffectData(e),AVG_EDITOR?a.stopPreview():a.showEffect(),o.x=o.y=0,t.addChild(o)}})}.bind(this),t.avgSyncData2Node(),t.avgSyncNode2Data=function(){this.syncNode2Data(t)}.bind(this),e.uuid=t.uuid,this.addBlockInputEventsInEditorEnv(t),t},_createAudio:function(e){var t=new cc.Node("Audio_Node");return this.setHitTestFlag(t,!0,!1,{size:!0,pos:!0}),t.avgSyncData=e,t.avgSyncData2Node=function(){JSON.parse(JSON.stringify(t.avgSyncData));t.id=e.id,t.type=e.type}.bind(this),t.avgSyncData2Node(),t.avgSyncNode2Data=function(){}.bind(this),e.uuid=t.uuid,this.addBlockInputEventsInEditorEnv(t),t},_createPlotJump:function(e){var t=new cc.Node("Plot_Jump_Node");return this.setHitTestFlag(t,!0,!1,{size:!0,pos:!0}),t.avgSyncData=e,t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));t.id=e.id,t.type=e.type}.bind(this),t.avgSyncData2Node(),t.avgSyncNode2Data=function(){}.bind(this),e.uuid=t.uuid,this.addBlockInputEventsInEditorEnv(t),t},_createMenuItem:function(e,t){var i=this,n=new cc.Node("Plot_Menu_Item"),o=n.addComponent(cc.Sprite);n.addComponent(cc.BlockInputEvents),this.setHitTestFlag(n,!1,!1,{size:!0,pos:!0});var a=new cc.Node("label"),c=this._addLabelComponent(a);return n.addChild(a),n.isPlotMenuFlag=!0,this.setSubElementData(n,e),n.updateMenuItem=function(e,t){i.setSubElementData(n,e);var s=t.itemFont;s&&c.updateLabelByFontInfo(s,cc.Label.Overflow.RESIZE_HEIGHT);var r=t.textureNormal,l=cc.size(e.size.width,e.size.height);n.setContentSize(l),a.setContentSize(l),c.string=e.text,i.setSpriteFrame(o,r,e.size),n.setPosition(e.position.x,e.position.y)},AVG_EDITOR&&Editor.Ipc.emit(Editor.Msg.Editor.OnPlotMenuItemCreate,e),n},_getPlotMenuItems:function(e){for(var t=[],i=0;i<e.children.length;i++){var n=e.children[i];n.isPlotMenuFlag&&t.push(n)}return t},resetAllElementPosition:function(e){if(e.parent){e.width=0,e.height=0;var t=e.getBoundingBoxToWorld();e.width=t.width,e.height=t.height;for(var i=cc.v2(t.x+t.width/2,t.y+t.height/2),n=0;n<e.children.length;n++){var o=e.children[n];o.oldWordPosition=e.convertToWorldSpaceAR(o.getPosition())}var a=e.parent.convertToNodeSpaceAR(i);e.setPosition(a);for(var c=0;c<e.children.length;c++){var s=e.children[c],r=e.convertToNodeSpaceAR(s.oldWordPosition);s.setPosition(r)}}},setSubElementData:function(e,t){e.subData=t},_createPlotMenu:function(e,t){var i=new cc.Node(a.PlotMenu.type);this.setHitTestFlag(i,!0,!0,{size:!0,pos:e.lockPos});var n=new cc.Node("limit-node"),o=n.addComponent(cc.Sprite);this.setHitTestFlag(n,!0,!1),i.addChild(n);var c=new cc.Node("limit-time-node"),r=this._addLabelComponent(c);n.addChild(c),this.setOwn(n,i);var l=i.addComponent("StoryMenu");return AVG_EDITOR||l&&(l.initLimit(r,n),l.setPlotMenuData(e,t)),i.avgSyncData=e,i.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(i.avgSyncData));this.setNodeBaseProperty(i,e);var a=e.limit;r.string="".concat(a.time,"s"),r.updateLabelByFontInfo(a.font),n.active=!!a.enabled,n.setPosition(a.position.x,a.position.y);var c=a.size.width,d=a.size.height;n.setContentSize(c,d),this.setSpriteFrame(o,a.bg,{width:c,height:d}),this.setSubElementData(n,a);var u=this._getPlotMenuItems(i),h=u.length,g=e.items.length;if(h>=g)for(var p=g;p<h;p++){var f=u[p];AVG_EDITOR&&Editor.Ipc.emit(Editor.Msg.Editor.OnPlotMenuItemDestroy,f.subData),f.destroy(),f.removeFromParent(!0),f.isPlotMenuFlag=!1}else for(var v=0;v<g-h;v++){var y=new s,m=this._createMenuItem(y,t);this.setOwn(m,i),this.setHitTestFlag(m,!0,!1),i.addChild(m)}u=this._getPlotMenuItems(i);for(var _=0;_<g;++_){var A=u[_],b=e.items[_];A.updateMenuItem(b,e);var S=A.getComponent("StoryMenuItem");S||(S=A.addComponent("StoryMenuItem")),S&&(this.addButtonTexture(S.node,e.textureNormal,e.texturePress),S.updatePlotMenuItemData(b,t),S.storyMenuScript=l)}}.bind(this),i.avgSyncData2Node(),i.avgSyncNode2Data=function(){this.syncNode2Data(i);var e=i.avgSyncData;e.items=this._getAllPlotItemData(i),e.limit.size.width=n.width,e.limit.size.height=n.height,e.limit.position.x=n.x,e.limit.position.y=n.y}.bind(this),e.uuid=i.uuid,this.addBlockInputEventsInEditorEnv(i),i},_getAllPlotItemData:function(e){for(var t=[],i=this._getPlotMenuItems(e),n=0;n<i.length;n++){var o=i[n];o.subData.size.width=o.width,o.subData.size.height=o.height,o.subData.position.x=o.x,o.subData.position.y=o.y,t.push(o.subData)}return t},setLabelFont:function(e,t){this.loadFont(t,function(t){e&&(e.fontFamily=t)})},loadFont:function(t,i){if(t===AvgData.Type.FontType.Font0.font)i&&i("arial");else{var n=null;AVG_EDITOR?Editor.AssetDB.isValidByUUID(t)?n="project://".concat(Editor.AssetDB.uuidToPath(t)):console.warn("load font failed:".concat(t)):n=e("Assets").getUrlByUUID(t),n?cc.loader.load(n,function(e,t){e?console.error(e):i&&i(t)}):i&&i("arial")}},_addLabelComponent:function(e){var t=e.getComponent(cc.Label);t||(t=e.addComponent(cc.Label));var i=e.getComponent(cc.LabelOutline);return i||(i=e.addComponent(cc.LabelOutline)),i.width=.5,i.enabled=!1,t.updateLabelByFontInfo=function(n,o){if(n){this.setLabelFont(t,n.family),t.verticalAlign=cc.Label.VerticalAlign.CENTER,t.overflow=o||cc.Label.Overflow.NONE,i.color=e.color=cc.color(n.color),i.enabled=!!n.bold,n.italic?e.skewX=15:e.skewX=0,t.enableUnderline=!!n.underline,t._underlineThickness=2,n.align===AvgData.Type.TextAlign.Left?t.horizontalAlign=cc.Label.HorizontalAlign.LEFT:n.align===AvgData.Type.TextAlign.Center?t.horizontalAlign=cc.Label.HorizontalAlign.CENTER:n.align===AvgData.Type.TextAlign.Right?t.horizontalAlign=cc.Label.HorizontalAlign.RIGHT:t.horizontalAlign=cc.Label.HorizontalAlign.CENTER,t.fontSize=n.size;var a=n.size;if(n.line)a=a*parseFloat(n.line.toString())+5;else a+=5;t.lineHeight=a}}.bind(this),t},_createPasswordLock:function(e){var t=new cc.Node(a.PasswordLock.type);this.setHitTestFlag(t,!0,!1,{pos:e.lockPos,size:!1}),t.avgSyncData=e;t.addComponent(cc.Sprite);var i=t.addComponent("PasswordLockBox");return t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));this.setNodeBaseProperty(t,e),i.setPwdLockBoxData(e)}.bind(this),t.avgSyncData2Node(),t.avgSyncNode2Data=function(){t.avgSyncData;this.syncNode2Data(t)}.bind(this),e.uuid=t.uuid,this.addBlockInputEventsInEditorEnv(t),t},_createText:function(e){var t=this,i=new cc.Node(a.Text.type),n=this._addLabelComponent(i);return this.setHitTestFlag(i,!0,!1,{pos:e.lockPos,size:!0}),i.avgSyncData=e,i.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(i.avgSyncData));if(this.setNodeBaseProperty(i,e),n.updateLabelByFontInfo(e.textFont,cc.Label.Overflow.NONE),e.direction===AvgData.Type.Text.DirectionHorizontal)n.string=e.string;else if(e.direction===AvgData.Type.Text.DirectionVertical){for(var t="",o=e.string.length,a=0;a<o-1;a++)t+=e.string[a]+"\n";t+=e.string[o-1],n.string=t}}.bind(this),i.avgSyncData2Node(),i.avgSyncNode2Data=function(){var e=i.avgSyncData;this.syncNode2Data(i),e.textFont.size=n.fontSize,e.textFont.color=i.color.toCSS("#rrggbb")}.bind(this),e.uuid=i.uuid,this.addBlockInputEventsInEditorEnv(i),AVG_EDITOR&&i.on(cc.Node.EventType.SIZE_CHANGED,function(){t.syncNode2Data(i),Editor.Scene.Svg.SceneNode.updateSvg()}),i},setOwn:function(e,t){e.own=t},upgradeTalkData:function(e){var t=e.roleName.bg.size;if(!t||0===t.width&&0===t.height){var i=new l;this._getIsVerticalGame()?i.resetWithVertical():i.resetWithHorizontal(),e.roleName.bg.size=i.roleName.bg.size}},_getIsVerticalGame:function(){if(AVG_EDITOR)return Editor.Set.isVerticalMode();var e=cc.view.getDesignResolutionSize();return e.width<e.height},addButtonTexture:function(e,t,i){if(!AVG_EDITOR){var n=e.getComponent(cc.Button);n||(n=e.addComponent(cc.Button)),n.transition=cc.Button.Transition.SPRITE,this._loadRes(t,function(e){n.normalSprite=e}),this._loadRes(i,function(e){n.pressedSprite=e})}},_loadRes:function(e,t){var i=this._getUrlByUUID(e);i&&cc.loader.load(i,function(e,i){if(e)cc.error(e);else{var n=new cc.SpriteFrame(i);t&&t(n)}})},_createPhoneIM:function(e){var t=this,i=this.PreloadPrefab.prefabs.PhoneIM.prefab,n=cc.instantiate(i);n.name=a.PhoneIM.type,this.setHitTestFlag(n,!0,!0,{size:!0,pos:e.lockPos});var o=n.getComponent("PhoneIM");return this.setHitTestFlag(o.closeBtnNode,!0,!1),this.setOwn(o.closeBtnNode,n),this.setHitTestFlag(o.bgNode,!0,!1),this.setOwn(o.bgNode,n),this.setHitTestFlag(o.talkScrollView.node,!0,!1),this.setOwn(o.talkScrollView.node,n),n.avgSyncData=e,n.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(n.avgSyncData));t.setNodeBaseProperty(n,e),o.updateView(e),t.setSubElementData(o.closeBtnNode,e.close),t.setSubElementData(o.bgNode,e.bg),t.setSubElementData(o.talkScrollView.node,e.content)},n.avgSyncData2Node(),n.avgSyncNode2Data=function(){var e=n.avgSyncData;t.syncNode2Data(n),t._syncNodePosSize(e.close,o.closeBtnNode),t._syncNodePosSize(e.bg,o.bgNode),t._syncNodePosSize(e.content,o.talkScrollView.node)},e.uuid=n.uuid,this.addBlockInputEventsInEditorEnv(n),n},_syncNodePosSize:function(e,t){e.size.width=t.width,e.size.height=t.height,e.position.x=t.x,e.position.y=t.y},_createTalk:function(e){this.upgradeTalkData(e);var t=new cc.Node(a.Talk.type);this.setHitTestFlag(t,!0,!0,{size:!0,pos:e.lockPos});var i=new cc.Node("talk-bg"),n=i.addComponent(cc.Sprite);this.setHitTestFlag(i,!0,!1),this.setOwn(i,t),t.addChild(i);var o=new cc.Node("talk-text");o.anchorX=0,o.anchorY=1,this.setHitTestFlag(o,!0,!1),this.setOwn(o,t);var c=this._addLabelComponent(o);t.addChild(o);var s=t.addComponent("StoryTalk");s&&(s.word=c);var r=new cc.Node("name-root-node");t.addChild(r),this.setHitTestFlag(r,!0,!1,{size:!1});var l=r.addComponent(cc.Sprite),d=new cc.Node("name-label-node"),u=this._addLabelComponent(d);this.setOwn(r,t),r.addChild(d);var h=new cc.Node("head");this.setOwn(h,t),this.setHitTestFlag(h,!0,!1);var g=h.addComponent(cc.Sprite);return t.addChild(h),t.avgSyncData=e,t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));this.setNodeBaseProperty(t,e);var a=e.head;if(a){h.active=a.active,h.setScale(a.scale.x,a.scale.y),h.setPosition(cc.v2(a.position.x,a.position.y));var s=cc.size(a.size.width,a.size.height);this.setSpriteFrame(g,a.texture,s),this.setSubElementData(h,a)}var p=e.roleName;if(p){d.setContentSize(cc.size(p.size.width||p.bg.size.width,p.size.height||p.bg.size.height)),u.string=p.text.string,u.updateLabelByFontInfo(p.text.font,cc.Label.Overflow.RESIZE_HEIGHT),r.active=!!p.active,l.enabled=!!p.bg.active;var f=cc.v2(p.position.x,p.position.y);r.setPosition(f),this.setSpriteFrame(l,p.bg.texture,p.bg.size),this.setSubElementData(r,p)}var v=e.talk;v&&(i.active=!!v.bg.active,this.setSpriteFrame(n,v.bg.texture,v.size),i.setPosition(v.position.x,v.position.y),c.updateLabelByFontInfo(v.text.font,cc.Label.Overflow.RESIZE_HEIGHT),v.text.position&&o.setPosition(v.text.position.x,v.text.position.y),v.text.size&&o.setContentSize(cc.size(v.text.size.width,v.text.size.height)),c.string=v.text.string,this.setSubElementData(o,v.text),this.setSubElementData(i,v))}.bind(this),t.avgSyncData2Node(),t.avgSyncNode2Data=function(){this.syncNode2Data(t);var e=t.avgSyncData;e.head.size.width=h.width,e.head.size.height=h.height,e.head.position.x=h.x,e.head.position.y=h.y,e.head.active=h.active,e.head.scale.x=h.scaleX,e.head.scale.y=h.scaleY,e.roleName.active=r.active,e.roleName.size={width:r.width,height:r.height},e.roleName.bg.size={width:r.width,height:r.height},e.roleName.position.x=r.x,e.roleName.position.y=r.y,e.roleName.text.string=u.string,e.roleName.text.font.color=d.color.toCSS("#rrggbb"),e.roleName.text.font.size=u.fontSize,e.talk.position={x:i.x,y:i.y},e.talk.bg.active=i.active,e.talk.bg.size=e.talk.size={width:i.width,height:i.height},e.talk.text.string=c.string,e.talk.text.font.size=c.fontSize,e.talk.text.font.color=o.color.toCSS("#rrggbb"),e.talk.text.size={width:o.width,height:o.height},e.talk.text.position={x:o.x,y:o.y}}.bind(this),e.uuid=t.uuid,this.addBlockInputEventsInEditorEnv(t),t},DefaultValue:c});t.exports=window.AvgPlayer=T,cc._RF.pop()},{AVGPrefabPreload:"AVGPrefabPreload",Assets:"Assets",AvgBag:"AvgBag",AvgUI:"AvgUI",GameUtil:"GameUtil",StoryData:"StoryData",StoryPieceAniMgr:"StoryPieceAniMgr"}],AvgServer:[function(e,t,i){"use strict";cc._RF.push(t,"f9b196P/hBB6LfUYK8Rw79H","AvgServer"),t.exports={},cc._RF.pop()},{}],AvgUI:[function(e,t,i){"use strict";cc._RF.push(t,"623430HkplDGaPLkByZvjh4","AvgUI");AvgData.DefaultValue;var n=AvgData.AvgType;t.exports={addAvgBag:function(e){return this._addButton(e,n.AvgBagBtn.type,function(){if(0===GameDB.getBagData().length){var e=new AvgData.FontData;e.color="#ffffff",cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowValueEvenShowText,{text:"\u7269\u54c1\u4e3a\u7a7a,\u5feb\u53bb\u83b7\u5f97~",font:e,backgroundColor:"#000"})}else cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowAvgBagLayer)})},addAvgMenus:function(e){return this._addButton(e,n.AvgMenuBtn.type,function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowAvgMenuLayer)})},_addButton:function(e,t,i){if(!e)return null;var n=this.getAvgMenuBtnData(t);if(!n)return null;var o=new cc.Node(t),a=o.addComponent(cc.Sprite);o.setPosition(n.position.x,n.position.y),o.addComponent(cc.BlockInputEvents);var c=cc.size(n.size.width,n.size.height);return AvgPlayer.setSpriteFrame(a,n.textureNormal,c),AvgPlayer.addButtonTexture(o,n.textureNormal,n.texturePress),AVG_EDITOR||o.on(cc.Node.EventType.TOUCH_END,function(e){e.stopPropagation(),AvgPlayer.setSpriteFrame(a,n.textureNormal,c),i&&i()}),e.addChild(o),o},getAvgMenuBtnData:function(e){var t=null;if(AVG_EDITOR){var i=window.require("fs"),n=AvgData.getUiConfigFiles().entrySet,o=Editor.Url("project://".concat(n));t=JSON.parse(i.readFileSync(o,"utf-8"))}else t=cc.StoryConfig.file.entrySet.data;if(t)for(var a=0;a<t.length;a++){var c=t[a];if(c.type===e)return c}return null},createUiBtn:function(e){var t=new cc.Node;AvgPlayer.setHitTestFlag(t,!0,!1);var i=t.addComponent(cc.Sprite);return t.avgSyncData=e,t.avgSyncData2Node=function(){var e=JSON.parse(JSON.stringify(t.avgSyncData));AvgPlayer.setNodeBaseProperty(t,e),AvgPlayer.setSpriteFrame(i,e.textureNormal,cc.size(e.size.width,e.size.height))},t.avgSyncData2Node(),t.avgSyncNode2Data=function(){AvgPlayer.syncNode2Data(t)},e.uuid=t.uuid,t}},cc._RF.pop()},{}],BagGetItems:[function(e,t,i){"use strict";cc._RF.push(t,"c7371VlNMhHM5/1hLhuotxP","BagGetItems");var n=null;cc.Class({extends:cc.Component,properties:{bgSprite:cc.Sprite,testNode:[cc.Node],titleNode:cc.Node,jumpBtn:cc.Sprite,itemArray:[e("GoodsItem")],tipsNode:cc.Node},onLoad:function(){for(var e=this,t=0;t<this.testNode.length;t++)this.testNode[t].destroy();n=this,AVG_EDITOR?Editor.Ipc.on(Editor.Msg.Editor.GoodsUpdateToEngine,this._onListenerGoodsUpdate):this.jumpBtn.node.on(cc.Node.EventType.TOUCH_END,function(){e.node.destroy(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.JumpBagListAndSelectGoods,e._itemData)})},_onListenerGoodsUpdate:function(){n&&n.updateBagGetItemsInEditor()},onDestroy:function(){AVG_EDITOR&&Editor.Ipc.off(Editor.Msg.Editor.GoodsUpdateToEngine,this._onListenerGoodsUpdate)},start:function(){},createTips:function(){var e=AvgPlayer.PreloadPrefab.prefabs.BagEditorTips.prefab;AVG_EDITOR&&e&&!this.tipsNode&&(this.tipsNode=cc.instantiate(e),this.tipsNode.active=!1,this.tipsNode.setPosition(0,0),this.node.addChild(this.tipsNode))},_enableView:function(e){this.itemArray.forEach(function(t){t.node.active=e}),this.titleNode.active=e,this.jumpBtn.node.active=e,this.tipsNode&&(this.tipsNode.active=!e)},updateBagGetItemsInEditor:function(){if(this.avgData){var e=[],t=this.avgData.itemCount,i=Editor.Goods.data.goods;if(0===i.length)this._enableView(!1);else{if(this._enableView(!0),i.length>=t)for(var n=0;n<t;n++)e.push(i[n]);else for(var o=0;o<t;o++)i[o]?e.push(i[o]):e.push(i[i.length-1]);var a=[];e.forEach(function(e){a.push({cfg:e,num:99})}),this._updateItems(a)}}},_updateItems:function(e){this._itemData=e;for(var t=0;t<this.itemArray.length;t++){var i=this.itemArray[t],n=e[t];i.setGoodsItemData(n.cfg),i.setGoodsItemNum(n.num)}},setGetItemsData:function(e){this._itemData=e,this._updateItems(e)},setBagGetItemsAvgData:function(e){this.avgData=e;var t=e.bg;this.bgSprite.node.setPosition(t.position.x,t.position.y),AvgPlayer.setSpriteFrame(this.bgSprite,t.texture,cc.size(t.size.width,t.size.height));var i=e.title;this.titleNode.setPosition(i.position.x,i.position.y);var n=e.jumpBtn;this.jumpBtn.node.setPosition(n.position.x,n.position.y),AvgPlayer.setSpriteFrame(this.jumpBtn,n.textureNormal,cc.size(n.size.width,n.size.height))}}),cc._RF.pop()},{GoodsItem:"GoodsItem"}],BagItemDetails:[function(e,t,i){"use strict";cc._RF.push(t,"384f9nXDdtLyaSs4uJgbDbT","BagItemDetails");var n=null,o=AvgData.Type.UiItemDetailsType;cc.Class({extends:cc.Component,properties:{tipsNode:cc.Node,bgNode:cc.Node,useBtnSprite:cc.Sprite,playBtnSprite:cc.Sprite,nameLabel:cc.Label,iconSprite:cc.Sprite,descLabel:cc.Label,descNode:cc.Node,numberBgNode:cc.Node,numberLabel:cc.Label},onLoad:function(){var e=this;this.isClosing=!1,n=this,AVG_EDITOR?Editor.Ipc.on(Editor.Msg.Editor.GoodsUpdateToEngine,this._onListenerGoodsUpdate):(this.useBtnSprite.node.on(cc.Node.EventType.TOUCH_END,function(e){e.stopPropagation(),console.log("useBtn")}),this.playBtnSprite.node.on(cc.Node.EventType.TOUCH_END,function(t){if(t.stopPropagation(),e._itemData&&e._itemData.cfg){var i=e._itemData.cfg;i.displayType!==AvgData.Type.Goods.Display.None.type?cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.BagItemDisplay,i):cc.log("\u8be5\u7269\u54c1\u8bbe\u7f6e\u7684\u4e0d\u5c55\u793a")}}))},_onListenerGoodsUpdate:function(){n&&n.updateBagItemDetailsInEditor()},onDestroy:function(){AVG_EDITOR&&Editor.Ipc.off(Editor.Msg.Editor.GoodsUpdateToEngine,this._onListenerGoodsUpdate)},start:function(){},_enableContent:function(e){this.bgNode.active=!0,this.descNode.active=e,this.iconSprite.node.active=e,this.useBtnSprite.node.active=e,this.playBtnSprite.node.active=e,this.nameLabel.node.active=e,this.numberBgNode.active=e,this.tipsNode.active=!e},updateBagItemDetailsInEditor:function(){var e=Editor.Goods.data;e.goods.length>=1?(this._enableContent(!0),this._setGoodsData(e.goods[0]),this._setGoodsNum(99)):this._enableContent(!1)},setBagItemDetailsData:function(e){this._itemData=e,this._setGoodsNum(e.num),this._setGoodsData(e.cfg)},updateBagItemDetails:function(e){this._setDetailsStyle(e)},_setGoodsNum:function(e){this.numberBgNode.active=e>0,e>99&&(e="99+"),this.numberLabel.string=e},_setGoodsData:function(e){var t=this.avgData.icon;AvgPlayer.setSpriteFrame(this.iconSprite,e.iconBig,cc.size(t.size.width,t.size.height)),this.nameLabel.string=e.name,this.descLabel.string=e.desc,e.use&&e.use.enabled?this.useBtnSprite.node.active=!0:this.useBtnSprite.node.active=!1,this.playBtnSprite.node.active=e.displayType!==AvgData.Type.Goods.Display.None.type},_setDetailsStyle:function(e){this.avgData=e;var t=e.bg,i=this.bgNode.getComponent(cc.Sprite);AvgPlayer.setSpriteFrame(i,t.texture,cc.size(t.size.width,t.size.height)),this.bgNode.setPosition(t.position.x,t.position.y);var n=e.icon;this.iconSprite.node.setPosition(n.position.x,n.position.y);var o=e.itemNum.bgColor,a=e.itemNum;this.numberBgNode.color=cc.color(o),this.numberBgNode.setPosition(a.position.x,a.position.y);var c=cc.size(a.size.width,a.size.height);this.numberBgNode.setContentSize(c);AvgPlayer._addLabelComponent(this.numberLabel.node);this.numberLabel.node.setContentSize(c),this.numberLabel.updateLabelByFontInfo(a.font,cc.Label.Overflow.RESIZE_HEIGHT);var s=e.itemName;this.nameLabel.node.setPosition(s.position.x,s.position.y),AvgPlayer._addLabelComponent(this.nameLabel.node),this.nameLabel.updateLabelByFontInfo(s.font,cc.Label.Overflow.RESIZE_HEIGHT),this.nameLabel.node.setContentSize(cc.size(s.size.width,s.size.height));var r=e.itemDesc;this.descNode.setPosition(r.position.x,r.position.y),this.descNode.setContentSize(cc.size(r.size.width,r.size.height)),AvgPlayer._addLabelComponent(this.descLabel.node),this.descLabel.updateLabelByFontInfo(r.font,cc.Label.Overflow.RESIZE_HEIGHT);var l=e.playBtn;this.playBtnSprite.node.setPosition(l.position.x,l.position.y),AvgPlayer.setSpriteFrame(this.playBtnSprite,l.textureNormal,cc.size(l.size.width,l.size.height)),AvgPlayer.addButtonTexture(this.playBtnSprite.node,l.textureNormal,l.texturePress);var d=e.useBtn;this.useBtnSprite.node.setPosition(d.position.x,d.position.y),AvgPlayer.setSpriteFrame(this.useBtnSprite,d.textureNormal,cc.size(d.size.width,d.size.height)),AvgPlayer.addButtonTexture(this.useBtnSprite.node,d.textureNormal,d.texturePress)},onShowDetailsAction:function(){var e=this.avgData;if(e&&e.popUp){var t=e.popUp,i=this._getActionPosition(t.direction),n=t.time||.5;if(t.type===o.PopUp.PopUp.type){this.node.opacity=255,this.node.setPosition(i.start);var a=cc.moveTo(n,i.end);this.node.runAction(a.easing(cc.easeBounceOut()))}else t.type===o.PopUp.FadeIn.type?(this.node.opacity=10,this.node.runAction(cc.fadeIn(n))):t.type===o.PopUp.None.type&&this.node.setPosition(i.end)}},setBlockNode:function(e){this.blockNode=e},onCloseDetailsAction:function(e,t){var i=this;e||(this.isClosing=!1,t&&t(),this.blockNode&&this.blockNode.destroy());var n=this.avgData;if(n&&n.takeBack){var a=n.takeBack,c=this._getActionPosition(a.direction);this.node.setPosition(c.end);var s=a.time||.5;if(a.type===o.TakeBack.TakeBack.type){this.isClosing=!0;var r=cc.moveTo(s,c.start);this.node.runAction(cc.sequence([r.easing(cc.easeCubicActionOut()),cc.callFunc(function(){i.isClosing=!1,t&&t(),i.blockNode&&i.blockNode.destroy()})]))}else if(a.type===o.TakeBack.FadeOut.type){this.node.opacity=255,this.isClosing=!0;var l=cc.sequence([cc.fadeOut(s),cc.callFunc(function(){i.isClosing=!1,t&&t(),i.blockNode&&i.blockNode.destroy()})]);this.node.runAction(l)}else a.type===o.TakeBack.None.type&&(this.isClosing=!1,t&&t(),this.blockNode&&this.blockNode.destroy())}},_getActionPosition:function(e){var t=this.avgData;if(t){var i=cc.v2(0,0),n=cc.v3(t.position.x,t.position.y),a=cc.view.getDesignResolutionSize();return e===o.Direction.Bottom.type?(i.x=n.x,i.y=-(a.height/2+t.size.height/2)):e===o.Direction.Top.type?(i.x=n.x,i.y=a.height/2+t.size.height/2):e===o.Direction.Left.type?(i.x=-(a.width/2+t.size.width/2),i.y=n.y):e===o.Direction.Right.type&&(i.x=a.width/2+t.size.width/2,i.y=n.y),{start:i,end:n}}return null}}),cc._RF.pop()},{}],BagItemDisplayAudio:[function(e,t,i){"use strict";cc._RF.push(t,"14466js/3dGd7rEq6/2AmyA","BagItemDisplayAudio");var n=e("Assets"),o=e("DisplayImageSize");e("LocalStorage");cc.Class({extends:e("Observer"),_getMsgList:function(){return[cc.AvgMsg.Msg.UpdateVolume]},_onMsg:function(e,t){e===cc.AvgMsg.Msg.UpdateVolume&&this._checkMusicIDValid()&&this._updateVolume(this._musicID)},properties:{audioBtn:cc.Prefab,timeLabel:cc.Label,nameLabel:cc.Label,icon:cc.Sprite,_audioDanceBtn:null},onClickClose:function(){this.node.destroy()},onLoad:function(){this._musicID=null,this._isLoadingSrc=!1,this._initMsg();var e=cc.view.getDesignResolutionSize();this.node.setContentSize(e);var t=cc.instantiate(this.audioBtn);this.node.addChild(t);var i=t.getComponent("AudioDanceBtn");i&&(this._audioDanceBtn=i,i.clickCB=this._onClickPlayBtn.bind(this))},setDisplayAudioData:function(e){var t=this;this._itemData=e,this.nameLabel.string=e.name||"";var i=e.iconBig,a=n.getUrlByUUID(i);a&&cc.loader.load(a,function(e,n){if(e)cc.error(e);else{var a=o.calcSize(cc.view.getDesignResolutionSize(),cc.size(n.width,n.height));t.icon.sizeMode=cc.Sprite.SizeMode.CUSTOM,AvgPlayer.setSpriteFrame(t.icon,i,a)}})},_onClickPlayBtn:function(e){var t=this;if(e){var i=this._itemData.displayData.src;if(!i)return void cc.error("src is error");if(this._checkMusicIDValid())cc.audioEngine.resumeEffect(this._musicID),AudioMgr.setAudioPlayBackRate(this._musicID);else{if(this._isLoadingSrc)return;var o=n.getUrlByUUID(i);if(!o)return void cc.error("\u97f3\u9891\u7684url\u65e0\u6548:".concat(i));this._isLoadingSrc=!0,cc.loader.load(o,function(e,i){t._isLoadingSrc=!1;var n=cc.audioEngine.playEffect(i,!1);AudioMgr.setAudioPlayBackRate(n),t._musicID=n,t._updateVolume(n),cc.audioEngine.setFinishCallback(n,function(){t._audioDanceBtn&&t._audioDanceBtn.stopDance(),setTimeout(function(){t.node.destroy()})})})}}else this._checkMusicIDValid()&&cc.audioEngine.pauseEffect(this._musicID)},_checkMusicIDValid:function(){return null!==this._musicID&&void 0!==this._musicID},_updateVolume:function(e){var t=GameDB.MusicVolume;cc.audioEngine.setVolume(e,t)},start:function(){}}),cc._RF.pop()},{Assets:"Assets",DisplayImageSize:"DisplayImageSize",LocalStorage:"LocalStorage",Observer:"Observer"}],BagItemDisplayImages:[function(e,t,i){"use strict";cc._RF.push(t,"93d4fEpkm1Mgbu1xQuKZhpW","BagItemDisplayImages");var n=e("Assets");cc.Class({extends:cc.Component,properties:{defaultSprite:cc.SpriteFrame,pageView:cc.PageView},onLoad:function(){},start:function(){},onClickClose:function(){this.node.destroy()},setDisplayImagesData:function(e){var t=e.displayData.images,i=cc.view.getDesignResolutionSize();this.node.setContentSize(i),this.pageView.node.setContentSize(i),this.pageView.content.setPosition(-i.width/2,0),this.createItem(i,t)},createItem:function(e,t){if(this.pageView.removeAllPages(),0===t.length){var i=new cc.Node("page_item_error_info");i.setContentSize(e);var n=new cc.Node("info");n.color=cc.color("#ff0000"),i.addChild(n),n.addComponent(cc.Label).string="\u597d\u50cf\u6ca1\u6709\u5c55\u793a\u56fe\u7247\u5440~~~",this.pageView.addPage(i)}else for(var o=0;o<t.length;o++){var a=this._createPageItem(e,t[o]);this.pageView.addPage(a)}},_createPageItem:function(e,t){var i=this,o=new cc.Node("page_item"),a=new cc.Node("sprite");o.addChild(a);var c=a.addComponent(cc.Sprite);c.sizeMode=cc.Sprite.SizeMode.CUSTOM,o.setContentSize(e);var s=n.getUrlByUUID(t);return s?cc.loader.load(s,function(n,o){n?(cc.error(n),AvgPlayer.setSpriteFrame(c,t,e)):AvgPlayer.setSpriteFrame(c,t,i._calcSize(e,cc.size(o.width,o.height)))}):AvgPlayer.setSpriteFrame(c,t,e),o},_calcSize:function(t,i){return e("DisplayImageSize").calcSize(t,i)}}),cc._RF.pop()},{Assets:"Assets",DisplayImageSize:"DisplayImageSize"}],BagItemDisplayVideo:[function(e,t,i){"use strict";cc._RF.push(t,"845e6XVC61PaKynvwev7Cb8","BagItemDisplayVideo");e("Assets"),e("LocalStorage");cc.Class({extends:cc.Component,properties:{videoAddNode:cc.Node,videoNode:cc.Node},onClickClose:function(){this.node.destroy()},onLoad:function(){var e=cc.view.getDesignResolutionSize();this.node.setContentSize(e)},start:function(){},setDisplayVideoData:function(e){var t=cc.view.getDesignResolutionSize();this._itemData=e;var i=e.displayData.src,n=AvgPlayer.insertVideoPlot("display-video",i,{zIndex:1e3,width:t.width,height:t.height,isRemote:!1});this.videoAddNode.addChild(n),this.videoNode=n,this._playVideo()},_playVideo:function(){var e=this,t=this.videoNode.getComponent("MoviePlayer");if(t){var i=GameDB.MusicVolume;t.setVolume(i),t.adjustVideo(),cc.log("\u5b8c\u6574\u64ad\u653e\u89c6\u9891"),t.setPlayFinishCallBack(function(){e.node.destroy()}),t.playMovieFull({isFullPlay:!0})}}}),cc._RF.pop()},{Assets:"Assets",LocalStorage:"LocalStorage"}],BagItemList:[function(e,t,i){"use strict";cc._RF.push(t,"bc3b3QFrcNFQLvThu08tD3w","BagItemList");var n=null,o=AvgData.Type.UiItemListType;cc.Class({extends:cc.Component,properties:{scroll:cc.ScrollView,itemPrefab:cc.Prefab,_items:[],bgNode:cc.Node,backNode:cc.Node},onLoad:function(){this._hideScrollSprite(),n=this,AVG_EDITOR&&Editor.Ipc.on(Editor.Msg.Editor.GoodsUpdateToEngine,this._onListenerGoodsUpdate),AVG_EDITOR||this.backNode.on(cc.Node.EventType.TOUCH_END,function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.CloseAvgBagLayer)})},_onListenerGoodsUpdate:function(){n&&n.updateBagItemInEditor()},onDestroy:function(){AVG_EDITOR&&Editor.Ipc.off(Editor.Msg.Editor.GoodsUpdateToEngine,this._onListenerGoodsUpdate)},_hideScrollSprite:function(){this.scroll.node.getComponent(cc.Sprite).enabled=!1},start:function(){},onBtnClickBack:function(){},_updateNodePosAndSize:function(e,t){e&&(e.setPosition(t.position.x,t.position.y),e.setContentSize(t.size.width,t.size.height))},_updateBg:function(e){if(this.bgNode){this._updateNodePosAndSize(this.bgNode,e),this.bgNode.color=cc.Color.WHITE;var t=this.bgNode.getComponent(cc.Sprite);t&&AvgPlayer.setSpriteFrame(t,e.texture,e.size)}},_updateList:function(e){this.scroll.node.color=cc.Color.WHITE,this._updateNodePosAndSize(this.scroll.node,e);for(var t=0;t<this._items.length;t++){this._items[t].updateBagItemView(e.itemCfg)}},_updateBackBtn:function(e){if(this.backNode){this._updateNodePosAndSize(this.backNode,e);var t=this.backNode.getComponent(cc.Sprite);t&&(AvgPlayer.setSpriteFrame(t,e.textureNormal,e.size),AvgPlayer.addButtonTexture(this.backNode,e.textureNormal,e.texturePress))}},disableScrollEvent:function(){this.scroll.enabled=!1},updateBagItemInEditor:function(e){var t=Editor.Goods.data.goods,i=this.scroll.content.getComponent(cc.Layout);if(0===t.length){i.type=cc.Layout.Type.VERTICAL,i.resizeMode=cc.Layout.ResizeMode.NONE,i.node.height=e.list.size.height;var n=new cc.Node("tipsNode");n.anchorY=1,n.width=e.list.size.width,n.height=e.list.size.height;var o=n.addComponent(cc.Label);o.overflow=cc.Label.Overflow.SHRINK,o.string="\u8bf7\u5148\u6dfb\u52a0\u7269\u54c1\n\u7136\u540e\u7f16\u8f91\u7269\u54c1\u7684\u663e\u793a\u6548\u679c",o.fontSize=20,o.horizontalAlign=cc.Label.HorizontalAlign.CENTER,o.verticalAlign=cc.Label.VerticalAlign.CENTER,this.scroll.content.destroyAllChildren(),this.scroll.content.addChild(n)}else{i.type=cc.Layout.Type.GRID,i.resizeMode=cc.Layout.ResizeMode.CONTAINER;var a=[];t.forEach(function(e){a.push({id:AvgData.genUUID(),uuid:e.uuid,num:99,cfg:e})}),this._createBagListItem(a)}},setListData:function(e){(e=JSON.parse(JSON.stringify(e))).forEach(function(e){e.cfg=cc.AvgGoods.getItemData(e.uuid)}),this._createBagListItem(e)},_createBagListItem:function(e){this._items=[],this.scroll.content.destroyAllChildren();for(var t=0;t<e.length;t++){var i=cc.instantiate(this.itemPrefab);this.scroll.content.addChild(i);var n=i.getComponent("BagItem");n&&(this._items.push(n),n.updateBagItemData(e[t]))}},updateBagItemList:function(e){this._data=e,this._updateBackBtn(e.back),this._updateBg(e.bg),this._updateList(e.list)},setBlockNode:function(e){this.blockNode=e},onShowAction:function(e){if(e&&e.popUp){var t=e.popUp,i=this._getActionPosition(t.direction),n=t.time||.5;if(t.type===o.PopUp.PopUp.type){this.node.opacity=255,this.node.setPosition(i.start);var a=cc.moveTo(n,i.end);this.node.runAction(a.easing(cc.easeBounceOut()))}else t.type===o.PopUp.FadeIn.type?(this.node.opacity=10,this.node.setPosition(i.end),this.node.runAction(cc.fadeIn(n))):t.type===o.PopUp.None.type&&this.node.setPosition(i.end)}},onCloseAction:function(e,t){var i=this;e||(this.blockNode&&this.blockNode.destroy(),t&&t());var n=this._data;if(n&&n.takeBack){var a=n.takeBack,c=this._getActionPosition(a.direction);this.node.setPosition(c.end);var s=a.time||.5;if(a.type===o.TakeBack.TakBack.type){var r=cc.moveTo(s,c.start);this.node.runAction(cc.sequence([r.easing(cc.easeCubicActionOut()),cc.callFunc(function(){i.blockNode&&i.blockNode.destroy(),t&&t()})]))}else if(a.type===o.TakeBack.FadeOut.type){this.node.opacity=255;var l=cc.sequence([cc.fadeOut(s),cc.callFunc(function(){i.blockNode&&i.blockNode.destroy(),t&&t()})]);this.node.runAction(l)}else a.type===o.TakeBack.None.type&&(this.blockNode&&this.blockNode.destroy(),t&&t())}},_getActionPosition:function(e){var t=this._data;if(t){var i=cc.v2(0,0),n=cc.v3(t.position.x,t.position.y),a=cc.view.getDesignResolutionSize();return e===o.Direction.Bottom.type?(i.x=n.x,i.y=-(a.height/2+t.size.height/2)):e===o.Direction.Top.type?(i.x=n.x,i.y=a.height/2+t.size.height/2):e===o.Direction.Left.type?(i.x=-(a.width/2+t.size.width/2),i.y=n.y):e===o.Direction.Right.type&&(i.x=a.width/2+t.size.width/2,i.y=n.y),{start:i,end:n}}return null}}),cc._RF.pop()},{}],BagItem:[function(e,t,i){"use strict";cc._RF.push(t,"bdf70+G9wdE7a7TxWB59swM","BagItem"),cc.Class({extends:e("Observer"),_getMsgList:function(){return[cc.AvgMsg.Msg.BagListItemSelect]},_onMsg:function(e,t){if(e===cc.AvgMsg.Msg.BagListItemSelect){var i=this.getItemUUID();null!==i&&i===t?this.selected(!0):this.selected(!1)}},properties:{icon:cc.Sprite,bgSprite:cc.Sprite,itemName:cc.Label,itemCount:cc.Label,countBgNode:cc.Node,selectNode:cc.Node},onLoad:function(){var e=this;this.selected(!1),this._initMsg(),this.bgSprite.enabled=!1,AVG_EDITOR||(this.node.on(cc.Node.EventType.TOUCH_START,function(t){t.stopPropagation(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.BagListItemSelect,e.getItemUUID())}),this.node.on(cc.Node.EventType.TOUCH_END,function(t){t.stopPropagation(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowBagItemDetails,e._itemData)}))},start:function(){},getItemUUID:function(){return this._itemData?this._itemData.cfg.uuid:null},selected:function(e){this.selectNode.active=!!e},updateBagItemData:function(e){this._itemData=e;var t=e.cfg;if(t){this.itemName.string=t.name;var i=e.num;i>1?(this.itemCount.node.active=!0,this.countBgNode.active=!0):(this.itemCount.node.active=!1,this.countBgNode.active=!1),i>99&&(i="99+"),this.itemCount.string=i,AvgPlayer.setSpriteFrame(this.icon,t.iconSmall,{width:this.bgSprite.node.width,height:this.bgSprite.node.height})}else cc.error("\u672a\u53d1\u73b0\u7269\u54c1\u914d\u7f6e\u4fe1\u606f: ".concat(e.uuid))},updateBagItemView:function(e){AvgPlayer._addLabelComponent(this.itemName.node),AvgPlayer._addLabelComponent(this.itemCount.node);var t=e.nameFont;this.itemName.updateLabelByFontInfo(t);var i=e.countFont;this.itemCount.updateLabelByFontInfo(i),this.countBgNode.color=cc.color(e.countBgColor)}}),cc._RF.pop()},{Observer:"Observer"}],BagScene:[function(e,t,i){"use strict";cc._RF.push(t,"b2f34jaZppOAb6ty29Tt76d","BagScene"),cc.Class({extends:cc.Component,properties:{prefab:cc.Prefab},start:function(){var e=cc.instantiate(this.prefab);this.node.addChild(e)}}),cc._RF.pop()},{}],BeginMask:[function(e,t,i){"use strict";cc._RF.push(t,"8cee6JxyRRHkqHDbvcJZ6+T","BeginMask");cc.Class({extends:cc.Mask,ctor:function(){this._hasEnd=!1},properties:{},onEnable:function(){this._super(),this.node._renderFlag&=~cc.RenderFlow.FLAG_POST_RENDER,this._hasEnd||this.disableRender()},markForRender:function(e){this._super(e),this.node._renderFlag&=~cc.RenderFlow.FLAG_POST_RENDER},start:function(){}});cc._RF.pop()},{}],CalcTipsEditor:[function(e,t,i){"use strict";cc._RF.push(t,"21022gDsuBMbbAhTBqe0GrI","CalcTipsEditor"),cc.Class({extends:e("Observer"),properties:{},_getMsgList:function(){return[cc.AvgMsg.Msg.ShowValueEvenShowText]},_onMsg:function(e,t){e===cc.AvgMsg.Msg.ShowValueEvenShowText&&this.calcTips.addTips(t)},onLoad:function(){var e=this;this._initMsg(),this.calcTips=this.node.addComponent("CalcTips"),this.calcTips.itemPrefab||cc.loader.loadRes("prefab/calcTips/TipsItem",cc.Prefab,function(t,i){t?cc.error(t):e.calcTips&&e.calcTips.node&&e.calcTips.node.isValid&&(e.calcTips.itemPrefab=i)})},start:function(){}}),cc._RF.pop()},{Observer:"Observer"}],CalcTips:[function(e,t,i){"use strict";cc._RF.push(t,"327d3k9nN1IpLAsk7tMHdyF","CalcTips"),cc.Class({extends:cc.Component,properties:{itemPrefab:cc.Prefab,_allItems:[],isCache:{default:!1,visible:!1},tipsCache:[]},onLoad:function(){},start:function(){},_deleteNode:function(e){for(var t=0;t<this._allItems.length;){var i=this._allItems[t];i===e?(this._allItems.splice(t,1),i.destroy()):t++}},addTips:function(e){this.isCache?this.tipsCache.unshift(e):this._createItem(e)},_createItem:function(e){var t=this,i=e.text,n=e.font;this.isCache=!0;var o=cc.instantiate(this.itemPrefab);this.node.addChild(o);var a=e.backgroundColor;a&&(o.color=cc.color(a));var c=o.getComponent("TipsItem");c&&(c.setTips(i),c.setFont(n)),this._allItems.unshift(o);var s=o.height;o.y=3*-s,o.stopAllActions();var r=cc.moveTo(.3,cc.v2(0,2*-s));o.runAction(cc.sequence([r,cc.callFunc(function(){t.isCache=!1,t._createCache();var e=cc.moveTo(.6,cc.v2(0,0)),i=cc.fadeOut(.6),n=cc.spawn([e,i]);o.runAction(cc.sequence([n,cc.callFunc(function(){t._deleteNode(o)})]))})]))},_createCache:function(){var e=this.tipsCache.length;if(e>0){var t=this.tipsCache.splice(e-1,1)[0];this._createItem(t)}}}),cc._RF.pop()},{}],ChildrenPosReset:[function(e,t,i){"use strict";cc._RF.push(t,"1969aNwJhdHMa6jYmyJyumV","ChildrenPosReset"),cc._RF.pop()},{LocalStorage:"LocalStorage"}],DanceLine:[function(e,t,i){"use strict";cc._RF.push(t,"d321f3aIW9DzLGZGV3vKA2N","DanceLine"),cc.Class({extends:cc.Component,properties:{},start:function(){this.time=1,this.height=54},_randomValue:function(){this.time=.2*Math.random()+.1,this.height=70*Math.random()+10},dance:function(){var e=this;this._randomValue();var t=cc.tween(this.node).to(this.time,{height:this.height}).call(function(){e.dance()});t.start(),this.action=t},stopDance:function(){this.action&&this.action.stop()}}),cc._RF.pop()},{}],DisplayImageSize:[function(e,t,i){"use strict";cc._RF.push(t,"e06adJl/rRPpJziJAyIEFi8","DisplayImageSize"),t.exports={calcSize:function(e,t){var i=e.width/e.height,n=t.width/t.height;return i>n?this._calcRatioSizeByHeight(t,e.height):i<n?this._calcRatioSizeByWidth(t,e.width):e},_calcRatioSizeByWidth:function(e,t){e.width,e.height;var i=t/e.width;return{width:t,height:e.height*i}},_calcRatioSizeByHeight:function(e,t){var i=t/e.height;return{width:e.width*i,height:t}}},cc._RF.pop()},{}],EffectTest:[function(e,t,i){"use strict";cc._RF.push(t,"58f10MOUXxP27qMFz4gLy3U","EffectTest"),cc._RF.pop()},{}],ElementBase:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}cc._RF.push(t,"2b469/quaNIebeQbOtPb5Pg","ElementBase");var c=function(){function e(){n(this,e),this.avgSyncData=null}return a(e,[{key:"setHitTestFlag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;e&&(e.hitTestSelf=t,e.hitTestChildren=i,void 0===n&&(n={pos:!1,size:!1}),e.lockOptions={pos:n.pos,size:n.size})}},{key:"avgSyncData2Node",value:function(){}},{key:"avgSyncNode2Data",value:function(){}}]),e}();t.exports=c,cc._RF.pop()},{}],ElementEvent:[function(e,t,i){"use strict";cc._RF.push(t,"41ef1N0TJVCiasEp0LtEqGn","ElementEvent");var n=e("ValueMgr"),o=AvgData.Type.Events.EventEmitType,a=e("GoodsEvent");cc.Class({extends:cc.Component,properties:{eventData:null,isEmit:!1,clickCount:{default:{}}},onLoad:function(){},start:function(){},setEventData:function(e){this.isEmit=!1,this.eventData=e,this.eventData.node=this.node,e.emitType===o.Click.type?(this.clickCount.total=1,this.clickCount.cur=0,this.node.on(cc.Node.EventType.TOUCH_END,this._addTouchEvent,this)):e.emitType===o.Clicks.type&&(this.clickCount.total=e.count,this.clickCount.cur=0,this.node.on(cc.Node.EventType.TOUCH_END,this._addTouchEvent,this))},_addTouchEvent:function(){this.isEmit||(this.clickCount.cur++,this.clickCount.cur>=this.clickCount.total&&this._emitEvent())},_offEmitEvent:function(){this.eventData&&(this.eventData.emitType!==o.Click.type&&this.eventData.emitType!==o.Clicks.type||this.node.off(cc.Node.EventType.TOUCH_END,this._addTouchEvent,this))},_emitEvent:function(){this._offEmitEvent(),this.isEmit=!0;var t=this.eventData.type;AvgData.Type.Events.EventType.Plot.type===t?e("EventExecute").triggerPlotJump(this.eventData.jump,this.eventData.delayTime):AvgData.Type.Events.EventType.Value.type===t?n.runValueEvent(this.eventData):AvgData.Type.Events.EventType.Goods.type===t&&a.runGoodsEvent(this.eventData)},update:function(e){}}),cc._RF.pop()},{EventExecute:"EventExecute",GoodsEvent:"GoodsEvent",ValueMgr:"ValueMgr"}],ElementPlotMenu:[function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?r(e):t}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}cc._RF.push(t,"4a2dbpUUl1HW5qZ8eAImJwj","ElementPlotMenu");var h=function(t){function i(e){return o(this,i),s(this,l(i).call(this))}return d(i,e("ElementBase")),c(i,[{key:"create",value:function(){}},{key:"avgSyncData2Node",value:function(){}},{key:"avgSyncNode2Data",value:function(){}},{key:"updateUI",value:function(){}}]),i}();t.exports=h,cc._RF.pop()},{ElementBase:"ElementBase"}],EndMask:[function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?r(e):t}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}cc._RF.push(t,"52d75zZA0tNULeVTAwNfgL3","EndMask");var h=e("./BeginMask"),g=cc.Class({extends:cc.RenderComponent,properties:{_beginMask:h,beginMask:{get:function(){return this._beginMask},set:function(e){this._beginMask&&(this._beginMask._hasEnd=!1),this._beginMask=e,this._enableBeginMask()},type:h}},onLoad:function(){var e=this;this.node.on(cc.Node.EventType.POSITION_CHANGED,function(){var t=e.node.getPosition();e._beginMask&&e._beginMask.node.setPosition(t)}),this.node.on(cc.Node.EventType.SIZE_CHANGED,function(){var t=e.node.getContentSize();e._beginMask&&e._beginMask.node.setContentSize(t)}),this.node.on(cc.Node.EventType.SCALE_CHANGED,function(){var t=e._beginMask;t&&(t.node.scaleX=e.node.scaleX,t.node.scaleY=e.node.scaleY)})},onDestroy:function(){this.beginMask&&AvgPlayer.MaskBeganGroup&&AvgPlayer.MaskBeganGroup.removeBeganGroup(this.beginMask)},onEnable:function(){this.node._renderComponent&&(this.node._renderComponent.enabled=!1),this.node._renderComponent=this,this.node._renderFlag|=cc.RenderFlow.FLAG_POST_RENDER,this._enableBeginMask()},onDisable:function(){this.node._renderComponent=null,this.beginMask&&this.beginMask.disableRender()},start:function(){this._enableBeginMask()},_enableBeginMask:function(){this.beginMask&&(this.beginMask.markForRender(!0),this._beginMask._hasEnd=!0)}});cc.game.on(cc.game.EVENT_ENGINE_INITED,function(){var e=function(e){function t(){return o(this,t),s(this,l(t).apply(this,arguments))}return d(t,cc.Assembler2D),c(t,[{key:"postFillBuffers",value:function(e,t){e.beginMask&&e.beginMask.enabledInHierarchy&&(t._flush(),cc.Mask.__assembler__.prototype.postFillBuffers.call(e.beginMask,e.beginMask,t))}}]),t}();cc.Assembler.register(g,e)}),cc._RF.pop()},{"./BeginMask":"BeginMask"}],EventExecute:[function(e,t,i){"use strict";cc._RF.push(t,"ce0155oKDBGfKlVqLXXOUA4","EventExecute");var n=e("ValueMgr"),o=e("StoryData"),a=e("GameUtil");t.exports={triggerPlotJump:function(e,t){e||(t=0),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPlotMenuOffTouchEvent),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnShieldStoryAnyTouch,{enabled:!0,time:t}),setTimeout(function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnShieldStoryAnyTouch,{enabled:!1}),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnJumpNewPlot,e)},1e3*t)},_execValueGoodsEvent:function(t){for(var i=0;i<t.length;i++){var o=t[i];AvgData.Type.Events.EventType.Value.type===o.type?n.runValueEvent(o,isShowCalcTips):AvgData.Type.Events.EventType.Plot.type===o.type||AvgData.Type.Events.EventType.Goods.type===o.type&&e("GoodsEvent").runGoodsEvent(o)}},execute:function(t,i){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n=arguments.length>3?arguments[3]:void 0,c=n.noEventTips,s=n.morePlotEventTips,r=n.noPlotEventCallBack,l=o.getPieceElementEventDataByID(t,i);if(0===l.length)return c&&cc.warn(c),r&&r(),!1;var d=a.filterPlotEvents(l);if(0===d.length)return this._execValueGoodsEvent(l),r&&r(),!1;if(1===d.length){if(e("StoryPieceUtil").getIsContentUnTargetGoodsEventElement()){var u=new AvgData.FontData;return u.color="#000",cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowValueEvenShowText,{text:"\u8fd8\u6709\u672a\u83b7\u5f97\u7269\u54c1!",font:u}),!1}this._execValueGoodsEvent(l);var h=d[0];return this.triggerPlotJump(h.jump,h.delayTime),!0}return s&&cc.warn(s),!1}},cc._RF.pop()},{GameUtil:"GameUtil",GoodsEvent:"GoodsEvent",StoryData:"StoryData",StoryPieceUtil:"StoryPieceUtil",ValueMgr:"ValueMgr"}],GameDB:[function(e,t,i){"use strict";cc._RF.push(t,"056353bkPtNyKNOgvJZ1lDU","GameDB");var n=e("LocalServe"),o={_data:{projectID:null,musicVolume:1,setButtonPos:cc.v2(0,0),talkSpeed:1,multipleSpeed:1,autoPlay:!1,accountID:null,plotSkipArray:{},globalValues:{},curUseArchiveID:null,archiveID:null,name:"",time:"",progress:"",normalValues:{},bag:[]},init:function(){var t=e("LocalServe"),i=this.getProjectID();i?(this._data.projectID=i,t.initServe(i)):cc.error("\u521d\u59cb\u5316GameDB\u5931\u8d25.")},getProjectID:function(){var e=cc.StoryConfig.file.init.data.projectID;return e||"avg-project"},initProjectData:function(){var e=n.getProject(this._data.projectID);e?(this._data.musicVolume=e.musicVolume,this._data.talkSpeed=e.talkSpeed,this._data.setButtonPos=e.setButtonPos,this._data.multipleSpeed=1,this._data.autoPlay=!1):cc.error("\u521d\u59cb\u5316\u9879\u76ee\u6570\u636e\u5931\u8d25")},initAccountData:function(){var e=n.getFirstAccount(this._data.projectID);e?(this._data.accountID=e.id,this._data.plotSkipArray=e.plotSkipArray,this._data.globalValues=e.globalValues,this._data.curUseArchiveID=e.curUseArchiveID):cc.error("\u521d\u59cb\u5316\u8d26\u53f7\u6570\u636e\u5931\u8d25.")},initLastUseArchive:function(){if(!this._data.curUseArchiveID){var e=n.getFirstArchive(this._data.projectID);e&&(this._data.curUseArchiveID=e.id)}this.initArchive()},loadArchive:function(e){this.save(),this._data.curUseArchiveID=e,this.initArchive()},initArchive:function(){var t=n.getArchive(this._data.projectID,this._data.accountID,this._data.curUseArchiveID);t?(this._data.archiveID=t.id,this._data.name=t.name,this._data.time=t.time,this._data.progress=t.progress,this._data.normalValues=t.normalValues,this._data.bag=t.bag,e("ValueMgr").initValue()):cc.error("\u521d\u59cb\u5316\u5b58\u6863\u5931\u8d25!")},_addItem:function(e,t){var i=!1;for(var n in this._data.bag){var o=this._data.bag[n];o.uuid===e&&(o.num+=t,i=!0)}return i},getBagItemData:function(e){for(var t in this._data.bag){var i=this._data.bag[t];if(i.uuid===e)return i}return null},addBagItem:function(e){if(Array.isArray(e)&&e.length>0){for(var t=0;t<e.length;t++){var i=e[t];if(this._addItem(i.uuid,i.num));else{var n=AvgData.genUUID();this._data.bag[n]={id:n,uuid:i.uuid,num:i.num}}}this.save()}},getBagData:function(){var e=[];if(this._data.bag)for(var t in this._data.bag)e.push(this._data.bag[t]);return e},save:function(){n.saveGame(this._data)},clearStorage:function(){cc.sys.localStorage.clear()},getNormalValue:function(e){return this._data.normalValues[e]},getGlobalValue:function(e){return this._data.globalValues[e]},updateAllValues:function(e){var t=AvgData.Type.Value.GameType,i=t.Global,n=t.System,o=t.Normal;for(var a in e){var c=e[a],s=c.type,r=c.value;i.type===s?void 0===this._data.globalValues[a]?cc.warn("\u5f02\u5e38\u7684\u6570\u503c:".concat(a)):this._data.globalValues[a]=r:n.type===s||o.type===s&&(void 0===this._data.normalValues[a]?cc.warn("\u5f02\u5e38\u7684\u6570\u503c:".concat(a)):this._data.normalValues[a]=r)}this.save()},getPlotSkip:function(e){return this._data.plotSkipArray[e]},setPlotSkip:function(e){this._data.plotSkipArray[e]=!0,this.save()},get MultipleSpeed(){return this._data.multipleSpeed},set MultipleSpeed(e){cc.director.getScheduler().setTimeScale(e),this._data.multipleSpeed=e,this.save(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.UpdateGameMultipleSpeed,e)},get TalkSpeed(){return this._data.talkSpeed},set TalkSpeed(e){this._data.talkSpeed=e,this.save()},get SetButtonPos(){return this._data.setButtonPos},set SetButtonPos(e){this._data.setButtonPos=e,this.save()},get AutoPlay(){return this._data.autoPlay},set AutoPlay(e){this._data.autoPlay=e,this.save()},get MusicVolume(){return this._data.musicVolume},set MusicVolume(t){this._data.musicVolume!==t&&(this._data.musicVolume=t,this.save(),e("AudioMgr").updateAllAudioVolume())}};t.exports=window.GameDB=o,cc._RF.pop()},{AudioMgr:"AudioMgr",LocalServe:"LocalServe",ValueMgr:"ValueMgr"}],GameData:[function(e,t,i){"use strict";cc._RF.push(t,"6324b0ckGVDVI25gx5fzwUd","GameData");e("LocalStorage"),e("ValueMgr");var n={recordEnterFileMgrSource:null};cc.AvgGameData=n,t.exports=n,cc._RF.pop()},{LocalStorage:"LocalStorage",ValueMgr:"ValueMgr"}],GameFullScreen:[function(e,t,i){"use strict";cc._RF.push(t,"2545e6eDhpEELjFmztEDLZ2","GameFullScreen"),t.exports={_init:!1,initFullScreen:function(){if(!this._init){this._init=!0;var t=e("StoryData");cc.GameUtil.getIsWeiXinBrowser()&&t.getIsPublish()?(cc.log("\u5f3a\u5236\u5168\u5c4f:yes"),this.forceFullScreen()):cc.log("\u5f3a\u5236\u5168\u5c4f:no")}},forceFullScreen:function(){var e=this;this.watchFullScreenState(function(){e.fullScreen()}),this.fullScreen()},fullScreen:function(){var e=document.documentElement;e.requestFullscreen&&(console.log("chrome\u6d4f\u89c8\u5668: fullScreen"),e.requestFullscreen()),e.mozRequestFullScreen&&(e.mozRequestFullScreen(),console.log("\u706b\u72d0\u6d4f\u89c8\u5668: fullScreen")),e.webkitRequestFullScreen&&(console.log("\u5fae\u4fe1\u6d4f\u89c8\u5668: fullScreen"),e.webkitRequestFullScreen())},exitFullscreen:function(){var e=document;e.exitFullscreen&&e.exitFullscreen(),e.mozCancelFullScreen&&e.mozCancelFullScreen(),e.webkitCancelFullScreen&&e.webkitCancelFullScreen()},watchFullScreenState:function(e){document.addEventListener("fullscreenchange",function(){document.fullscreen?console.log("\u8fdb\u5165\u5168\u5c4f"):(console.log("\u9000\u51fa\u5168\u5c4f"),e&&e())},!1),document.addEventListener("mozfullscreenchange",function(){document.mozFullScreen?console.log("\u8fdb\u5165\u5168\u5c4f"):(console.log("\u9000\u51fa\u5168\u5c4f"),e&&e())},!1),document.addEventListener("webkitfullscreenchange",function(){document.webkitIsFullScreen?console.log("\u8fdb\u5165\u5168\u5c4f"):(console.log("\u9000\u51fa\u5168\u5c4f"),e&&e())},!1)}},cc._RF.pop()},{StoryData:"StoryData"}],GameUtil:[function(e,t,i){"use strict";cc._RF.push(t,"3cfb39TY4VA8I4lxpqQd6mF","GameUtil");var n=e("StoryConfig"),o={transformUrl:function(e){if(e){if(-1!==e.indexOf("project://")){var t="project://".length;return e.substring(t,e.length)}return null}return null},setGameDesignResolutionSize:function(){var e=n.file.init.data.size;e?(cc.view.setDesignResolutionSize(e.width,e.height),cc.Canvas.instance.designResolution=cc.size(e.width,e.height),e.width>e.height?(cc.Canvas.instance.fitWidth=!0,cc.Canvas.instance.fitHeight=!0,cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE)):(cc.Canvas.instance.fitWidth=!0,cc.Canvas.instance.fitHeight=!0,cc.view.setOrientation(cc.macro.ORIENTATION_PORTRAIT))):console.error("\u672a\u6b63\u786e\u8bbe\u7f6e\u6e38\u620f\u8bbe\u8ba1\u5206\u8fa8\u7387")},fitDevice:function(){},filterPlotEvents:function(e){return this._filterEvents(e,AvgData.Type.Events.EventType.Plot.type)},filterGoodsEvents:function(e){return this._filterEvents(e,AvgData.Type.Events.EventType.Goods.type)},_filterEvents:function(e,t){for(var i=[],n=0;n<e.length;n++){var o=e[n];t===o.type&&i.push(o)}return i},uuid:function(){function e(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return e()+e(!0)+e(!0)+e()},autoRead:function(e,t,i){var n=!1;e.pieceData&&e.pieceData.continue?(cc.log("\u753b\u5e03\u81ea\u8eab\u8bbe\u7f6e\u8fde\u7eed\u64ad\u653e"),n=!0):(n=GameDB.AutoPlay)&&cc.log("\u753b\u5e03\u672a\u8bbe\u7f6e\u8fde\u7eed\u64ad\u653e, \u8bbe\u7f6e\u9762\u677f\u8bbe\u7f6e\u81ea\u52a8\u64ad\u653e"),n&&(cc.log("auto play ready: ".concat(t,"s")),e.scheduleOnce(function(){i&&i()},t))},getIsWeiXinBrowser:function(){return navigator.userAgent.toLowerCase().match(/MicroMessenger/i)},getIsAndroidEnv:function(){return navigator.userAgent.match(/android/i)},getIsIOSEnv:function(){return navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)}};cc.GameUtil=o,t.exports=o,cc._RF.pop()},{StoryConfig:"StoryConfig"}],GoodsEvent:[function(e,t,i){"use strict";cc._RF.push(t,"41af8oEm99L6YNkblDIAOcy","GoodsEvent"),t.exports={ShowType:{Dialog:1,Text:2},_parseItems:function(e){for(var t=[],i=(e=e.replace(/\uff0c/g,",")).split(","),n=0;n<i.length;n++){var o=i[n];if(o.length>0){var a=(o=o.replace(/\uff1a/g,":")).split(":"),c=1;void 0!==a[1]&&(c=parseInt(a[1]));var s=a[0],r=null,l=cc.AvgGoods.getItemDataByID(s);l&&(r=l.uuid),t.push({id:s,uuid:r,num:c})}}return t},runGoodsEvent:function(e){var t=this._parseItems(e.items),i=e.isShow?this.ShowType.Dialog:this.ShowType.Text;if(GameDB.addBagItem(t),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowBagGetItems,{type:i,data:t}),e.isLock,e.targetHide&&e.node&&e.node.avgSyncData){var n=e.node.avgSyncData.type,o=AvgData.AvgType;n!==o.ImageItem.type&&n!==o.ImageBg.type&&n!==o.ImageDraw.type&&n!==o.ImageHead.type&&n!==o.Text.type||(e.node.active=!1)}}},cc._RF.pop()},{}],GoodsItem:[function(e,t,i){"use strict";cc._RF.push(t,"10134nnd2FIwravI+7OE/76","GoodsItem"),cc.Class({extends:cc.Component,properties:{nameLabel:cc.Label,numLabel:cc.Label,numNode:cc.Node,iconSprite:cc.Sprite,descLabel:cc.Label,descNode:cc.Node},onLoad:function(){},start:function(){},setGoodsItemNum:function(e){this.numNode.active=e>0,e>99&&(e="99+"),this.numLabel.string=e},setGoodsItemData:function(e){var t=this.avgData.icon;this.iconSprite.spriteFrame=null,AvgPlayer.setSpriteFrame(this.iconSprite,e.iconBig,cc.size(t.size.width,t.size.height)),this.nameLabel.string=e.name,this.descLabel.string=e.desc},setGoodsItemAvgData:function(e){this.avgData=e,this.node.setPosition(e.position.x,e.position.y);var t=e.icon;this.iconSprite.node.setPosition(t.position.x,t.position.y);var i=e.itemNum.bgColor,n=e.itemNum,o=cc.size(n.size.width,n.size.height);this.numNode.color=cc.color(i),this.numNode.setPosition(n.position.x,n.position.y),this.numNode.setContentSize(o);AvgPlayer._addLabelComponent(this.numLabel.node);this.numLabel.updateLabelByFontInfo(n.font,cc.Label.Overflow.RESIZE_HEIGHT),this.numLabel.node.setContentSize(o);var a=e.itemName;if(AvgPlayer._addLabelComponent(this.nameLabel.node),this.nameLabel.updateLabelByFontInfo(a.font,cc.Label.Overflow.RESIZE_HEIGHT),this.nameLabel.node.setPosition(a.position.x,a.position.y),this.nameLabel.node.setContentSize(cc.size(a.size.width,a.size.height)),e.itemDescEnabled){this.descNode.active=!0;var c=e.itemDesc;AvgPlayer._addLabelComponent(this.descLabel.node),this.descLabel.updateLabelByFontInfo(c.font,cc.Label.Overflow.RESIZE_HEIGHT),this.descNode.setPosition(c.position.x,c.position.y),this.descNode.setContentSize(cc.size(c.size.width,c.size.height))}else this.descNode.active=!1,this.descNode.setContentSize(cc.size(0,0)),this.descNode.setPosition(0,0)}}),cc._RF.pop()},{}],Loading:[function(e,t,i){"use strict";cc._RF.push(t,"911e9zIWiJGvIf98goVbwY/","Loading"),cc.Class({extends:e("Observer"),properties:{icon:cc.Node,tips:cc.Label},_getMsgList:function(){return[cc.AvgMsg.Msg.WindowResize,cc.AvgMsg.Msg.LoadingInfo]},_onMsg:function(e,t){e===cc.AvgMsg.Msg.WindowResize?this._onResize():e===cc.AvgMsg.Msg.LoadingInfo&&(this.tips.string=t)},onLoad:function(){this._onResize(),this._initMsg()},_showIcon:function(){this.icon.active=!0},onEnable:function(){this.icon.active=!1,this.unschedule(this._showIcon),this.unschedule(this._onShowTimeOut),this.scheduleOnce(this._showIcon,1.5),this.scheduleOnce(this._onShowTimeOut,10)},_onShowTimeOut:function(){},_onResize:function(){var e=cc.view.getVisibleSize();this.node.setContentSize(e)},start:function(){},update:function(e){if(this.icon.active){var t=this.icon.angle;this.icon.angle=t+6}}}),cc._RF.pop()},{Observer:"Observer"}],LocalServe:[function(e,t,i){"use strict";cc._RF.push(t,"c3709P3WdhG46MNSEyuCDLW","LocalServe");var n=e("Project"),o=e("Account"),a=e("Archive"),c=e("GameUtil");t.exports={_isInit:!1,catchKey:"avg-local-archive",data:{},initServe:function(e){if(!1===this._isInit){this._isInit=!0;var t=cc.sys.localStorage.getItem(this.catchKey);if(t){var i=!1,o=JSON.parse(t);for(var a in o){var c=new n(a);c.init(o[a])&&(i=!0),this.data[a]=c}i&&this.save()}else this.createProjectInfo(e)}},createProjectInfo:function(e){if(e){var t=new n(e),i=c.uuid(),s=new o(i);t.accounts[i]=s;for(var r=1;r<=6;r++){var l=c.uuid(),d=new a(l);d.name="\u5b58\u6863".concat(r),d.time=moment().format("YYYY/MM/DD HH:mm:ss"),s.archives[l]=d}this.data[e]=t,this.save()}else cc.error("\u672a\u53d1\u73b0\u9879\u76ee\u7684projectID")},getProject:function(e){return e?this.data[e]:null},getFirstAccount:function(e){var t=this.getProject(e);if(t){var i=Object.keys(t.accounts);if(i.length>0)return t.accounts[i[0]]}return null},getFirstArchive:function(e){var t=this.getFirstAccount(e);if(t){var i=Object.keys(t.archives);if(i.length>0)return t.archives[i[0]]}return null},getAccount:function(e,t){var i=this.data[e];return i?i.accounts[t]:null},getArchive:function(e,t,i){var n=this.getAccount(e,t);if(n){var o=n.archives[i];if(o)return o}return null},saveGame:function(e){var t=this.getProject(e.projectID);if(t){t.musicVolume=e.musicVolume,t.talkSpeed=e.talkSpeed,t.setButtonPos=e.setButtonPos,t.multipleSpeed=e.multipleSpeed,t.autoPlay=e.autoPlay;var i=this.getAccount(e.projectID,e.accountID);if(i&&(i.plotSkipArray=e.plotSkipArray,i.globalValues=e.globalValues,i.curUseArchiveID=e.curUseArchiveID),e.curUseArchiveID){var n=this.getArchive(e.projectID,e.accountID,e.curUseArchiveID);n.name=e.name,n.time=moment().format("YYYY/MM/DD HH:mm:ss"),n.progress=e.progress,n.normalValues=e.normalValues,n.bag=e.bag}}this.save()},save:function(){var e=JSON.stringify(this.data);cc.sys.localStorage.setItem(this.catchKey,e)}},cc._RF.pop()},{Account:"Account",Archive:"Archive",GameUtil:"GameUtil",Project:"Project"}],LocalStorage:[function(e,t,i){"use strict";cc._RF.push(t,"f34d4vB739GsKLfKcqqtfwy","LocalStorage");e("GameUtil");t.exports={_isInit:!1,catchKey:"gameCatchKey",catchData:{}},cc._RF.pop()},{GameUtil:"GameUtil"}],MaskBeganGroup:[function(e,t,i){"use strict";cc._RF.push(t,"c6dd3bB3NtL1b4JLJnnJkOc","MaskBeganGroup"),cc.Class({extends:cc.Component,properties:{allBeganMask:[]},start:function(){},removeBeganGroup:function(e){for(var t=0;t<this.allBeganMask.length;){var i=this.allBeganMask[t];i===e?(this.allBeganMask.splice(t,1),i.node.isValid&&i.node.destroy()):t++}},cleanAllBeganMask:function(){for(var e=0;e<this.allBeganMask.length;e++){var t=this.allBeganMask[e];t.node.isValid&&(t.endMask.node.destroy(),t.node.destroy())}this.allBeganMask=[]},createBeganMask:function(e,t,i){var n=new cc.Node("began-mask-".concat(e.name)),o=n.addComponent("BeginMask");return o.inverted=!0,this.node.addChild(n),n.width=e.size.width,n.height=e.size.height,n.x=e.position.x,n.y=e.position.y,n.zIndex=cc.macro.MAX_ZINDEX-e.zIndex,o.endMask=t,o.movieNode=i,this.allBeganMask.push(o),o},resortIndex:function(){for(var e=0;e<this.allBeganMask.length;e++){var t=this.allBeganMask[e],i=t.movieNode.avgSyncData.zIndex;t.node.zIndex=cc.macro.MAX_ZINDEX-i;var n=t.movieNode.getComponent("MoviePlayer");if(n){var o=2*i-cc.macro.MAX_ZINDEX;n.updateVideoZIndex(o)}}},_getCompareIndexArray:function(e){var t=[];return function e(i){t.unshift(i.getSiblingIndex());var n=i.parent;n.getComponent(cc.Canvas)||e(n)}(e),t},sortZIndex:function(e){var t=this,i=[],n=0;e.forEach(function(e){var o=t._getCompareIndexArray(e);o.length>n&&(n=o.length),i.push({node:e,indexArr:o})});for(var o=function(e){i.sort(function(t,i){return e<t.indexArr.length&&e<i.indexArr.length?t.indexArr[e]-i.indexArr[e]:0})},a=0;a<n;a++)o(a);for(var c=0;c<i.length;c++){i[c].node.videoZIndex=c}}}),cc._RF.pop()},{}],MessageItem:[function(e,t,i){"use strict";cc._RF.push(t,"424620QXDdI4YuvtPbEeq1f","MessageItem"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],MousePointer:[function(e,t,i){"use strict";cc._RF.push(t,"438c8b2Hj1Ib6LjXJIRwfbj","MousePointer"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.on(cc.Node.EventType.MOUSE_ENTER,function(){AVG_EDITOR&&Editor.Scene.drawingMousePointer(!0)}),this.node.on(cc.Node.EventType.MOUSE_LEAVE,function(){AVG_EDITOR&&Editor.Scene.drawingMousePointer(!1)})}}),cc._RF.pop()},{}],MoviePlayer:[function(e,t,i){"use strict";cc._RF.push(t,"9e397RCThhOX4gwmOAe+mHt","MoviePlayer"),cc.macro.ENABLE_TRANSPARENT_CANVAS=!0;var n=!1,o=e("StoryData");e("LocalStorage");cc.Class({extends:e("Observer"),_getMsgList:function(){return[cc.AvgMsg.Msg.UpdateVolume,cc.AvgMsg.Msg.UpdateGameMultipleSpeed,cc.AvgMsg.Msg.PauseStory,cc.AvgMsg.Msg.AddVideoPlayBtn,cc.AvgMsg.Msg.WindowResize]},_setVideoPlayBackRate:function(e){if(void 0!==e){var t=this._videoCtrl.videoLogic.videoDom;t&&(t.playbackRate=e)}},_onMsg:function(e,t){var i=this,o=this._videoCtrl.videoLogic.videoPlayer;if(e===cc.AvgMsg.Msg.UpdateVolume)this._videoCtrl.videoLogic.updateVideoVolume();else if(e===cc.AvgMsg.Msg.UpdateGameMultipleSpeed)this._setVideoPlayBackRate(t);else if(e===cc.AvgMsg.Msg.PauseStory)t?(this.opacityNode.pauseAllActions(),o.isPlaying()&&(o.pause(),n=!0)):(this.opacityNode.resumeAllActions(),n&&(n=!1,o.resume()));else if(e===cc.AvgMsg.Msg.AddVideoPlayBtn)cc.loader.loadRes("videoPlayButton",function(e,t){console.log("\u663e\u793a\u81ea\u52a8\u64ad\u653e\u6309\u94ae");var n=new cc.Node,o=n.addComponent(cc.Sprite);o.spriteFrame=new cc.SpriteFrame(t),o.sizeMode=cc.Sprite.SizeMode.CUSTOM,n.setContentSize(cc.size(t.width/3,t.height/3)),n.on(cc.Node.EventType.TOUCH_END,function(){n.removeFromParent(!0),n.destroy(),console.log("\u70b9\u51fb\u89c6\u9891\u64ad\u653e\u6309\u94ae"),i._checkVideoCtrlValid()&&i._videoCtrl.videoLogic.playWithButton()}),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.AddNodeToVideoBtnLayer,n)});else if(e===cc.AvgMsg.Msg.WindowResize){var a=cc.view.getVisibleSize();this.node.setContentSize(a)}},properties:{_endMask:null,videoPlayer:cc.VideoPlayer,bgDom:null,opacityNode:null,_videoCtrl:null,_videoPlayFinishCallBack:null},onLoad:function(){this._initMsg()},start:function(){this.updateZIndex()},_createMissTipsNode:function(){var e=new cc.Node("video-missing-node"),t=e.addComponent(cc.Sprite),i=AvgPlayer.PreloadPrefab.prefabs.ResMissingTexture.prefab;return i&&(t.spriteFrame=new cc.SpriteFrame(i)),this._addWidget(e),e},_addWidget:function(e){var t=e.addComponent(cc.Widget);t.isAlignLeft=!0,t.left=0,t.isAlignBottom=!0,t.bottom=0,t.isAlignRight=!0,t.right=0,t.isAlignTop=!0,t.top=0,t.alignMode=cc.Widget.AlignMode.ALWAYS},_addVideoFlagInEditor:function(){AVG_EDITOR},initMoviePlayer:function(e){if(this.avgData=e,AVG_EDITOR)this.node.width=e.size.width,this.node.height=e.size.height,this.node.x=e.position.x,this.node.y=e.position.y;else{var t=cc.view.getVisibleSize();this.node.setContentSize(t),e.size.width=t.width,e.size.height=t.height,this.node.x=this.node.y=0}this.videoNode=new cc.Node("video-node-".concat(e.name)),this._addWidget(this.videoNode),this.node.addChild(this.videoNode,1),this.missNode=this._createMissTipsNode(),this.node.addChild(this.missNode,2);var i=this.videoNode.getComponent("EndMask");i||(i=this.videoNode.addComponent("EndMask"));var n=null;AvgPlayer.MaskBeganGroup&&(n=AvgPlayer.MaskBeganGroup.createBeganMask(e,i,this.node)),i.beginMask=n,this._endMask=i,o.getIsPublish()?this._videoCtrl=this.videoNode.addComponent("VideoGroup"):this._videoCtrl=this.videoNode.addComponent("VideoElement"),this._videoCtrl&&(this._videoCtrl.onInit(this),this.updateVideoSrc(e)),this._createOpacityNode()},updateVideoSrc:function(t){if(this._checkVideoCtrlValid()){var i=this._videoCtrl.setVideoSrc(t);if(this.missNode){var n=t.size,o=n.width,a=n.height;this.missNode.setContentSize(cc.size(o,a)),e("StoryData").getIsPublish()?this.missNode.active=!1:this.missNode.active=!i}}},_createOpacityNode:function(){var e=new cc.Node("opacity-node");this.node.addChild(e,3),this.opacityNode=e},initOpacityFadeIn:function(){this.opacityNode.opacity=0},runOpacityAction:function(e,t,i){var n=null;e===AvgData.Type.ActionVideoType.FadeOut.type?(this.opacityNode.opacity=255,n=cc.fadeOut(t)):e===AvgData.Type.ActionVideoType.FadeIn.type&&(this.opacityNode.opacity=0,n=cc.fadeIn(t)),n&&this.opacityNode.runAction(cc.sequence([cc.delayTime(i),n]))},update:function(e){this._updateOpacity(),this.updateDisplayMode()},updateVideoZIndex:function(e){if(this._checkVideoCtrlValid()){var t=this._videoCtrl.videoLogic.videoDom;t&&(t.style["z-index"]=e)}},_checkVideoCtrlValid:function(){return!(!this._videoCtrl||!this._videoCtrl.isValid)},_updateOpacity:function(){if(this.opacityNode){var e=this.node.parent.opacity/255*(this.opacityNode.opacity/255)*255;this._endMask&&this._endMask.beginMask&&(this._endMask.beginMask.enabled=0!==e),this._checkVideoCtrlValid()&&this._videoCtrl.videoLogic.updateOpacity(e)}},onVideoPlayerEvent:function(e,t,i){t===cc.VideoPlayer.EventType.COMPLETED?this.emitFinishCallBack():cc.VideoPlayer.EventType.READY_TO_PLAY},emitFinishCallBack:function(){this._videoPlayFinishCallBack&&this._videoPlayFinishCallBack()},setVolume:function(e){this._checkVideoCtrlValid()&&this._videoCtrl.videoLogic.setVideoVolume(e)},adjustVideo:function(){this._checkVideoCtrlValid()&&this._videoCtrl.videoLogic.adjustVideoAttributeWithX5()},setPlayFinishCallBack:function(e){this._videoPlayFinishCallBack=e},playMovieFull:function(e){if(this._checkVideoCtrlValid()){var t=GameDB.MultipleSpeed;this._setVideoPlayBackRate(t),this._videoCtrl.playVideoFull(e)}},playMovieFragment:function(e){if(this._checkVideoCtrlValid()){var t=GameDB.MultipleSpeed;this._setVideoPlayBackRate(t),this._videoCtrl.playVideoFragment(e)}},updateZIndex:function(){AvgPlayer.MaskBeganGroup&&AvgPlayer.MaskBeganGroup.resortIndex(),this._checkVideoCtrlValid()&&this._videoCtrl.videoLogic.updateBgDom()},updateDisplayMode:function(){if(this._checkVideoCtrlValid()){var e=this.node.avgSyncData;this._videoCtrl.videoLogic.updateVideoDisplayMode(e)}}}),cc._RF.pop()},{LocalStorage:"LocalStorage",Observer:"Observer",StoryData:"StoryData"}],ObserverMgr:[function(e,t,i){"use strict";cc._RF.push(t,"a18958flXNAQ5o/+voRIY6v","ObserverMgr");var n={obsArray:{},addEventListener:function(e,t,i){void 0===i&&cc.log("[ObserverMgr] \u6ce8\u518c\u6d88\u606f [%s]:%s \u7684\u4f5c\u7528\u4e8e\u672a\u5b9a\u4e49",e,t.name),void 0===this.obsArray[e]&&(this.obsArray[e]=[]);for(var n=0;n<this.obsArray[e].length;n++){var o=this.obsArray[e][n];if(o.func===t&&o.ob===i)return}this.obsArray[e].push({func:t,ob:i})},removeEventListener:function(e,t,i){var n=!1,o=this.obsArray[e];if(o)for(var a=0;a<o.length;){var c=o[a],s=c.func,r=c.ob;t===s&&i===r?(o.splice(a,1),n=!0):a++}return n},removeEventListenerWithObject:function(e){for(var t in this.obsArray)for(var i=this.obsArray[t],n=0;n<i.length;){i[n].ob===e?i.splice(n,1):n++}},cleanAllEventListener:function(){this.obsArray={}},dispatchMsg:function(e,t){var i=this.obsArray[e];if(void 0!==i)for(var n=0;n<i.length;n++){var o=i[n],a=o.func,c=o.ob;a&&c&&a.apply(c,[e,t])}else cc.log("\u6d88\u606f\u5217\u8868\u4e2d\u4e0d\u5b58\u5728: "+e)}};cc.ObserverMgr=t.exports=n,cc._RF.pop()},{}],Observer:[function(e,t,i){"use strict";cc._RF.push(t,"b4e80bwFI5Cmbppt9+0tpcO","Observer");var n=cc.Class({extends:cc.Component,_initMsg:function(){var e=this._getMsgList();if(e)for(var t=0;t<e.length;t++){var i=e[t];cc.ObserverMgr.addEventListener(i,this._onMsg,this)}},onLoad:function(){},_getMsgList:function(){return[]},_onMsg:function(e,t){},onDisable:function(){},onEnable:function(){},onDestroy:function(){cc.ObserverMgr.removeEventListenerWithObject(this)}});cc.Observer=t.exports=n,cc._RF.pop()},{}],ParticleCtrl:[function(e,t,i){"use strict";cc._RF.push(t,"82546m3UAhONYTqlwxRsvUw","ParticleCtrl");var n=AvgData.AvgType;cc.Class({extends:cc.Component,properties:{particle:cc.ParticleSystem,data:null},onLoad:function(){},start:function(){},_updateParticle:function(){if(this.data)switch(this.data.type){case n.EffectSnow.type:this._onUpdateSnow();break;case n.EffectWin.type:this._onUpdateWin();break;case n.EffectRain.type:this._onUpdateRain()}},_onUpdateRain:function(){var e=this.data.state;e===AvgData.Type.EffectRainType.small.type?this.particle.emissionRate=30:e===AvgData.Type.EffectRainType.middle.type?this.particle.emissionRate=100:e===AvgData.Type.EffectRainType.big.type&&(this.particle.emissionRate=300)},_onUpdateWin:function(){var e=this.data.state;e===AvgData.Type.EffectWinType.small.type?this.particle.emissionRate=10:e===AvgData.Type.EffectWinType.middle.type?this.particle.emissionRate=20:e===AvgData.Type.EffectWinType.big.type&&(this.particle.emissionRate=40)},_onUpdateSnow:function(){var e=this.data.state;e===AvgData.Type.EffectSnowType.small.type?this.particle.emissionRate=10:e===AvgData.Type.EffectSnowType.middle.type?this.particle.emissionRate=80:e===AvgData.Type.EffectSnowType.big.type&&(this.particle.emissionRate=200)},_previewEnd:function(){this.stopPreview()},previewParticleInEditor:function(){this.showEffect(),this.unschedule(this._previewEnd),this.scheduleOnce(this._previewEnd,2)},setAvgEffectData:function(e){this.data=e},showEffect:function(){var e=this,t=this.node.getComponent(cc.Animation);if(t){var i=t.getClips();if(i.length>0){var o=i[0];if(this.node.active=!0,this.data){var a=this.data.type;a===n.EffectRain.type||a===n.EffectSnow.type||a===n.EffectLeafFall.type||a===n.EffectFog.type||a===n.EffectLight.type||a===n.EffectFire.type||a===n.EffectSpotFire.type?o.wrapMode=cc.WrapMode.Loop:a===n.EffectBoom.type?(o.wrapMode=cc.WrapMode.Normal,t.on(cc.Animation.EventType.LASTFRAME,function(){e.stopPreview()})):a!==n.EffectBloodDrip.type&&a!==n.EffectBloodDown.type||(o.wrapMode=cc.WrapMode.Normal)}var c=o.name,s=t.play(c);this.cur={state:s,animation:t,name:c}}}},stopPreview:function(){this.cur&&(this.cur.state.isPlaying||this.cur.animation.stop(this.cur.name)),this.node.active=!1},setParticleData:function(e){this.data=e,this._updateParticle()}}),cc._RF.pop()},{}],PasswordLockBox:[function(e,t,i){"use strict";cc._RF.push(t,"3a551bDuR9PNbdG6M7V6Hus","PasswordLockBox"),cc.Class({extends:e("Observer"),properties:{_data:null,_pwdLock:e("PasswordLock"),_uiNode:cc.Node,isTargetEvent:!1},_getMsgList:function(){return[cc.AvgMsg.Msg.PasswordLockOpenSucceed,cc.AvgMsg.Msg.PasswordLockOpenFailed]},_onMsg:function(e,t){cc.AvgMsg.Msg.PasswordLockOpenSucceed===e?this._onLock(t,!0):cc.AvgMsg.Msg.PasswordLockOpenFailed===e&&(t.forbidUnLock=!0,this._onLock(t,!1))},_onLock:function(e,t){var i=this;this._data.id===e.id&&this._uiNode&&(this._uiNode.off(cc.Node.EventType.TOUCH_START,this._onRemoveUINode,this),this._updateBoxView(),this._onRemoveUINode(null,function(){var e=i.node.getComponent("PasswordLockEvent");e&&(i.isTargetEvent=!0,t?e.runPwdLockEventSucceed():e.runPwdLockEventFailed())}))},onLoad:function(){this._initMsg(),this._uiNode=null},start:function(){},setPwdLockBoxData:function(e){this._data=JSON.parse(JSON.stringify(e)),this._data.forbidUnLock=!1,this.setBoxEvent(),this._updateBoxView()},_updateBoxView:function(){this.setBoxView()},setBoxViewTest:function(){var e=this._data,t=this.node.getComponent(cc.Sprite),i=null,n=e.style;n===AvgData.Type.PasswordLockStyleType.Type1.type?i=e.isLock?"prefab/passwordLock/box/box1-close":"prefab/passwordLock/box/box1-open":n===AvgData.Type.PasswordLockStyleType.Type2.type&&(i=e.isLock?"prefab/passwordLock/box/box2-close":"prefab/passwordLock/box/box2-open"),i&&t&&cc.loader.loadRes(i,function(e,i){e?cc.error(e):t.spriteFrame=new cc.SpriteFrame(i)})},setBoxView:function(){var e=this._data,t=this.node.getComponent(cc.Sprite),i=null;(i=e.isLock?e.imageLock:e.imageOpen)&&t&&AvgPlayer.setSpriteFrame(t,i,e.size)},setBoxEvent:function(){var e=this;AVG_EDITOR||this.node.on(cc.Node.EventType.TOUCH_START,function(){e._onResponseEvent()})},_onResponseEvent:function(){this._data.isLock?this.onClickLockBox():this.onClickLockBoxTips()},onClickLockBoxTips:function(){var e=this._data;cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowValueEvenShowText,{text:e.openTips,font:e.tipsFont})},_onPreviewOver:function(){this._onRemoveUINode(null,null)},runPreviewInEditor:function(){this._onResponseEvent(),this.unschedule(this._onPreviewOver),this.scheduleOnce(this._onPreviewOver,3)},onClickLockBox:function(){var e=this,t=null,i=this._data.style;i===AvgData.Type.PasswordLockStyleType.Type1.type?t="prefab/passwordLock/style1/PasswordLock1":i===AvgData.Type.PasswordLockStyleType.Type2.type&&(t="prefab/passwordLock/style2/PasswordLock2"),t&&cc.loader.loadRes(t,function(t,i){if(e.isValid){var n=new cc.Node;n.addComponent(cc.BlockInputEvents),n.setContentSize(cc.view.getVisibleSize()),n.on(cc.Node.EventType.TOUCH_START,e._onRemoveUINode,e),cc.Canvas.instance.node.addChild(n),e._cleanUINode(),e._uiNode=n;var o=cc.instantiate(i);n.addChild(o);var a=o.getComponent("PasswordLock");a&&a.setPwdLockData(e._data)}})},_cleanUINode:function(){this._uiNode&&this._uiNode.isValid&&(this._uiNode.destroy(),this._uiNode=null)},_onRemoveUINode:function(e,t){var i=this;if(this._uiNode){var n=cc.scaleTo(.1,.2),o=cc.callFunc(function(){i._cleanUINode(),t&&t()});this._uiNode.runAction(cc.sequence([n,o]))}}}),cc._RF.pop()},{Observer:"Observer",PasswordLock:"PasswordLock"}],PasswordLockDisplayLight:[function(e,t,i){"use strict";cc._RF.push(t,"ead85FVPpRMHYT206LlvQNf","PasswordLockDisplayLight"),cc.Class({extends:cc.Component,properties:{lightOrigin:cc.Node,lightRight:cc.Node,lightError:cc.Node},onLoad:function(){},start:function(){},setLightOrigin:function(){this.lightRight.active=!1,this.lightOrigin.active=!0,this.lightError.active=!1},setLightError:function(){this.lightRight.active=!1,this.lightOrigin.active=!1,this.lightError.active=!0},setLightRight:function(){this.lightRight.active=!0,this.lightOrigin.active=!1,this.lightError.active=!1}}),cc._RF.pop()},{}],PasswordLockDisplayNum:[function(e,t,i){"use strict";cc._RF.push(t,"fddddfLxj9BjoSif4mW3y+6","PasswordLockDisplayNum"),cc.Class({extends:cc.Component,properties:{inputNumPrefab:cc.Node},resetPwd:function(e){for(var t=this.node.children.length,i=0;i<t;i++){var n=this.node.children[i],o=cc.find("init",n),a=cc.find("num",n);o.active=a.active=!1,void 0===e[i]?o.active=!0:(a.active=!0,a.getComponent(cc.Label).string=e[i])}},initInputNum:function(e){var t=this.node.children.length;if(e!==t&&e>t)for(var i=0;i<e-t;i++){var n=cc.instantiate(this.inputNumPrefab);this.node.addChild(n)}this.resetPwd("")},start:function(){}}),cc._RF.pop()},{}],PasswordLockDisplay:[function(e,t,i){"use strict";cc._RF.push(t,"3c3e3yFp79KQJbCmxn5M19q","PasswordLockDisplay"),cc.Class({extends:cc.Component,properties:{resultNode:cc.Node,resultErrorNode:cc.Node,resultLockNode:cc.Node,resultOpenNode:cc.Node,light1:e("PasswordLockDisplayLight"),light2:e("PasswordLockDisplayLight"),inputNum:e("PasswordLockDisplayNum")},onLoad:function(){},updateLights:function(e){var t=e.length;t>=1?e[0]?this.light1.setLightRight():this.light1.setLightError():this.light1.setLightOrigin(),t>=2?e[1]?this.light2.setLightRight():this.light2.setLightError():this.light2.setLightOrigin()},updateInput:function(e){this.inputNum.node.active=!0,this.resultNode.active=!1,this.inputNum.resetPwd(e)},setOpenState:function(){this.inputNum.resetPwd(""),this.inputNum.node.active=!1,this.resultNode.active=!0,this.resultErrorNode.active=!1,this.resultLockNode.active=!1,this.resultOpenNode.active=!0},setLockState:function(){this.inputNum.resetPwd(""),this.inputNum.node.active=!1,this.resultNode.active=!0,this.resultErrorNode.active=!1,this.resultLockNode.active=!0,this.resultOpenNode.active=!1},setErrorState:function(){this.inputNum.resetPwd(""),this.inputNum.node.active=!1,this.resultNode.active=!0,this.resultErrorNode.active=!0,this.resultLockNode.active=!1,this.resultOpenNode.active=!1},start:function(){}}),cc._RF.pop()},{PasswordLockDisplayLight:"PasswordLockDisplayLight",PasswordLockDisplayNum:"PasswordLockDisplayNum"}],PasswordLockEvent:[function(e,t,i){"use strict";cc._RF.push(t,"750269cq3FKfr1tw8U9ZKC+","PasswordLockEvent");e("GameUtil"),e("ValueMgr"),e("StoryData");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){},setPwdLockEventData:function(e,t){this._avgData=e,this._pieceID=t},runPwdLockEventSucceed:function(){this._runEvent(this._avgData.result.succeed)},runPwdLockEventFailed:function(){this._runEvent(this._avgData.result.failed)},_runEvent:function(t){return cc.log("\u6267\u884c [".concat(t.name,"] \u7684\u4e8b\u4ef6")),e("EventExecute").execute(this._pieceID,t.id,!0,{noEventTips:"\u5bc6\u7801\u9501\u672a\u53d1\u73b0 [".concat(t.name,"] \u7684\u4e8b\u4ef6"),morePlotEventTips:"QTE\u7684\u89e6\u53d1\u60c5\u51b5[".concat(t.name,"]\u5305\u542b\u591a\u4e2a\u5267\u60c5\u4e8b\u4ef6")})}}),cc._RF.pop()},{EventExecute:"EventExecute",GameUtil:"GameUtil",StoryData:"StoryData",ValueMgr:"ValueMgr"}],PasswordLockKeyBoard:[function(e,t,i){"use strict";cc._RF.push(t,"8821fMKs+FDzIF5QswildcV","PasswordLockKeyBoard"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},_playKeyPressAudio:function(){e("AudioUtil").playAudio("prefab/passwordLock/key")},onBtnClickNum:function(e,t){AVG_EDITOR||(this._playKeyPressAudio(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PasswordLockInputNum,t))},onBtnClickDel:function(){AVG_EDITOR||(this._playKeyPressAudio(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PasswordLockInputDel))},onBtnClickOpen:function(){AVG_EDITOR||(this._playKeyPressAudio(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PasswordLockInputOpen))},start:function(){}}),cc._RF.pop()},{AudioUtil:"AudioUtil"}],PasswordLock:[function(e,t,i){"use strict";cc._RF.push(t,"47618jQobZEfIyljPZrXRRy","PasswordLock"),cc.Class({extends:e("Observer"),properties:{_inputPwd:"",_data:null,keyBoard:e("PasswordLockKeyBoard"),display:e("PasswordLockDisplay"),_inputResults:[]},_getMsgList:function(){return[cc.AvgMsg.Msg.PasswordLockInputDel,cc.AvgMsg.Msg.PasswordLockInputNum,cc.AvgMsg.Msg.PasswordLockInputOpen]},onLockOpenEvent:function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PasswordLockOpenSucceed,this._data)},onLockFailedEvent:function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PasswordLockOpenFailed,this._data)},_onMsg:function(t,i){var n=this;if(t===cc.AvgMsg.Msg.PasswordLockInputOpen){if(this._data.forbidUnLock)return;if(this._data.isLock)if(this._inputResults.length>=3)console.log("\u8f93\u5165\u9519\u8bef\u6b21\u6570\u8d85\u8fc73\u6b21"),this.display.setLockState();else this._data.password===this._inputPwd?(this._inputResults.push(!0),this.display.updateLights(this._inputResults),this._data.isLock=!1,this.display.setOpenState(),e("AudioUtil").playAudio("prefab/passwordLock/succeed"),this.scheduleOnce(function(){n.onLockOpenEvent()},.6)):(this._data.isLock=!0,this._inputResults.push(!1),this.display.updateLights(this._inputResults),this.display.setErrorState(),this._inputResults.length>=3?(console.log("\u7b2c\u4e09\u6b21\u8f93\u5165\u9519\u8bef,\u5df2\u7ecf\u88ab\u9501\u5b9a"),e("AudioUtil").playAudio("prefab/passwordLock/failed"),this.display.setLockState(),this.scheduleOnce(function(){n.onLockFailedEvent()},.6)):e("AudioUtil").playAudio("prefab/passwordLock/failed"));else console.log("\u5df2\u7ecf\u89e3\u9501");this._inputPwd=""}else if(t===cc.AvgMsg.Msg.PasswordLockInputNum){if(this._data.forbidUnLock)return;if(this._data.isLock){if(this._inputResults.length>=3)return cc.log("\u8fde\u7eed\u4e09\u6b21\u8f93\u5165\u9519\u8bef,\u5df2\u7ecf\u88ab\u9501\u5b9a"),void this.display.setLockState();this._inputPwd.length>=this._data.password.length?console.log("\u5bc6\u7801\u957f\u5ea6\u5df2\u7ecf\u8d85\u51fa"):(this._inputPwd+=i,this.display.updateInput(this._inputPwd))}else cc.log("\u5df2\u7ecf\u89e3\u9501")}else if(t===cc.AvgMsg.Msg.PasswordLockInputDel){if(this._data.forbidUnLock)return;var o=this._inputPwd.length;o>0&&(this._inputPwd=this._inputPwd.slice(0,o-1),this.display.updateInput(this._inputPwd))}},onLoad:function(){this._initMsg(),this.display.updateLights(this._inputResults)},setPwdLockData:function(e){AVG_EDITOR?this.display.inputNum.initInputNum(e.password.length):(this._data=e,e.forbidUnLock?this.display.setLockState():this._data.isLock&&this.display.inputNum.initInputNum(e.password.length))},start:function(){}}),cc._RF.pop()},{AudioUtil:"AudioUtil",Observer:"Observer",PasswordLockDisplay:"PasswordLockDisplay",PasswordLockKeyBoard:"PasswordLockKeyBoard"}],PhoneIM:[function(e,t,i){"use strict";cc._RF.push(t,"612caAlc2RIQqOPlgDu/UId","PhoneIM"),cc.Class({extends:cc.Component,properties:{messagePrefab:cc.Prefab,talkScrollView:cc.ScrollView,closeBtnNode:cc.Node,closeBtnLabel:cc.Label,bgNode:cc.Node},updateView:function(e){this._updateBg(e.bg),this._updateCloseBtn(e.close),this._updateContent(e.content)},_updateBg:function(e){AvgNodeRender.Image(this.bgNode,e)},_updateCloseBtn:function(e){AvgNodeRender.Button(this.closeBtnNode,e)},_updateContent:function(e){AvgNodeRender.Element(this.talkScrollView.node,e);var t=e.emit,i=t.type;t.value;i===AvgData.Type.PhoneIMType.ContentEmit.Time.type||AvgData.Type.PhoneIMType.ContentEmit.Click.type},onLoad:function(){this.talkScrollView.content.destroyAllChildren();for(var e=0;e<10;e++){var t=cc.instantiate(this.messagePrefab);this.talkScrollView.content.addChild(t);t.getComponent("MessageItem")}},start:function(){}}),cc._RF.pop()},{}],PieceNextPreload:[function(e,t,i){"use strict";cc._RF.push(t,"5f75dIuM49EaL+aDxdKM4yL","PieceNextPreload");var n=e("GameUtil"),o=e("StoryData"),a=e("Assets");t.exports={preloadDeep:2,preload:function(e){this.preloadDeep=2,this.calcAndPreloadNextPiece(e)},_loadPieceElements:function(t,i){var n=AvgData.ProjectCfg.PieceFiles,c=t.cfg;if(o.getIsPublish()){var s=cc.StoryConfig.file.scenes.data[c];if(s){var r=s[n.Elements];i&&i(r)}else cc.error("\u9884\u52a0\u8f7d\u753b\u5e03\u5931\u8d25:".concat(c))}else{var l=a.getUrlByUUID(c);l?cc.loader.load("".concat(l,"/").concat(n.Elements),function(o,a){o?console.error(o):cc.loader.load("".concat(l,"/").concat(n.Events),function(n,o){e("StoryEvents").add(t.id,o),i&&i(a)})}):cc.error("\u9884\u52a0\u8f7d\u753b\u5e03\u5931\u8d25:".concat(c))}},calcAndPreloadNextPiece:function(e){var t=this;this._loadPieceElements(e,function(i){if(cc.log("[".concat(t.preloadDeep,"] \u9884\u52a0\u8f7dpiece:").concat(e.name,"(").concat(e.id,")")),t._preloadPieceResources(i),t.preloadDeep--,!(t.preloadDeep<=0)){var n=t._getNextPreloadPiece(i,e);if(n)for(var o=0;o<n.length;o++)t.calcAndPreloadNextPiece(n[o])}})},_preloadPieceResources:function(e){for(var t=AvgUtil.getPieceAllUseRes(e),i=[].concat(t.image,t.audio),n=0;n<i.length;n++){var o=i[n],c=a.getUrlByUUID(o);cc.loader.load(c,function(e,t){e&&cc.log(e)})}for(var s=t.font,r=0;r<s.length;r++){var l=s[r];l!==AvgData.Type.FontType.Font0.font&&AvgPlayer.loadFont(l)}},_getNextPreloadPiece:function(e,t){for(var i=[],a=[],c=0;c<e.length;c++){var s=e[c];if(s.type===AvgData.AvgType.PlotMenu.type)for(var r=s.items,l=0;l<r.length;l++){var d=r[l],u=o.getPieceElementEventDataByID(t.id,d.id),h=n.filterPlotEvents(u);0===h.length?cc.warn("\u672a\u8bbe\u7f6e\u8df3\u8f6c\u5267\u60c5:".concat(JSON.stringify(d))):1===h.length?a.push(h[0].jump):cc.warn("\u5267\u60c5\u9009\u9879\u5305\u542b\u591a\u4e2a\u5267\u60c5\u8df3\u8f6c\u4e8b\u4ef6!")}}if((a=AvgUtil.unique(a)).length>0)for(var g=0;g<a.length;g++){if(a[g]){var p=o.getPlotDataByID(a[g]);if(p){var f=o.getPieceDataByID(p.piece);f&&f[0]&&i.push(f[0])}}}else{var v=o.getNextPieceItemByPlotPiece(t.piece,t.id);if(v)i.push(v);else{var y=o.getPlotDataByPieceID(t.piece),m=o.getNextPlotData(y.id);if(m){var _=o.getPieceDataByID(m.piece);_&&i.push(_[0])}else cc.log("\u9884\u52a0\u8f7d\u6df1\u5ea6\u4e3a".concat(this.preloadDeep,",\u4f46\u662f\u5267\u60c5\u5df2\u7ecf\u7ed3\u675f!")),this.preloadDeep=0}}return i}},cc._RF.pop()},{Assets:"Assets",GameUtil:"GameUtil",StoryData:"StoryData",StoryEvents:"StoryEvents"}],PieceShader:[function(e,t,i){"use strict";cc._RF.push(t,"2e21assU8ZLtaAl8TyIpryO","PieceShader"),t.exports={camera:null,initPieceShader:function(e){this.camera=cc.Camera.main,this.transition=e},setData:function(e,t){this.prePiece=e,this.curPiece=t},runShader:function(t,i,n){if(this.prePiece&&this.curPiece&&this.camera){var o=e("transition-materials")[i];o?(this.transition.material=o,this.transition.transitionTime=t,this.transition.loadNode(this.camera,this.prePiece,this.camera,this.curPiece,function(){n&&n()})):(cc.warn("\u672a\u5b9e\u73b0\u7684material: ".concat(i)),n&&n())}}},cc._RF.pop()},{"transition-materials":"transition-materials"}],PieceTransitionTest:[function(e,t,i){"use strict";cc._RF.push(t,"e8e47kB2BBIxKTTPNvWiaBv","PieceTransitionTest"),cc._RF.pop()},{PieceTransition:"PieceTransition"}],PieceTransition:[function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cc._RF.push(t,"32d21ebjuJOoZyLXxvO0hSD","PieceTransition");var o=AvgData.Type,a=o.PieceSwitchAnimationDirection,c=o.PieceSwitchAnimationEffect,s=e("PieceShader"),r=e("AudioMgr"),l=e("Assets"),d=!1;t.exports={_finishCB:null,prePieceTransitionSoundID:null,init:function(){var e=this;cc.ObserverMgr.addEventListener(cc.AvgMsg.Msg.PauseStory,function(t,i){d=!!i,i?cc.audioEngine.pause(e.prePieceTransitionSoundID):(cc.audioEngine.resume(e.prePieceTransitionSoundID),r.setAudioPlayBackRate(e.prePieceTransitionSoundID))},this)},clearPieceTransitionMusic:function(){null!==this.prePieceTransitionSoundID&&(cc.audioEngine.stopEffect(this.prePieceTransitionSoundID),this.prePieceTransitionSoundID=null)},playPieceTransitionMusic:function(e){var t=this;e&&(this.clearPieceTransitionMusic(),cc.loader.load(e,function(e,i){if(e)cc.log(e);else{var n=cc.audioEngine.playEffect(i,!1);r.setAudioPlayBackRate(n);var o=r.calcVolume(100);cc.audioEngine.setVolume(n,o),d&&cc.audioEngine.pause(n),t.prePieceTransitionSoundID=n}}))},_playMusic:function(e){if(this.clearPieceTransitionMusic(),e){var t=l.getUrlByUUID(e.sound.value);t&&this.playPieceTransitionMusic(t)}},_removePieceImmediately:function(e){if(e)if(e.name===AvgData.AvgType.Root.type){var t=e.getComponent("StoryPiece");t&&cc.ObserverMgr.removeEventListenerWithObject(t),e.isValid&&e.destroy()}else e.destroyAllChildren()},_onFinish:function(){return cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!0),this._finishCB&&this._finishCB()},onTransition:function(e,t,i){var n=this;cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!1);var o=e.node,a=(e.data&&e.data.effect,t.node),r=t.data.effect;if(this._playMusic(r),this._finishCB=i,s.setData(o,a),o){if(!r)return this._removePieceImmediately(o),this._onFinish();o.setPosition(cc.v2(0,0)),a.setPosition(cc.v2(0,0));var l=r.type;c.FadeOut.type===l?(this._adjustZIndex(o,a),this._createFadeOut(o,r,function(){n._removePieceImmediately(o),n._onFinish()})):c.Erasure.type===l?(this._removePieceImmediately(o),this._onFinish()):c.Rotate.type===l?(this._adjustZIndex(a,o),this._createRotate(a,r,function(){n._removePieceImmediately(o),n._onFinish()})):c.PullOut.type===l?(this._adjustZIndex(o,a),this._createPullOut(o,r,function(){n._removePieceImmediately(o),n._onFinish()})):c.PushOut.type===l?this._createPushOut(o,a,r,function(){n._removePieceImmediately(o),n._onFinish()}):c.Insert.type===l?(this._adjustZIndex(a,o),this._createInsert(a,r,function(){n._removePieceImmediately(o),n._onFinish()})):c.None.type===l?(this._removePieceImmediately(o),this._onFinish()):this._onShader(r)||(cc.log("\u4e0d\u652f\u6301\u7684\u52a8\u753b\u7c7b\u578b".concat(l)),this._removePieceImmediately(o),this._onFinish())}else{r||this._onFinish(),a.setPosition(cc.v2(0,0));var d=r.type;c.FadeOut.type===d?this._createFadeIn(a,r,function(){n._onFinish()}):c.Erasure.type===d?this._onFinish():c.Rotate.type===d?this._createRotate(a,r,function(){n._onFinish()}):c.PullOut.type===d?this._createPullOutWithStart(a,r,function(){n._onFinish()}):c.PushOut.type===d?this._createPushOut(null,a,r,function(){n._onFinish()}):c.Insert.type===d?this._createInsert(a,r,function(){n._onFinish()}):c.None.type===d?this._onFinish():this._onShader(r)||(cc.log("\u4e0d\u652f\u6301\u7684\u52a8\u753b\u7c7b\u578b".concat(d)),this._onFinish())}},_onShader:function(e){for(var t=this,i=e.type,o=[{name:"\u95ea\u5149",type:c.Glisten.type,material:"brighten"},{name:"\u6d9f\u6f2a",type:c.Ripple.type,material:"ripple"},{name:"\u5377\u66f2",type:c.Curly.type,material:"inverted-page-curl"}],a=function(n){var a=o[n];if(a.type===i)return setTimeout(function(){s.runShader(e.speed,a.material,function(){t._onFinish()})}),{v:!0}},r=0;r<o.length;r++){var l=a(r);if("object"===n(l))return l.v}return!1},_adjustZIndex:function(e,t){var i=e.zIndex,n=t.zIndex;n===i?(i=e.getSiblingIndex())<(n=t.getSiblingIndex())&&(e.setSiblingIndex(n),t.setSiblingIndex(i)):i<n&&(e.zIndex=n,t.zIndex=i)},_createFadeOut:function(e,t,i){var n=t.speed,o=cc.fadeOut(n);e.opacity=255;var a=cc.callFunc(i);e.runAction(cc.sequence(o,a))},_createFadeIn:function(e,t,i){var n=t.speed,o=cc.fadeIn(n);e.opacity=0;var a=cc.callFunc(i);e.runAction(cc.sequence(o,a))},_createRotate:function(e,t,i){var n=t.speed,o=cc.scaleTo(n,1).easing(cc.easeBounceInOut(3)),a=cc.rotateTo(n,720);e.scale=.5;var c=cc.spawn([o,a]),s=cc.callFunc(i);e.runAction(cc.sequence(c,s))},_createPullOutWithStart:function(e,t,i){var n=t.speed,o=t.direction,c=cc.view.getDesignResolutionSize(),s=cc.v2(0,0);a.Right.type===o?s.x=-c.width:a.Left.type===o?s.x=c.width:a.Up.type===o?s.y=-c.height:a.Down.type===o&&(s.y=c.height),e.setPosition(s);var r=cc.moveTo(n,cc.v2(0,0)).easing(cc.easeOut(3)),l=cc.callFunc(i);e.runAction(cc.sequence([r,l]))},_createPullOut:function(e,t,i){var n=t.speed,o=t.direction,c=cc.view.getDesignResolutionSize(),s=cc.v2(0,0);a.Right.type===o?s.x=c.width:a.Left.type===o?s.x=-c.width:a.Up.type===o?s.y=c.height:a.Down.type===o&&(s.y=-c.height);var r=cc.moveTo(n,s).easing(cc.easeOut(3)),l=cc.callFunc(i);e.runAction(cc.sequence([r,l]))},_createInsert:function(e,t,i){var n=t.speed,o=t.direction,c=cc.v2(0,0),s=cc.v2(0,0),r=cc.view.getDesignResolutionSize();a.Right.type===o?c.x=-r.width:a.Left.type===o?c.x=r.width:a.Up.type===o?c.y=-r.height:a.Down.type===o&&(c.y=r.height),e.setPosition(c);var l=cc.moveTo(n,s),d=cc.callFunc(i);e.runAction(cc.sequence(l,d))},_createPushOut:function(e,t,i,n){var o=i.speed,c=i.direction,s=cc.view.getDesignResolutionSize(),r={start:cc.v2(0,0),end:cc.v2(0,0)},l={start:cc.v2(0,0),end:cc.v2(0,0)};if(a.Right.type===c?(r.start.x=0,r.end.x=s.width,l.start.x=-s.width,l.end.x=0):a.Left.type===c?(r.start.x=0,r.end.x=-s.width,l.start.x=s.width,l.end.x=0):a.Up.type===c?(r.start.y=0,r.end.y=s.height,l.start.y=-s.height,l.end.y=0):a.Down.type===c&&(r.start.y=0,r.end.y=-s.height,l.start.y=s.height,l.end.y=0),e){e.setPosition(r.start);var d=cc.moveTo(o,r.end);e.runAction(d)}if(t){t.setPosition(l.start);var u=cc.moveTo(o,l.end),h=cc.callFunc(n);t.runAction(cc.sequence(u,h))}}},cc._RF.pop()},{Assets:"Assets",AudioMgr:"AudioMgr",PieceShader:"PieceShader"}],PieceUtil:[function(e,t,i){"use strict";cc._RF.push(t,"0ba17hALG5LvbLYW/cvdNkD","PieceUtil"),t.exports={getPieceTipsNode:function(e){for(var t=[],i=AvgData.AvgType,n=e.getChildren(),o=0;o<n.length;o++){var a=n[o],c=a.avgSyncData;if(i.ImageBg.type===c.type||i.ImageHead.type===c.type||i.ImageItem.type===c.type||i.ImageDraw.type===c.type||i.VideoPlot.type===c.type||i.Text.type===c.type){var s=!1,r=a.getComponents("ElementEvent");if(r&&r.length>0)for(var l=0;l<r.length;l++){if(!r[l].isEmit){s=!0;break}}s&&t.push(a)}else if(i.PasswordLock.type===c.type){if(c.isLock)a.getComponent("PasswordLockBox").isTargetEvent||t.push(a)}}return t},blinkNodes:function(e){for(var t=function(t){var i=e[t],n=cc.blink(.5,4);i.stopAllActions(),i.runAction(cc.sequence(n,cc.callFunc(function(){i.active=!0,i.opacity=255})))},i=0;i<e.length;i++)t(i)}},cc._RF.pop()},{}],PlatformVar:[function(e,t,i){"use strict";cc._RF.push(t,"c793fq11h5MnbiM/J6yqS2l","PlatformVar");cc.PlatformVar=t.exports={X5VideoIsFullScreenPlay:!1,SetMenu:{DockBorder:5}},cc._RF.pop()},{}],Project:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}cc._RF.push(t,"599a87Zw2pPtpq3pvu+fNke","Project");var c=e("Account"),s=e("Archive"),r=function(){function e(t){n(this,e),this.id=t,this.musicVolume=1,this.talkSpeed=1,this.autoPlay=!1,this.multipleSpeed=1,this.setButtonPos={x:0,y:0},this.accounts={}}return a(e,[{key:"init",value:function(e){var t=!1;this.musicVolume=e.musicVolume,this.talkSpeed=e.talkSpeed,this.setButtonPos=e.setButtonPos,this.autoPlay=!1,this.multipleSpeed=1;var i=e.accounts;if(i&&Object.keys(i).length>0)for(var n in i){var o=new c(n);o.init(i[n])&&(t=!0),this.accounts[n]=o}else{var a=AvgData.genUUID(),r=new c(a);this.accounts[a]=r;for(var l=1;l<=6;l++){var d=AvgData.genUUID(),u=new s(d);u.name="\u5b58\u6863".concat(l),u.time=moment().format("YYYY/MM/DD HH:mm:ss"),r.archives[d]=u}t=!0}return t}}]),e}();t.exports=r,cc._RF.pop()},{Account:"Account",Archive:"Archive"}],QTECircleProgressDot:[function(e,t,i){"use strict";cc._RF.push(t,"5b5143HPuBBDq1f6RO6PbPk","QTECircleProgressDot"),cc.Class({extends:cc.Component,properties:{dot1:cc.Animation,dot2:cc.Animation},start:function(){},onPause:function(e){e?(this.dot1.pause(),this.dot2.pause(),cc.director.getScheduler().pauseTarget(this),this.node.pauseAllActions()):(this.dot1.resume(),this.dot2.resume(),cc.director.getScheduler().resumeTarget(this),this.node.resumeAllActions())},runPreviewDot:function(){var e=this,t=this.dot1.defaultClip.duration,i=this.dot2.defaultClip.duration;t>i&&(i=t),this.node.stopAllActions(),this._resetDot(),this._playAni(),this.node.runAction(cc.sequence(cc.delayTime(2*i),cc.callFunc(function(){e._resetDot()})))},_resetDot:function(){this.dot1.stop(),this.dot2.stop(),this.dot1.node.scale=1,this.dot1.node.opacity=120,this.dot2.node.scale=.5,this.dot2.node.opacity=120},setDots:function(){this._resetDot(),AVG_EDITOR||this._playAni()},_playAni:function(){this.dot1.play("dot1"),this.dot2.play("dot2")},playDotResultAnimation:function(e,t){var i=this;if(e)this.dot1.stop(),this.dot2.stop(),this.dot1.node.opacity=this.dot2.node.opacity=120,this.dot1.node.runAction(cc.scaleTo(.5,2).easing(cc.easeBackOut())),this.dot2.node.runAction(cc.sequence(cc.scaleTo(.5,1).easing(cc.easeBackOut()),cc.delayTime(.8),cc.callFunc(function(){t&&t()})));else{this.dot1.stop(),this.dot2.stop(),this.dot1.on(cc.Animation.EventType.FINISHED,function(){i.scheduleOnce(function(){t&&t()},.3)}),this.dot1.play("dot-broken");var n=cc.fadeOut(.5);this.dot2.node.runAction(n)}}}),cc._RF.pop()},{}],QTEEvent:[function(e,t,i){"use strict";cc._RF.push(t,"ec679ReoYtFjoaaeNHIdwT7","QTEEvent");e("GameUtil"),e("ValueMgr"),e("StoryData");cc.Class({extends:cc.Component,properties:{_itemData:null,_pieceID:null},start:function(){},setQTEEventData:function(e,t){this._itemData=e,this._pieceID=t},runQTEEvent:function(t){var i=null;return i=t?this._itemData.result.succeed:this._itemData.result.failed,e("EventExecute").execute(this._pieceID,i.id,!0,{noEventTips:"QTE\u672a\u53d1\u73b0[".concat(i.name,"]\u7684\u4e8b\u4ef6"),morePlotEventTips:"QTE\u7684\u89e6\u53d1\u60c5\u51b5[".concat(i.name,"]\u5305\u542b\u591a\u4e2a\u5267\u60c5\u4e8b\u4ef6")})}}),cc._RF.pop()},{EventExecute:"EventExecute",GameUtil:"GameUtil",StoryData:"StoryData",ValueMgr:"ValueMgr"}],QTENode:[function(e,t,i){"use strict";cc._RF.push(t,"c6c45dv1IRL4aadzcuWzp+r","QTENode");var n=e("chroma");e("QTEPieceMgr"),e("StoryData");cc.Class({extends:e("Observer"),properties:{qte:null,circleRootNode:cc.Node,circle:cc.ProgressBar,circleBar:cc.Node,circleDot:e("QTECircleProgressDot"),lineRootNode:cc.Node,line:cc.ProgressBar,lineBar:cc.Node,arrow:e("ArrowNode"),avgData:null,qteData:null,qteRunSucceed:!1,qteRunIndex:0,_progressTestNode:null},_getMsgList:function(){return[cc.AvgMsg.Msg.PauseStory]},_onMsg:function(e,t){e===cc.AvgMsg.Msg.PauseStory&&(t?(cc.director.getScheduler().pauseTarget(this),this._progressTestNode.pauseAllActions()):(cc.director.getScheduler().resumeTarget(this),this._progressTestNode.resumeAllActions()),this.arrow.node.active&&this.arrow.onPause(t),this.circleDot.node.active&&this.circleDot.onPause(t))},onLoad:function(){this._initMsg(),this._createProgressTestNode()},_createProgressTestNode:function(){var e=this,t=new cc.Node("progress-test-node");this.node.addChild(t),t.on(cc.Node.EventType.ROTATION_CHANGED,function(){var i=t.angle/100;e.circle.progress=i,e.line.progress=i}),this._progressTestNode=t},_getProgressTestNode:function(){return this._progressTestNode||this._createProgressTestNode(),this._progressTestNode},runPreview:function(){var e=this.qteData.emitType;e===AvgData.Type.QTEEmitType.SlideUp.type||e===AvgData.Type.QTEEmitType.SlideDown.type||e===AvgData.Type.QTEEmitType.SlideUpDown.type||e===AvgData.Type.QTEEmitType.SlideLeft.type||e===AvgData.Type.QTEEmitType.SlideRight.type||e===AvgData.Type.QTEEmitType.SlideLeftRight.type?this.arrow.runPreviewArrow():e===AvgData.Type.QTEEmitType.Click.type&&this.circleDot.runPreviewDot()},_colorDarken:function(e){return n(e).darken(5).hex()},resizeQTE:function(){},onResetQTE:function(){this.updateQTEType(this.avgData),this.updateQTEColorAndProgress(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPieceAnimationSpawnReplay)},_hideProgress:function(){var e=this.qteData.emitType;e===AvgData.Type.QTEEmitType.SlideUp.type||e===AvgData.Type.QTEEmitType.SlideDown.type||e===AvgData.Type.QTEEmitType.SlideLeft.type||e===AvgData.Type.QTEEmitType.SlideUpDown.type||e===AvgData.Type.QTEEmitType.SlideRight.type?this.line.node.runAction(cc.fadeOut(.3)):e===AvgData.Type.QTEEmitType.Click.type&&this.circle.node.runAction(cc.fadeOut(.3))},onQTEOver:function(e){if(this._offAllLineAndCircleRootTouchEvent(),this.unschedule(this._qteTimerEnd),this._getProgressTestNode().stopAllActions(),this.qte){var t=this.qte.node.getComponent("QTEEvent");if(t){if(t.runQTEEvent(e))return}else cc.log("\u8be5qte\u6ca1\u6709\u6302\u5728\u4efb\u4f55\u4e8b\u4ef6!")}else cc.warn("\u672a\u8bbe\u7f6eqte!");if(e)this._hideProgress(),this._removeQTE(e);else{this.qteData.emitType===AvgData.Type.QTEEmitType.Click.type&&this.circle.node.runAction(cc.fadeOut(.3));var i=this.avgData.unFinished;i.reStart?this.onResetQTE():i.rePlay?cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnQTEReloadCurPiece):this._removeQTE(e)}},_removeQTE:function(e){var t=this,i=this.qteData.emitType;AvgData.Type.QTEEmitType.SlideRight.type===i||AvgData.Type.QTEEmitType.SlideLeft.type===i||AvgData.Type.QTEEmitType.SlideUp.type===i||AvgData.Type.QTEEmitType.SlideDown.type===i||AvgData.Type.QTEEmitType.SlideLeftRight.type===i||AvgData.Type.QTEEmitType.SlideUpDown.type===i?this.arrow.playResultAni(e,function(){t.qte&&(t.qte.node.destroy(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPieceAnimationSpawnNext,t.qte.node.uuid))}):AvgData.Type.QTEEmitType.Click.type===i&&this.circleDot.playDotResultAnimation(e,function(){t.qte&&(t.qte.node.destroy(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPieceAnimationSpawnNext,t.qte.node.uuid))})},_onClickTouchEvent:function(){this.clickData.cur++,cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnQTEProgress,{id:this.qteData.id,type:this.qteData.emitType,progress:this.clickData.cur/this.clickData.total}),this.clickData.cur>=this.clickData.total&&(this.circle.node.off(cc.Node.EventType.TOUCH_START,this._onClickTouchEvent,this),this.onQTEOver(!0))},_printScheduleInfo:function(e){var t=cc.director.getScheduler()._hashForTimers[this._id];return t&&t.timers?(cc.warn("[".concat(e,"]: timers=").concat(t.timers.length)),!1):(cc.warn("[".concat(e,"]:\u6ca1\u6709\u53d1\u73b0\u5b9a\u65f6\u5668")),!0)},_updateQTETimerColor:function(e){var t=e.timer;if(t){var i=t.colorTop,n=t.colorBottom;this.circle.node.color=cc.color(n),this.circleBar.color=cc.color(i),this.line.node.color=cc.color(n),this.lineBar.color=cc.color(i),this.line.node.opacity=this.circle.node.opacity=t.opacity}},_updateQTEIconStyle:function(e){var t=e.icon;if(t){this.circleDot.node.opacity=this.arrow.node.opacity=t.opacity;var i=cc.color(t.color);this._setAllChildrenColor(this.arrow.node,i),this._setAllChildrenColor(this.circleDot.node,i)}},_setAllChildrenColor:function(e,t){e.color=t;for(var i=0;i<e.children.length;i++){var n=e.children[i];this._setAllChildrenColor(n,t)}},updateQTEType:function(e){this.avgData=e,this.qteData=e.qte;var t=this.qteData.emitType;this.arrow.setArrowDirection(t),this.circleDot.setDots(),this.circleDot.node.opacity=this.arrow.node.opacity=255,this.circleRootNode.active=this.lineRootNode.active=!1,this.circleRootNode.opacity=this.lineRootNode.opacity=255,this.circle.node.stopAllActions(),this.circle.node.opacity=this.line.node.opacity=255,this.circleRootNode.setPosition(0,0),this.lineRootNode.setPosition(0,0),this._updateQTEIconStyle(this.qteData),this._updateQTETimerColor(this.qteData),AVG_EDITOR||cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnQTEProgress,{id:this.qteData.id,type:this.qteData.emitType,progress:0}),AvgData.Type.QTEEmitType.Click.type===t?this.circleRootNode.active=!0:AvgData.Type.QTEEmitType.SlideRight.type===t?this.lineRootNode.active=!0:AvgData.Type.QTEEmitType.SlideLeft.type===t?this.lineRootNode.active=!0:AvgData.Type.QTEEmitType.SlideUp.type===t?this.lineRootNode.active=!0:AvgData.Type.QTEEmitType.SlideDown.type===t?this.lineRootNode.active=!0:AvgData.Type.QTEEmitType.SlideLeftRight.type===t?this.lineRootNode.active=!0:AvgData.Type.QTEEmitType.SlideUpDown.type===t&&(this.lineRootNode.active=!0)},_addQTEEvent:function(){var e=this.qteData,t=e.emitType;AvgData.Type.QTEEmitType.Click.type===t?AVG_EDITOR||(this.clickData={total:e.clickCount||0,cur:0},this.circle.node.off(cc.Node.EventType.TOUCH_START,this._onClickTouchEvent,this),this.circle.node.on(cc.Node.EventType.TOUCH_START,this._onClickTouchEvent,this)):AvgData.Type.QTEEmitType.SlideRight.type===t?AVG_EDITOR||this._onSlidEvent():AvgData.Type.QTEEmitType.SlideLeft.type===t?AVG_EDITOR||this._onSlidEvent():AvgData.Type.QTEEmitType.SlideUp.type===t?AVG_EDITOR||this._onSlidEvent():AvgData.Type.QTEEmitType.SlideDown.type===t?AVG_EDITOR||this._onSlidEvent():AvgData.Type.QTEEmitType.SlideLeftRight.type===t?AVG_EDITOR||this._onRepeatSlidEvent():AvgData.Type.QTEEmitType.SlideUpDown.type===t&&(AVG_EDITOR||this._onRepeatSlidEvent())},_offAllLineAndCircleRootTouchEvent:function(){var e=this.lineRootNode;e.off(cc.Node.EventType.TOUCH_START,this._onRepeatSlidTouchStart,this),e.off(cc.Node.EventType.TOUCH_MOVE,this._onRepeatSlidTouchMove,this),e.off(cc.Node.EventType.TOUCH_END,this._onRepeatSlidTouchEnd,this),e.off(cc.Node.EventType.TOUCH_START,this._onSlidTouchStart,this),e.off(cc.Node.EventType.TOUCH_END,this._onSlidTouchEnd,this),this.circle.node.off(cc.Node.EventType.TOUCH_START,this._onClickTouchEvent,this)},_onRepeatSlidTouchStart:function(e,t){this.beganPos=this.prePos=e.getLocation(),this.curSlideCount=0,this.curSlideDirection=null,this.isDeal=!1},_onRepeatSlidTouchMove:function(e,t){var i=e.getLocation(),n=this.qteData.emitType,o=this.qteData.clickCount;if(AvgData.Type.QTEEmitType.SlideLeftRight.type===n){if(i.x>this.prePos.x)null!==this.curSlideDirection&&"left"!==this.curSlideDirection||(this.isDeal=!1,this.beganPos=this.prePos),this.curSlideDirection="right",this.isDeal||i.sub(this.beganPos).mag()>100&&(this.curSlideCount++,this.isDeal=!0);else if(i.x<this.prePos.x){if(null!==this.curSlideDirection&&"right"!==this.curSlideDirection||(this.isDeal=!1,this.beganPos=this.prePos),this.curSlideDirection="left",!this.isDeal)i.sub(this.beganPos).mag()>100&&(this.curSlideCount++,this.isDeal=!0)}}else if(AvgData.Type.QTEEmitType.SlideUpDown.type===n){if(i.y>this.prePos.y){if(null!==this.curSlideDirection&&"down"!==this.curSlideDirection||(this.isDeal=!1,this.beganPos=this.prePos),this.curSlideDirection="up",!this.isDeal)i.sub(this.beganPos).mag()>100&&(this.curSlideCount++,this.isDeal=!0)}else if(i.y<this.prePos.y){if(null!==this.curSlideDirection&&"up"!==this.curSlideDirection||(this.isDeal=!1,this.beganPos=this.prePos),this.curSlideDirection="down",!this.isDeal)i.sub(this.beganPos).mag()>100&&(this.curSlideCount++,this.isDeal=!0)}}this.prePos=i;var a=this.curSlideCount/2/o;cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnQTEProgress,{id:this.qteData.id,type:this.qteData.emitType,progress:a}),a>=1&&this.onQTEOver(!0)},_onRepeatSlidTouchEnd:function(e){this.beganPos=this.prePos=null,this.curSlideCount=2*Math.floor(this.curSlideCount/2),this.curSlideDirection=null,this.isDeal=!1},_onRepeatSlidEvent:function(){var e=cc.view.getDesignResolutionSize();this.lineRootNode.setContentSize(2*e.width,2*e.height);var t=this.lineRootNode;this._offAllLineAndCircleRootTouchEvent(),t.on(cc.Node.EventType.TOUCH_START,this._onRepeatSlidTouchStart,this),t.on(cc.Node.EventType.TOUCH_MOVE,this._onRepeatSlidTouchMove,this),t.on(cc.Node.EventType.TOUCH_END,this._onRepeatSlidTouchEnd,this)},_onSlidTouchStart:function(e){this.beganPos=e.getLocation()},_onSlidTouchEnd:function(e){this.endPos=e.getLocation();var t=!1;if(this.endPos.sub(this.beganPos).mag()>80){var i=Math.abs(this.endPos.x-this.beganPos.x),n=Math.abs(this.endPos.y-this.endPos.y),o=this.qteData.emitType;AvgData.Type.QTEEmitType.SlideUp.type===o?this.endPos.y>this.beganPos.y&&i<100&&(t=!0):AvgData.Type.QTEEmitType.SlideDown.type===o?this.endPos.y<this.beganPos.y&&i<100&&(t=!0):AvgData.Type.QTEEmitType.SlideLeft.type===o?this.endPos.x<this.beganPos.x&&n<100&&(t=!0):AvgData.Type.QTEEmitType.SlideRight.type===o&&this.endPos.x>this.beganPos.x&&n<100&&(t=!0)}t&&this.onQTEOver(!0)},_onSlidEvent:function(){var e=cc.view.getDesignResolutionSize();this.lineRootNode.setContentSize(2*e.width,2*e.height);var t=this.lineRootNode;this._offAllLineAndCircleRootTouchEvent(),t.on(cc.Node.EventType.TOUCH_START,this._onSlidTouchStart,this),t.on(cc.Node.EventType.TOUCH_END,this._onSlidTouchEnd,this)},updateQTEColorAndProgress:function(){if(AVG_EDITOR?this._updateProgress(.5):this._updateProgress(0),this.qteData){this.qteData.style.color;this.qteData.timer.enabled?this.line.node.active=!0:(this.circle.progress=0,this.line.node.active=!1)}},runQTETiming:function(){var e=this.qteData.timer;if(this._addQTEEvent(),e.enabled)if(AVG_EDITOR)this._updateProgress(.5);else{this._updateProgress(0);var t=e.time,i=this._getProgressTestNode();i.angle=100,i.stopAllActions(),i.runAction(cc.rotateTo(t,0)),this.schedule(this._qteTimerEnd,t)}else cc.log("QTE \u6ca1\u6709\u542f\u7528\u5b9a\u65f6\u5668!")},_qteTimerEnd:function(){this.onQTEOver(!1)},_updateProgress:function(e){e=1-e,this.circle.progress=e,this.line.progress=e}}),cc._RF.pop()},{ArrowNode:"ArrowNode",Observer:"Observer",QTECircleProgressDot:"QTECircleProgressDot",QTEPieceMgr:"QTEPieceMgr",StoryData:"StoryData",chroma:"chroma"}],QTEPieceMgr:[function(e,t,i){"use strict";cc._RF.push(t,"8071dzhwBdFP68R729BoWdm","QTEPieceMgr"),t.exports={pieceQTEArray:[],onPieceLoaded:function(){this.pieceQTEArray=[]},addQTE:function(e){this.pieceQTEArray.push(e)},onAniSortOver:function(){},onAnimationIndex:function(e,t){e.getComponent("QTE");this.pieceQTEArray.sort(function(e,t){return e.qteRunIndex-t.qteRunIndex})},onQTEFailed:function(e){for(var t=0;t<this.pieceQTEArray.length;t++){this.pieceQTEArray[t].onResetQTE()}var i=e.qteData.unFinished;i.reStart||i.rePlay&&cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnQTEReloadCurPiece)},onQTESucceed:function(e){}},cc._RF.pop()},{}],QTEProgress:[function(e,t,i){"use strict";cc._RF.push(t,"992b36AcoZDlZC3rjsbbg4f","QTEProgress"),cc.Class({extends:e("Observer"),properties:{mask:cc.Mask,qteData:null},_getMsgList:function(){return[cc.AvgMsg.Msg.OnQTEProgress]},_onMsg:function(e,t){cc.AvgMsg.Msg.OnQTEProgress===e&&this.qteData&&this.qteData.qte.id===t.id&&this.setWaveProgress(t)},onLoad:function(){this._initMsg();var e=cc.view.getDesignResolutionSize();this.node.width=e.width,this.node.height=3*e.height,this.mask},setQTERuntimeProgressData:function(e){this.qteData=e,this.node.active=!0;var t=e.qte.emitType;AvgData.Type.QTEEmitType.SlideUp.type===t||AvgData.Type.QTEEmitType.SlideDown.type===t||AvgData.Type.QTEEmitType.SlideLeft.type===t||AvgData.Type.QTEEmitType.SlideRight.type===t?this.node.active=!1:AvgData.Type.QTEEmitType.Press.type===t?this.node.active=!0:AvgData.Type.QTEEmitType.SlideUpDown.type!==t&&AvgData.Type.QTEEmitType.Click.type!==t&&AvgData.Type.QTEEmitType.SlideLeftRight.type!==t||1===e.qte.clickCount&&(this.node.active=!1)},setWaveProgress:function(e){var t=e.progress,i=cc.view.getVisibleSize().height*t;if(e.type===AvgData.Type.QTEEmitType.None.type)this.node.y=i;else{e.type,AvgData.Type.QTEEmitType.Click.type,this.node.stopAllActions();var n=cc.moveTo(.3,cc.v2(this.node.x,i));this.node.runAction(n)}},start:function(){}}),cc._RF.pop()},{Observer:"Observer"}],QTETest:[function(e,t,i){"use strict";cc._RF.push(t,"193dcBXxp9B6ZlBdFAwJdMz","QTETest"),cc._RF.pop()},{}],QTE:[function(e,t,i){"use strict";cc._RF.push(t,"3a48fW+jgxHSIK5vrDgxPYm","QTE");e("QTEPieceMgr");cc.Class({extends:cc.Component,properties:{qteNodeScript:e("QTENode"),blockNode:cc.Node,maskNode:cc.Node,progressNode:cc.Node,progressInstanceNode:cc.Node,qteLabel:cc.Label},onLoad:function(){},runPreviewInEditor:function(){this.qteNodeScript.runPreview()},hideQTE:function(){this.node.opacity=0},onAnimationPlay:function(){this._addBlockInputEvents()},createQTE:function(e,t,i){AVG_EDITOR||(this._createBlockNode(),this._createRunTimeProgress(e)),this._createMask(e),this._createQteNode(e,t,i)},createQTELabelNode:function(){var e=new cc.Node("qte-label");return this.node.addChild(e,4),this.qteLabel=e.addComponent(cc.Label),e},_updateQTELabel:function(e){if(this.qteLabel){this.qteLabel.node.active=!0,this.qteLabel.string=e.text,this.qteLabel.node.opacity=e.opacity,this.qteLabel.updateLabelByFontInfo(e.font);var t=e.position;this.qteLabel.node.setPosition(cc.v2(t.x,t.y))}},_createBlockNode:function(){var e=new cc.Node("QTE-block-node");e.width=e.height=3e3,this.blockNode=e,this.node.addChild(e)},_createMask:function(e){var t=this,i=new cc.Node("qte-mask"),n=i.addComponent(cc.Sprite);this.node.addChild(i,1),this.maskNode=i,cc.loader.loadRes("single-color-sprite",cc.SpriteFrame,function(i,o){i?cc.error(i):(n.spriteFrame=o,t.updateQTEMask(e.mask))})},updateQTEMask:function(e){var t=this.maskNode;if(t){var i=cc.size(0,0);if(AVG_EDITOR?(i.width=Editor.Set.DesignSize.width,i.height=Editor.Set.DesignSize.height):i=cc.view.getVisibleSize(),t.setContentSize(i.width,i.height),this.node.parent){var n=cc.view.getVisibleSize(),o=cc.v2(n.width/2,n.height/2),a=this.node.convertToNodeSpaceAR(o);t.setPosition(a)}e&&(t.active=!!e.active,t.color=cc.color(e.color),t.opacity=e.opacity)}},_createRunTimeProgress:function(e){var t=this;cc.loader.loadRes("prefab/qte/QTEProgress",function(i,n){if(!i){t.progressNode=new cc.Node("progressNode"),t.node.addChild(t.progressNode,2);var o=cc.view.getVisibleSize(),a=cc.v2(o.width/2,0),c=t.node.convertToNodeSpaceAR(a);t.progressNode.setPosition(c);var s=cc.instantiate(n);t.progressInstanceNode=s,t.progressNode.addChild(s);var r=s.getComponent("QTEProgress");r&&(r.setQTERuntimeProgressData(e),r.setWaveProgress({type:AvgData.Type.QTEEmitType.None.type,progress:0}))}})},_createQteNode:function(e,t,i){var n=this;AvgPlayer.PreloadPrefab.prefabs.QTENode.prefab?this._instanceQTENode(AvgPlayer.PreloadPrefab.prefabs.QTENode.prefab,e,t,i):cc.loader.loadRes("prefab/qte/QTENode",function(o,a){o||n._instanceQTENode(a,e,t,i)})},_instanceQTENode:function(e,t,i,n){var o=cc.instantiate(e);i.addChild(o,3),this.qteNodeScript=o.getComponent("QTENode"),this.qteNodeScript.qte=this,this._updateQTENode(t),AVG_EDITOR&&n&&n(o)},_updateQTENode:function(e){if(this.qteNodeScript){this.qteNodeScript.updateQTEType(e),this.qteNodeScript.updateQTEColorAndProgress();var t=this._getQTENodeOriginSize(e);if(t){var i=e.qte.size.width/t.width;this.qteNodeScript&&(this.qteNodeScript.node.scale=i)}}},_getQTENodeOriginSize:function(e){var t=e.qte.emitType,i=null;return AvgData.Type.QTEEmitType.Click.type===t?i=cc.size(235,235):AvgData.Type.QTEEmitType.SlideUpDown.type!==t&&AvgData.Type.QTEEmitType.SlideUp.type!==t&&AvgData.Type.QTEEmitType.SlideDown.type!==t&&AvgData.Type.QTEEmitType.SlideLeftRight.type!==t&&AvgData.Type.QTEEmitType.SlideLeft.type!==t&&AvgData.Type.QTEEmitType.SlideRight.type!==t||(i=cc.size(430,180)),i},calcQTENodeNewSize:function(e){var t=this._getQTENodeOriginSize(e),i=t.width,n=t.height,o=e.qte.size.width,a=o/i;return cc.size(o,n*a)},updateQTE:function(e){this._updateQTENode(e),this._updateQTELabel(e.tips),this.updateQTEMask(e.mask)},_addBlockInputEvents:function(){var e=this.blockNode;e?e.getComponent(cc.BlockInputEvents)||e.addComponent(cc.BlockInputEvents):cc.error("\u8fd0\u884c\u65f6QTE\u672a\u6b63\u786e\u521b\u5efaBlockNode!")},startUpQTE:function(){this.node.opacity=255,this.node.active=!0,this.qteNodeScript.runQTETiming()},update:function(e){}}),cc._RF.pop()},{QTENode:"QTENode",QTEPieceMgr:"QTEPieceMgr"}],QuickInsertNode:[function(e,t,i){"use strict";cc._RF.push(t,"65522WlZlZPlK7sBxmomZYw","QuickInsertNode"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){var e=this;this.node.on("mousedown",function(t){0===t.getButton()&&Editor.Ipc.emit(Editor.Msg.QuickInsert.Add,e.data)},this)},setHelperInsertData:function(e){this.data=e},onBtnClickClose:function(){Editor.Ipc.emit(Editor.Msg.QuickInsert.Close,this.data)},onBtnClickInsert:function(e){}}),cc._RF.pop()},{}],QuickInsert:[function(e,t,i){"use strict";cc._RF.push(t,"021b7OO2AVG85upxiASWKnN","QuickInsert");var n={addInsertSceneBtn:function(e,t){var i=null;i=Editor.Set.isVerticalMode()?{dir:"vertical/scene",pos:cc.v2(0,256)}:{dir:"horizontal/scene",pos:cc.v2(-61,184)},this._add(i,e,t)},addInsertRoleBtn:function(e,t){var i=null;i=Editor.Set.isVerticalMode()?{dir:"vertical/role",pos:cc.v2(0,-210)}:{dir:"horizontal/role",pos:cc.v2(-333,-147)},this._add(i,e,t)},_add:function(e,t,i){cc.loader.loadRes("quickInsert/".concat(e.dir),function(n,o){if(n)cc.error(n);else{var a=cc.instantiate(o);a.setPosition(e.pos),t.addChild(a);var c=a.getComponent("QuickInsertNode");c&&c.setHelperInsertData(i)}})}};t.exports=window.QuickInsert=n,cc._RF.pop()},{}],SetButton:[function(e,t,i){"use strict";cc._RF.push(t,"a5acc7TiNVAhqevNZTeHh3G","SetButton");e("LocalStorage");cc.Class({extends:e("Observer"),properties:{openStateNode:cc.Node,closeStateNode:cc.Node},_getMoveArea:function(){var e=cc.view.getVisibleSize(),t=e.height/2-this.node.height/2-this.buttonMargin.top,i=-(e.height/2-this.node.height/2-this.buttonMargin.bottom),n=e.width/2-this.node.width/2-this.buttonMargin.right;return{top:t,bottom:i,left:-(e.width/2-this.node.width/2-this.buttonMargin.left),right:n}},_getMsgList:function(){return[cc.AvgMsg.Msg.WindowResize]},_onMsg:function(e,t){if(e===cc.AvgMsg.Msg.WindowResize){var i=this._getDockPosition(this.node.getPosition());this.node.setPosition(i),GameDB.SetButtonPos=i}},onLoad:function(){this._initMsg(),this.buttonMargin={top:0,right:0,left:0,bottom:0},this._initButtonState(),this._initTouch()},_initTouch:function(){var e=this,t=!1,i=cc.v2(0,0);this.node.on(cc.Node.EventType.TOUCH_START,function(){t=!1,i=e.node.getPosition()},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(i){t=!0;var n=e.node.getPosition(),o=i.getDelta();n.x+=o.x,n.y+=o.y;var a=e._getMoveArea();n.x>a.right&&(n.x=a.right),n.x<a.left&&(n.x=a.left),n.y>a.top&&(n.y=a.top),n.y<a.bottom&&(n.y=a.bottom),e.node.setPosition(n)},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){e._onEndMove(t,i)}),this.node.on(cc.Node.EventType.TOUCH_END,function(){e._onEndMove(t,i)},this)},_onEndMove:function(e,t){if(e){var i=this._getDockPosition(this.node.getPosition()),n=cc.moveTo(.3,i).easing(cc.easeOut(3));this.node.runAction(n),GameDB.SetButtonPos=i,this.node.getPosition().sub(t).mag()<=10&&cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowSetPanel,this.node.x)}else cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowSetPanel,this.node.x)},_getDockPosition:function(e){var t=this._getMoveArea(),i=cc.v2(e.x,e.y),n=cc.PlatformVar.SetMenu.DockBorder;return e.x>=0?i.x=t.right-n:i.x=t.left+n,i},_initButtonState:function(){this.openStateNode.active=!1,this.closeStateNode.active=!0;var e=GameDB.SetButtonPos;if(e){var t=this._getDockPosition(e);this.node.setPosition(t),t.x!==e.x&&t.y!==e.y&&(GameDB.SetButtonPos=t)}else{var i=this._getMoveArea(),n=cc.view.getVisibleSize(),o=cc.v2(i.right,n.height/2-150);this.node.setPosition(o),GameDB.SetButtonPos=o}}}),cc._RF.pop()},{LocalStorage:"LocalStorage",Observer:"Observer"}],SetNodeTest:[function(e,t,i){"use strict";cc._RF.push(t,"cd7d3S+r9xF1YBxOIfeDSdA","SetNodeTest"),cc._RF.pop()},{}],SetPanel:[function(e,t,i){"use strict";cc._RF.push(t,"030c5x9rhRBDKOuKBNtjmKL","SetPanel");e("LocalStorage");cc.Class({extends:e("Observer"),_getMsgList:function(){return[cc.AvgMsg.Msg.InSetLayerUpdateVolume,cc.AvgMsg.Msg.WindowResize]},_onMsg:function(e,t){if(e===cc.AvgMsg.Msg.InSetLayerUpdateVolume)this._initVolume();else if(e===cc.AvgMsg.Msg.WindowResize){var i=this._getShowPos();this.node.setPosition(i.endPos)}},properties:{voiceProgressBar:cc.ProgressBar,voiceSlideBar:cc.Slider,autoPlayBtn:e("switchBtn"),toggle1_0:cc.Toggle,toggle1_25:cc.Toggle,toggle1_5:cc.Toggle,toggle2_0:cc.Toggle},_initVolume:function(){var e=GameDB.MusicVolume;this.voiceProgressBar.progress=this.voiceSlideBar.progress=e},onLoad:function(){this._initMsg(),this._initVolume();var e=GameDB.MultipleSpeed;1===e?this.toggle1_0.check():1.25===e?this.toggle1_25.check():1.5===e?this.toggle1_5.check():2===e&&this.toggle2_0.check();var t=GameDB.AutoPlay;this.autoPlayBtn.setOpenState(t),this.autoPlayBtn.switchCallBack=function(e){GameDB.AutoPlay=e}},_getShowPos:function(){var e=this.isLeft,t=cc.view.getVisibleSize(),i=cc.v2(0,0),n=cc.v2(0,0);return e?(n.x=-(t.width/2+this.node.width/2),i.x=-(t.width/2-this.node.width/2-0)):(n.x=t.width/2+this.node.width/2,i.x=t.width/2-this.node.width/2-0),{beganPos:n,endPos:i}},showPanel:function(e){this.isLeft=e;var t=this._getShowPos(),i=t.endPos,n=t.beganPos;this.node.setPosition(n);var o=cc.moveTo(.2,i).easing(cc.easeOut(3));this.node.runAction(o)},_getHidePos:function(){var e=this.isLeft,t=cc.view.getVisibleSize(),i=cc.v2(0,0);return i.x=e?-(t.width/2+this.node.width/2):t.width/2+this.node.width/2,{endPos:i}},hidePanel:function(e,t){var i=this._getHidePos(),n=cc.moveTo(.2,i.endPos).easing(cc.easeOut(3)),o=cc.callFunc(function(){t&&t()});this.node.stopAllActions(),this.node.runAction(cc.sequence([n,o]))},start:function(){},onSwitchMultipleSpeed:function(e,t){GameDB.MultipleSpeed=parseFloat(t.toString())},onHandVoice:function(){var e=this.voiceSlideBar.progress;this.voiceProgressBar.progress=e,GameDB.MusicVolume=e}}),cc._RF.pop()},{LocalStorage:"LocalStorage",Observer:"Observer",switchBtn:"switchBtn"}],ShieldStoryAnyTouch:[function(e,t,i){"use strict";cc._RF.push(t,"1f5d5PFUbBMu7KMJGW8Mip7","ShieldStoryAnyTouch"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var e=this;this.node.active=!1,this.node.on(cc.Node.EventType.TOUCH_END,function(){console.warn("\u5c4f\u853d\u6545\u4e8b\u7684\u89e6\u6478\u4e8b\u4ef6: ".concat(e.time,"s"))},this)},_onSchedule:function(){this.time--,cc.log("\u5c4f\u853d\u5012\u8ba1\u65f6: ".concat(this.time)),this.time<=0&&this.unschedule(this._onSchedule)},setData:function(e){e.enabled?(this.node.active=!0,this.time=e.time,cc.log("\u5c4f\u853d\u5012\u8ba1\u65f6: ".concat(this.time)),this.unschedule(this._onSchedule),this.schedule(this._onSchedule,1)):this.node.active=!1},start:function(){}}),cc._RF.pop()},{}],StoryAnimations:[function(e,t,i){"use strict";cc._RF.push(t,"f126cFdZnhC5qtGOkZeqxMJ","StoryAnimations"),t.exports={allAnis:{},add:function(e,t){this.allAnis[e]=t}},cc._RF.pop()},{}],StoryAudioMgr:[function(e,t,i){"use strict";cc._RF.push(t,"2fbbcySg+tFQYwFhhpvMYOz","StoryAudioMgr"),t.exports={_allEffectID:[],cleanAudioEffect:function(){cc.audioEngine.stopAllEffects()},stopAll:function(){cc.audioEngine.stopMusic(),cc.audioEngine.stopAllEffects()},stopMusic:function(){cc.audioEngine.stopMusic()},playEffect:function(e,t){var i=cc.audioEngine.playEffect(e,t);this._allEffectID.push(i)},playMusic:function(e,t){cc.audioEngine.playMusic(e,t)}},cc._RF.pop()},{}],StoryBagUI:[function(e,t,i){"use strict";cc._RF.push(t,"fe499PkHU1CGKrd+aYTD/Sm","StoryBagUI");var n=AvgData.AvgType,o=null;cc.Class({extends:e("Observer"),_getMsgList:function(){return[cc.AvgMsg.Msg.ShowAvgBagLayer,cc.AvgMsg.Msg.CloseAvgBagLayer,cc.AvgMsg.Msg.ShowBagItemDetails,cc.AvgMsg.Msg.ShowAvgMenuLayer,cc.AvgMsg.Msg.StoryEnd,cc.AvgMsg.Msg.ShowBagGetItems,cc.AvgMsg.Msg.JumpBagListAndSelectGoods,cc.AvgMsg.Msg.BagItemDisplay]},_onMsg:function(t,i){if(t===cc.AvgMsg.Msg.ShowAvgBagLayer)this._loadBagList();else if(t===cc.AvgMsg.Msg.CloseAvgBagLayer)this._closeBagList(!0);else if(t===cc.AvgMsg.Msg.ShowBagItemDetails)o!==i&&(o=i,this._loadBagItemDetails(i));else if(t===cc.AvgMsg.Msg.ShowAvgMenuLayer||t===cc.AvgMsg.Msg.StoryEnd)this.node.destroyAllChildren(),this.bagListScript=null,this._updateBagMenuVisible();else if(t===cc.AvgMsg.Msg.ShowBagGetItems){var n=e("GoodsEvent").ShowType;i.type===n.Text?this._onShowItemsText(i.data):i.type===n.Dialog&&this._onShowGetItems(i.data)}else if(t===cc.AvgMsg.Msg.JumpBagListAndSelectGoods){this.node.destroyAllChildren(),this.bagListScript=null;var a=i[0].uuid,c=0,s=GameDB.getBagItemData(a);s&&(c=s.num),this._loadBagList(a),this._loadBagItemDetails({num:c,cfg:cc.AvgGoods.getItemData(a)})}else t===cc.AvgMsg.Msg.BagItemDisplay&&this.onShowItemDisplay(i)},properties:{bagListScript:null,bagIconNode:cc.Node,_pieceData:null},setPieceData:function(e){this._pieceData=e,this._updateBagMenuVisible()},_updateBagMenuVisible:function(){this._pieceData&&this.bagIconNode&&this.bagIconNode.isValid&&(this.bagIconNode.active=!!this._pieceData.bag)},hideBagMenu:function(){this.bagIconNode&&this.bagIconNode.isValid&&(this.bagIconNode.active=!1)},onLoad:function(){this._initMsg()},start:function(){},_loadPrefab:function(e,t,i){var n=this;cc.loader.loadRes(e,cc.Prefab,function(e,o){if(e)cc.error(e);else{var a=cc.instantiate(o),c=n.node.children.length;n.node.addChild(a,c);var s=a.getComponent(t);s&&i&&i(s)}})},onShowItemDisplay:function(e){var t=e.displayType;t===AvgData.Type.Goods.Display.Images.type?this._loadPrefab("prefab/bag/display/BagItemDisplayImages","BagItemDisplayImages",function(t){t.setDisplayImagesData(e)}):t===AvgData.Type.Goods.Display.Audio.type?this._loadPrefab("prefab/bag/display/audio/BagItemDisplayAudio","BagItemDisplayAudio",function(t){t.setDisplayAudioData(e)}):t===AvgData.Type.Goods.Display.Video.type&&this._loadPrefab("prefab/bag/display/BagItemDisplayVideo","BagItemDisplayVideo",function(t){t.setDisplayVideoData(e)})},_onShowItemsText:function(e){for(var t=0;t<e.length;t++){var i=new AvgData.FontData;i.color="#ffffff";var n=e[t],o=cc.AvgGoods.getItemDataByID(n.id),a="\u83b7\u5f97 ".concat(o.name," x").concat(n.num);cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowValueEvenShowText,{text:a,font:i,backgroundColor:"#000"})}},_onShowGetItems:function(e){var t=null;if(1===e.length?t=cc.StoryConfig.file.bagGetItems1:2===e.length?t=cc.StoryConfig.file.bagGetItems2:3===e.length&&(t=cc.StoryConfig.file.bagGetItems3),t){var i=t.data[0];if(i&&i.type===n.AvgBagGetItems.type){var o=this._createBlockNode("getItems-block",function(){o.destroy()});this.node.addChild(o,3);var a=AvgPlayer.AvgBag.createBagGetItems(i);o.addChild(a);var c=a.getComponent("BagGetItems"),s=[];e.forEach(function(e){var t=cc.AvgGoods.getItemDataByID(e.id);s.push({uuid:t.uuid,num:e.num,cfg:t})}),c.setGetItemsData(s)}}else cc.error("\u83b7\u5f97\u7684\u7269\u54c1\u6570\u91cf\u8fc7\u591a,\u65e0\u6cd5\u5f39\u7a97\u5c55\u793a:".concat(e.toString()))},_closeBagList:function(e){this._closeDetails(),this.bagListScript&&(this.bagListScript.onCloseAction(e),this.bagListScript=null),this._updateBagMenuVisible()},_closeDetails:function(){this.BagItemDetails&&(this.BagItemDetails.onCloseDetailsAction(!0),this.BagItemDetails=null)},_loadBagItemDetails:function(e){this._closeDetails();var t=cc.StoryConfig.file.bagItemDetails.data[0];if(t&&t.type===n.AvgBagItemDetails.type){var i=AvgPlayer.AvgBag.createBagItemDetails(t),o=i.getComponent("BagItemDetails"),a=this._createBlockNode("details-block",function(){});a.setContentSize(0,0),this.node.addChild(a,2),a.addChild(i),o.setBagItemDetailsData(e),o.onShowDetailsAction(),o.setBlockNode(a),this.BagItemDetails=o}},_createBlockNode:function(e,t){var i=new cc.Node(e);i.addComponent(cc.BlockInputEvents);var n=cc.view.getVisibleSize();return i.setContentSize(n),i.on(cc.Node.EventType.TOUCH_END,function(e){e.stopPropagation(),t&&t()}),i},_loadBagList:function(e){var t=this,i=cc.StoryConfig.file.bagItemList.data[0];if(i&&i.type===n.AvgBagItemList.type){this._closeBagList(!1),this.hideBagMenu();var a=this._createBlockNode("bag-list",function(){t.BagItemDetails&&(t.BagItemDetails.isClosing?cc.log("closing bagDetails"):t.BagItemDetails.onCloseDetailsAction(!0,function(){o=null,t.BagItemDetails=null}))}),c=AvgPlayer.AvgBag.createBagItemList(i);a.addChild(c),this.node.addChild(a,1),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.BagListItemSelect,e);var s=c.getComponent("BagItemList");s&&(this.bagListScript=s,s.setBlockNode(a),s.onShowAction(i))}else cc.error("\u80cc\u5305\u5217\u8868\u6570\u636e\u5f02\u5e38")}}),cc._RF.pop()},{GoodsEvent:"GoodsEvent",Observer:"Observer"}],StoryBag:[function(e,t,i){"use strict";cc._RF.push(t,"9471fdn3jtORrW+WxekGgdL","StoryBag"),t.exports={},cc._RF.pop()},{}],StoryConfig:[function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cc._RF.push(t,"783e27man1Dup0FNKgK7FWN","StoryConfig");e("AvgPlayer");var o=AvgData.getUiConfigFiles(),a=AvgData.getBagConfigFiles(),c={file:{init:{data:{},name:"init",url:AvgData.ProjectCfg.init},assets:{data:{},name:"assets",url:AvgData.ProjectCfg.assets},ui:{data:[],name:"ui",url:AvgData.ProjectCfg.ui},entrySet:{data:[],name:"entrySet",url:o.entrySet},piece:{data:[],name:"piece",url:AvgData.ProjectCfg.piece},plot:{data:[],name:"plot",url:AvgData.ProjectCfg.plot},numerical:{data:{},name:"numerical",url:AvgData.ProjectCfg.numerical},goods:{data:{},name:"goods",url:AvgData.ProjectCfg.goods},scenes:{data:[],name:"scenes",url:AvgData.ProjectCfg.scenes},bagItemList:{data:[],name:"bagItemList",url:a.list},bagItemDetails:{data:[],name:"bagItemDetails",url:a.details},bagGetItems1:{data:[],name:"bagGetItems1",url:a.getItems1},bagGetItems2:{data:[],name:"bagGetItems2",url:a.getItems2},bagGetItems3:{data:[],name:"bagGetItems3",url:a.getItems3}},_init:!1,_completeCallBack:null,init:function(t){var i=this;if(!1===this._init){this._init=!0,this._completeCallBack=t,this._index=0,this._totalIndex=0;var n=e("Assets"),o=n.getRealUrl(this.file.init.url);cc.loader.load(o,function(t,o){if(t)console.error(t);else{i.file.init.data=o;var a=e("StoryData");for(var c in a.getIsPublish()?(delete i.file.assets,cc.log("\u5220\u9664assets\u914d\u7f6e")):(delete i.file.video,cc.log("\u5220\u9664video\u914d\u7f6e"),delete i.file.scenes,cc.log("\u5220\u9664scenes\u914d\u7f6e")),i.file)i._totalIndex++;for(var s in i.file){var r=i.file[s],l=n.getRealUrl(r.url);i._loadJson(l,r)}}})}else cc.log("[StoryConfig] has init"),t&&t()},_loadJson:function(t,i){t?cc.loader.load(t,function(e,t,i){},function(o,a){(this._index++,o)?("object"===n(o)?cc.log("\u89e3\u6790\u914d\u7f6e\u6587\u4ef6 ".concat(t," \u5931\u8d25: ").concat(JSON.stringify(o)," ")):"string"==typeof o&&cc.log("\u89e3\u6790\u914d\u7f6e\u6587\u4ef6 ".concat(t," \u5931\u8d25: ").concat(o," ")),i.name===this.file.video.name&&e("StoryData").getIsPublish()&&cc.warn("\u672a\u52a0\u8f7d\u5408\u5e76\u89c6\u9891\u4fe1\u606f\u6587\u4ef6: ".concat(i.url))):a?(i.data=a,cc.log("---------------------------"),cc.log(JSON.stringify(a)),cc.log("---------------------------"),this._onProgress(t),this._index>=this._totalIndex&&this._onComplete()):this._onError(t)}.bind(this)):this._onError(t)},_onProgress:function(e){cc.log("Json loaded: "+e)},_onComplete:function(){cc.log("Json \u52a0\u8f7d\u5b8c\u6210"),this._completeCallBack&&this._completeCallBack()},_onError:function(e){cc.log("Json error: "+e)}};cc.StoryConfig=t.exports=c,cc._RF.pop()},{Assets:"Assets",AvgPlayer:"AvgPlayer",StoryData:"StoryData"}],StoryData:[function(e,t,i){"use strict";cc._RF.push(t,"72aef5yKXtE/bc2AB03D5ss","StoryData");var n=e("StoryConfig");t.exports={getIsPublish:function(){if(window.VideoGroupQuickTestTool.isEnableTest)return!0;var e=cc.StoryConfig.file.init.data;return!(!e||!e.isPublish)},getVideoInfo:function(t,i){if(t){if(!this.getIsPublish())return null;var n=e("Assets").getRealUrl(AvgData.ProjectCfg.videoCfg);n?cc.loader.load(n,function(e,n){e?cc.error(e):i&&i(n[t])}):cc.error("\u83b7\u53d6Video.cfg\u5931\u8d25!")}else i&&i(null)},getUiCfg:function(e){for(var t=cc.StoryConfig.file.ui.data.list[0].list,i=0;i<t.length;i++){var n=t[i];if(n.sub===e)return n}return null},serializePlotArray:[],getTestModeStartPiecePrefab:function(){var e=n.file.init.data.startPiece;if(e){var t=n.file.piece.data;for(var i in t)for(var o=t[i],a=0;a<o.length;a++){var c=o[a];if(c.id===e)return{piece:i,item:c}}return null}return null},getBeganPlot:function(){return this.serializePlotArray[0]},getNextPlotData:function(e){for(var t=0;t<this.serializePlotArray.length;t++){if(this.serializePlotArray[t].id===e)return t===this.serializePlotArray.length-1?null:this._findValidPiece(t+1)}return null},_findValidPiece:function(e){for(var t=e;t<this.serializePlotArray.length;t++){var i=this.serializePlotArray[t],n=this.getPieceDataByID(i.piece);if(n&&n.length>0)return i;cc.log("\u51fa\u73b0\u7a7a\u767d\u5267\u60c5:".concat(i.name))}return null},serializePiece:function(){var e=n.file.piece.data;for(var t in e)for(var i=0;i<e[t].length;i++)e[t][i].piece=t},serializePlot:function(){for(var e=[],t=n.file.plot.data,i=0;i<t.length;i++){var o=t[i];this._serializePlot(o,e)}this.serializePlotArray=e},_serializePlot:function(e,t){e.type===AvgData.Type.Plot.Content&&t.push({id:e.id,name:e.name,piece:e.piece,end:e.end||!1,skip:e.skip||AvgData.Type.PieceAniSkip.Forbid});for(var i=0;i<e.children.length;i++)this._serializePlot(e.children[i],t)},getPlotDataByPieceID:function(e){for(var t=0;t<this.serializePlotArray.length;t++){var i=this.serializePlotArray[t];if(i.piece===e)return i}return null},getPlotDataByID:function(e){for(var t=0;t<this.serializePlotArray.length;t++){var i=this.serializePlotArray[t];if(i.id===e)return i}return null},getPieceDataByPlotID:function(e){var t=this.getPlotDataByID(e);return t?this.getPieceDataByID(t.piece):null},getPieceDataByID:function(e){var t=n.file.piece.data;for(var i in t){var o=t[i];if(i===e)return o}return null},getPieceAnimationDataByID:function(t){var i=e("StoryAnimations").allAnis;for(var n in i)if(n===t)return i[n];return null},getPieceEventsDataByID:function(t){var i=e("StoryEvents").allEvents;for(var n in i)if(n===t)return i[n];return null},getPieceTimeLineData:function(t){var i=e("StoryTimelines").allTimelines;for(var n in i)if(n===t)return i[n];return null},getPieceElementAnimationDataByID:function(e,t){var i=[],n=this.getPieceAnimationDataByID(e);if(n)for(var o=0;o<n.length;o++){var a=n[o];a.element===t&&i.push(a)}return i},getPieceElementEventDataByID:function(e,t){var i=[],n=this.getPieceEventsDataByID(e);if(n)for(var o=0;o<n.length;o++){var a=n[o];a.element===t&&i.push(a)}return i},getPieceElementEventDataByEventID:function(e,t){var i=this.getPieceEventsDataByID(e);if(i)for(var n=0;n<i.length;n++){var o=i[n];if(o.id===t)return o}return null},getNextPieceItemByPieceID:function(e){var t=n.file.piece.data;for(var i in t)for(var o=t[i],a=0;a<o.length;a++){if(o[a].id===e)return a+1>=o.length?null:o[a+1]}return null},getNextPieceItemByPlotPiece:function(e,t){var i=n.file.piece.data;if(i&&i[e])for(var o=i[e],a=0;a<o.length;a++){if(o[a].id===t)return a+1>=o.length?null:o[a+1]}}},cc._RF.pop()},{Assets:"Assets",StoryAnimations:"StoryAnimations",StoryConfig:"StoryConfig",StoryEvents:"StoryEvents",StoryTimelines:"StoryTimelines"}],StoryEvents:[function(e,t,i){"use strict";cc._RF.push(t,"ae931SuPFFFaZ9W9lvDVKiU","StoryEvents"),t.exports={allEvents:{},add:function(e,t){this.allEvents[e]=t}},cc._RF.pop()},{}],StoryGame:[function(e,t,i){"use strict";cc._RF.push(t,"8641dg14NhCe5TefZdA2Jwk","StoryGame");var n=e("GameUtil"),o=e("StoryData"),a=e("StoryPieceAniMgr"),c=e("StoryPlotSkipMgr"),s=(e("LocalStorage"),e("GameData"),e("AudioMgr")),r=e("Assets"),l=e("PieceTransition"),d=(e("ValueMgr"),e("StoryPieceAniMgr")),u=e("StoryConfig"),h=e("VideoUtil"),g=e("StoryPieceResLoader");cc.Class({extends:e("Observer"),properties:{maskBeganGroupNode:{default:null,displayName:"\u88c1\u5207\u5f00\u59cb\u7ec4\u8282\u70b9",type:cc.Node},storyNode:{default:null,displayName:"\u6545\u4e8b\u8282\u70b9",type:cc.Node},touchNode:{default:null,displayName:"\u89e6\u6478\u8282\u70b9",type:cc.Node},uiNode:{default:null,displayName:"UI\u8282\u70b9",type:cc.Node},storyBagUI:e("StoryBagUI"),shieldStoryAnyTouch:{default:null,displayName:"\u5c4f\u853d\u6545\u4e8b\u89e6\u6478\u5c42",tooltip:"\u5f53\u5267\u60c5\u9009\u9879\u505a\u51fa\u9009\u62e9\u7684\u65f6\u5019,\u4e2d\u95f4\u7684\u505c\u7559\u65f6\u95f4\u9700\u8981\u5c4f\u853d\u4efb\u4f55\u5bf9\u6545\u4e8b\u7684\u89e6\u6478\u64cd\u4f5c",type:e("ShieldStoryAnyTouch")},videoDebugPrefab:cc.Prefab,avgMenuNode:{default:null,displayName:"\u83dc\u5355\u6309\u94ae",type:cc.Node},aniSkipNode:{default:null,displayName:"\u8df3\u8fc7\u8282\u70b9",type:cc.Node},calcTips:{default:null,displayName:"\u8ba1\u7b97\u63d0\u793a",type:e("CalcTips")},transition:{default:null,displayName:"\u753b\u5e03\u8f6c\u573a\u7279\u6548",type:e("transitions")},topNode:{default:null,displayName:"\u9876\u90e8\u8282\u70b9",type:cc.Node},videoPlayBtnNode:{default:null,displayName:"\u89c6\u9891\u64ad\u653e\u6309\u94ae\u5c42",type:cc.Node},loadingNode:{default:null,displayName:"\u52a0\u8f7d\u63d0\u793a\u5c42",type:cc.Node},isTest:!1,_piece:null,_pieceData:null,_plotData:null},_getMsgList:function(){return[cc.AvgMsg.Msg.OnGoNextPiece,cc.AvgMsg.Msg.OnJumpNewPlot,cc.AvgMsg.Msg.OnEnableGlobalTouch,cc.AvgMsg.Msg.ShowAvgMenuLayer,cc.AvgMsg.Msg.UiButtonClick,cc.AvgMsg.Msg.ShowValueEvenShowText,cc.AvgMsg.Msg.OnQTEReloadCurPiece,cc.AvgMsg.Msg.ActiveSkipBtn,cc.AvgMsg.Msg.EnterGameFromFileItem,cc.AvgMsg.Msg.ClearAllUI,cc.AvgMsg.Msg.PauseStory,cc.AvgMsg.Msg.X5VideoFullScreen,cc.AvgMsg.Msg.ShowSetPanel,cc.AvgMsg.Msg.AddNodeToVideoBtnLayer,cc.AvgMsg.Msg.OnShieldStoryAnyTouch,cc.AvgMsg.Msg.ShowVideoDebugView]},_getStoryAllActionNodes:function(){for(var e=[],t=this.storyNode.children,i=0;i<t.length;i++){var n=t[i];e.push(n);for(var o=n.children,a=0;a<o.length;a++){var c=o[a];e.push(c);var s=c.avgSyncData.type;s===AvgData.AvgType.QTE||AvgData.AvgType.Talk}}return e},_onMsg:function(e,t){if(e===cc.AvgMsg.Msg.PauseStory)for(var i=this._getStoryAllActionNodes(),n=0;n<i.length;n++){var a=i[n];t?a.pauseAllActions():a.resumeAllActions()}else if(e===cc.AvgMsg.Msg.OnGoNextPiece){var s=t.id,r=o.getNextPieceItemByPlotPiece(this._plotData.piece,s);if(r)this.createPiece(r);else if(this._plotData&&this._plotData.end)this._storyEnd();else{var l=o.getNextPlotData(this._plotData.id);if(l){this._plotData=l,c.resetPlot(l);var d=o.getPieceDataByID(l.piece);d&&(this._pieceData=d,this.createPiece(d[0]))}else this._storyEnd()}}else if(e===cc.AvgMsg.Msg.OnJumpNewPlot){this._playNewPlot(t)}else if(e===cc.AvgMsg.Msg.ShowAvgMenuLayer)this.uiNode.destroyAllChildren(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PauseStory,!0),this._loadUi(AvgData.Type.UiDefault.Menu);else if(e===cc.AvgMsg.Msg.UiButtonClick){var u=t;u===AvgData.Type.UiButton.MenuSave?(cc.AvgGameData.recordEnterFileMgrSource=u,this._loadUi(AvgData.Type.UiDefault.FileMgr)):u===AvgData.Type.UiButton.MenuRead?(cc.AvgGameData.recordEnterFileMgrSource=u,this._loadUi(AvgData.Type.UiDefault.FileMgr)):u===AvgData.Type.UiButton.MenuSet?this._loadUi(AvgData.Type.UiDefault.Env):u===AvgData.Type.UiButton.MenuExit?(this._launchCover(),this._loadUi(AvgData.Type.UiDefault.Cover)):u===AvgData.Type.UiButton.CoverBegan?(GameDB.initLastUseArchive(),this._launchStory()):u===AvgData.Type.UiButton.CoverContinue?(cc.AvgGameData.recordEnterFileMgrSource=u,this._loadUi(AvgData.Type.UiDefault.FileMgr)):u===AvgData.Type.UiButton.CoverSet&&this._loadUi(AvgData.Type.UiDefault.Env)}else if(e===cc.AvgMsg.Msg.OnEnableGlobalTouch)this.touchNode.active=!!t;else if(e===cc.AvgMsg.Msg.ShowValueEvenShowText)this.calcTips.addTips(t);else if(e===cc.AvgMsg.Msg.OnQTEReloadCurPiece)this.createPiece(this._piece.data);else if(e===cc.AvgMsg.Msg.ActiveSkipBtn)this.aniSkipNode.active=!!t;else if(e===cc.AvgMsg.Msg.EnterGameFromFileItem)GameDB.initArchive(),this._launchStory();else if(e===cc.AvgMsg.Msg.ClearAllUI)this.uiNode.destroyAllChildren();else if(e===cc.AvgMsg.Msg.X5VideoFullScreen)this.avgMenuNode;else if(e===cc.AvgMsg.Msg.ShowSetPanel)this._addSetPanel(t);else if(e===cc.AvgMsg.Msg.AddNodeToVideoBtnLayer)this.videoPlayBtnNode&&t&&(this.videoPlayBtnNode.destroyAllChildren(),this.videoPlayBtnNode.addChild(t));else if(e===cc.AvgMsg.Msg.OnShieldStoryAnyTouch)this.shieldStoryAnyTouch.setData(t);else if(e===cc.AvgMsg.Msg.ShowVideoDebugView){var h=cc.VideoDebugTool.createView(this.videoDebugPrefab);this.topNode.addChild(h)}},_initLoading:function(){var e=this;this.loadingNode.active=!1,this.loadingNode.destroyAllChildren(),cc.loader.loadRes(AvgPlayer.PreloadPrefab.prefabs.Loading.url,function(t,i){if(t)cc.error(t);else{var n=cc.instantiate(i);e.loadingNode.addChild(n);n.getComponent("Loading")}})},_addSetPanel:function(e){var t=this;cc.loader.loadRes("set/SetPanel",function(i,n){if(!i){t.setBtnNode.active=!1;var o=new cc.Node("panel-maskNode");o.addComponent(cc.BlockInputEvents),o.setContentSize(cc.view.getVisibleSize()),t.topNode.addChild(o);var a=cc.instantiate(n);o.addChild(a);var c=a.getComponent("SetPanel");c&&c.showPanel(e<=0),o.on(cc.Node.EventType.TOUCH_START,function(){o.setContentSize(0,0),c.hidePanel(e<=0,function(){o.destroy(),t.setBtnNode.active=!0})})}})},onBtnClickTestCalcTips:function(){void 0===window.tipsIndex&&(window.tipsIndex=0);for(var e=0;e<1;e++)window.tipsIndex++,this.calcTips.addTips("test".concat(window.tipsIndex))},_loadUi:function(e){var t=this,i=o.getUiCfg(e);if(i){this.uiNode.opacity=255,this.uiNode.setPosition(0,0),this.uiNode.active=!0;var n=cc.view.getDesignResolutionSize();this.uiNode.setContentSize(n);var a=r.getUrlByUUID(i.cfg);i.cfg&&a?AvgPlayer.convertElementToNode({url:a},function(e,i){t.uiNode.addChild(i)}):cc.error("UI\u914d\u7f6e\u6587\u4ef6\u5f02\u5e38: ".concat(JSON.stringify(i)))}},_storyEnd:function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.StoryEnd),this._plotData=null,this._pieceData=null,this._piece={data:null,node:null},c.resetPlot(null),s.stopAll(),this.storyNode.destroyAllChildren(),this.touchNode.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ActiveSkipBtn,!1),this.avgMenuNode.active=!1,this.setBtnNode.active=!1,o.getIsPublish()?(console.log("\u53d1\u5e03\u6a21\u5f0f: \u6545\u4e8b\u7ed3\u675f,\u8df3\u8f6c\u5230\u6545\u4e8b\u5f00\u5934"),this._launchCover()):this._onPieceTips("\u6545\u4e8b\u7ed3\u675f")},_onTouchEnd:function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.UserTouch,null)},_initTouch:function(){var e=cc.view.getVisibleSize();this.touchNode.width=e.width,this.touchNode.height=e.height,this.touchNode.active=!0,this.touchNode.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.touchNode.destroyAllChildren()},_loadSetNode:function(){var e=this;this.setBtnNode?this.setBtnNode.active=!0:cc.loader.loadRes("set/SetButton",function(t,i){if(!t){var n=cc.instantiate(i);e.topNode.addChild(n),e.setBtnNode=n}})},_onWinResize:function(){var e=cc.view.getVisibleSize();this.storyNode.setContentSize(e),console.log("[win-resize] width:".concat(e.width,", height:").concat(e.height)),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.WindowResize)},onLoad:function(){AvgBackground.initBg(),this._initMsg(),h.resetFirstPlay(),cc.PlatformVar.X5VideoIsFullScreenPlay=!1,window.VideoGroupQuickTestTool.initTools(),cc.debug.setDisplayStats(!1),window.onresize=this._onWinResize.bind(this),this.aniSkipNode.active=!1,this._initLoading(),this.storyNode.setContentSize(cc.view.getVisibleSize()),g.initPieceResLoader(),cc.StoryConfig.init(function(){e("GameFullScreen").initFullScreen(),s.init(),l.init(),n.setGameDesignResolutionSize(),e("PieceShader").initPieceShader(this.transition),GameDB.init(),GameDB.initProjectData(),GameDB.initAccountData(),o.serializePlot(),o.serializePiece(),AvgPlayer.addMaskBeganGroupComp(this.maskBeganGroupNode),e("VideoGroupInit").ready(this.maskBeganGroupNode),this._addAvgMenu(),this._loadSetNode(),this._launchCover()}.bind(this))},_updateAvgBagMenuVisible:function(e){this.storyBagUI&&this.storyBagUI.setPieceData(e)},_addAvgMenu:function(){AvgPlayer.AvgUI.addAvgMenus(this.avgMenuNode),this.storyBagUI.bagIconNode=AvgPlayer.AvgUI.addAvgBag(this.avgMenuNode),this.storyBagUI.hideBagMenu()},_launchCover:function(){u.file.init.data.isTest?(GameDB.initLastUseArchive(),this._launchStory()):(this.storyNode.destroyAllChildren(),this.touchNode.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ActiveSkipBtn,!1),this.setBtnNode&&(this.setBtnNode.active=!0),this.avgMenuNode.active=!1,this._loadUi(AvgData.Type.UiDefault.Cover))},_launchStory:function(){var e=this;AvgPlayer.initSceneBg(),this._piece={node:this.uiNode,data:null},cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ActiveSkipBtn,!1),AvgPlayer.PreloadPrefab.preloadGamePrefabs(function(){e.avgMenuNode.active=!0,e._initTouch(),d.initPieceAniMgr(),e.storyNode.destroyAllChildren(),u.file.init.data.isTest?e.startWithDebug():e.startWithNormal()})},_updateCurPieceVisibleSkipBtn:function(e,t){for(var i=e.children,n=[],o=0;o<i.length;o++){var a=i[o].avgSyncData;n.push(a)}var s=this._getPieceIsContentInteractiveElement(t,n),r=c.getPlotCanSkip();cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ActiveSkipBtn,!s&&r)},_runValueJudgeAndPlotJump:function(t,i,n){var o=!1;n&&(o=e("ValueJudgeCalcTool").calcWithData(t.id,n,!1));return!!o||!!i&&(this._playNewPlot(i.jumpPlotID),!0)},_getPieceIsContentInteractiveElement:function(e,t){for(var i=!1,n=[],a=0;a<t.length;a++){var c=t[a],s=c.type;if(s===AvgData.AvgType.PlotMenu.type){i=!0;for(var r=c.items,l=0;l<r.length;l++)n.push(r[l].id)}else s===AvgData.AvgType.PlotJump.type||s===AvgData.AvgType.ValueJudge.type||(s===AvgData.AvgType.QTE.type?(i=!0,n.push(c.result.succeed.id),n.push(c.result.failed.id)):n.push(c.id))}for(var d=0;d<n.length;d++){if(o.getPieceElementEventDataByID(e.id,n[d]).length>0){i=!0;break}}return i},_getPieceElement:function(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(n.type===t)return n}return null},_findPlotStopPiece:function(e,t,i,n){var a=this,c=e.cfg,s=e.id;this._loadPieceCfg(s,c,function(c){var s=function(){var c=o.getNextPieceItemByPlotPiece(a._plotData.piece,e.id);c?a._findPlotStopPiece(c,t,i,n):n&&n(null)};if(a._getPieceIsContentInteractiveElement(e,c))t&&t(e);else{var r=a._getPieceElement(c,AvgData.AvgType.PlotJump.type),l=a._getPieceElement(c,AvgData.AvgType.ValueJudge.type);if(r||l)i(e,r,l)||s();else s()}})},_runCurPiece:function(){for(var e=this._piece.node.children,t=null,i=null,n=0;n<e.length;n++){var o=e[n].avgSyncData,a=o.type;a===AvgData.AvgType.PlotJump.type?t=o:a===AvgData.AvgType.ValueJudge.type&&(i=o)}return this._runValueJudgeAndPlotJump(this._piece.data,t,i)},onBtnClickSkipPlot:function(){var e=this;this._plotData&&this._plotData.end||this._findPlotStopPiece(this._piece.data,function(t){e.createPiece(t),c.recordPlotSkip(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ActiveSkipBtn,!1)},function(t,i,n){return e._runValueJudgeAndPlotJump(t,i,n)},function(){var t=o.getNextPlotData(e._plotData.id);t?e._playNewPlot(t.id):e._storyEnd()})},_onPieceTips:function(e){this.storyNode.destroyAllChildren();var t=new cc.Node;t.color=cc.Color.BLACK,this.storyNode.addChild(t);var i=t.addComponent(cc.Label);i.overflow=cc.Label.Overflow.NONE,i.lineHeight=50,i.fontSize=40,i.string=e,this.touchNode.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this);var n=new cc.Node("story-end-node");n.y=-100;var o=n.addComponent(cc.Layout);o.spacingX=-330,o.type=cc.Layout.Type.HORIZONTAL,o.startAxis=cc.Layout.AxisDirection.HORIZONTAL,o.resizeMode=cc.Layout.ResizeMode.CONTAINER,this.storyNode.addChild(n);var a=this._createButton("res/default/btn-replay.png",function(){window.location.reload()}.bind(this));a.scale=.3,n.addChild(a);var c=this._createButton("res/default/btn-end.png",function(){if(window.require){var e=window.require("electron");e&&e.ipcRenderer.sendToHost("close")}}.bind(this));c.scale=.3,n.addChild(c),cc.sys.isMobile&&(c.active=!1)},_createButton:function(e,t){var i=new cc.Node("button"),n=i.addComponent(cc.Sprite);return n.sizeMode=cc.Sprite.SizeMode.TRIMMED,cc.loader.load(e,function(e,o){e||(n.spriteFrame=new cc.SpriteFrame(o),i.on(cc.Node.EventType.TOUCH_END,function(){t&&t()}.bind(this)))}.bind(this)),i},startWithDebug:function(){var e=o.getTestModeStartPiecePrefab();if(e){var t=o.getPlotDataByPieceID(e.piece);if(t){this._plotData=t,c.resetPlot(t);var i=o.getPieceDataByID(e.piece);i&&(this._pieceData=i,this.createPiece(e.item))}}else this._onPieceTips("\u672a\u53d1\u73b0\u8981\u6d4b\u8bd5\u7684\u6545\u4e8b")},startWithNormal:function(){var e=o.getBeganPlot();this._playNewPlot(e.id)},_playNewPlot:function(e){var t=o.getPlotDataByID(e);if(t){this._plotData=t,c.resetPlot(t);var i=o.getPieceDataByID(t.piece);i?(this._pieceData=i,this.createPiece(i[0])):cc.log("\u65e0\u6548\u7684piece: ".concat(t.piece))}else cc.log("\u65e0\u6548\u7684plotID: ".concat(e))},_fadeOutPreNode:function(){for(var e=this.storyNode.children,t=function(t){var i=e[t];if(!i.isValid)return"continue";i.getComponent("StoryPiece")&&i.removeComponent("StoryPiece"),i.stopAllActions();var n=cc.fadeOut(.1),o=cc.callFunc(function(){i.destroy()});i.runAction(cc.sequence([n,o]))},i=0;i<e.length;i++)t(i)},_preloadFiles:function(e,t){var i=this;if(e.length>0){var n=e.shift();cc.loader.load(n,function(n,o){n&&cc.error(o),i._preloadFiles(e,t)})}else t&&t()},_instancePiece:function(e,t,i){this._loadPieceCfg(e,t,function(t){AvgPlayer.convertElementToNodeByData(t,e,i)})},_loadPieceCfg:function(t,i,n){var a=e("Assets"),c=e("StoryAnimations"),s=e("StoryEvents"),r=e("StoryTimelines"),l=AvgData.ProjectCfg.PieceFiles;if(o.getIsPublish()){var d=cc.StoryConfig.file.scenes.data[i];if(d){c.add(t,d[l.Animations]),s.add(t,d[l.Events]),r.add(t,d[l.TimeLine]);var u=d[l.Elements];setTimeout(function(){n&&n(u)})}else cc.error("\u672a\u53d1\u73b0\u5408\u5e76\u540e\u7684\u753b\u5e03\u6570\u636e: ".concat(t," * ").concat(i))}else{var h=a.getUrlByUUID(i);if(!h)return void cc.error("\u672a\u53d1\u73b0\u753b\u5e03\u7684\u76ee\u5f55:".concat(i));var g="".concat(h,"/").concat(l.Events),p="".concat(h,"/").concat(l.Elements),f="".concat(h,"/").concat(l.Animations),v="".concat(h,"/").concat(l.TimeLine);this._preloadFiles([g,f,v,p],function(){c.add(t,cc.loader.getRes(f)),s.add(t,cc.loader.getRes(g)),r.add(t,cc.loader.getRes(v)),n&&n(cc.loader.getRes(p))})}},_addPieceNode:function(e,t){var i=cc.view.getVisibleSize();e.x=e.y=0,e.width=i.width,e.height=i.height,this.storyNode.addChild(e);var n=e.getComponent("StoryPiece");n||(n=e.addComponent("StoryPiece")),n.pieceData=t},onVideoSeeked:function(e,t){if(!o.getIsPublish())return t&&t();for(var i=null,n=0;n<e.length;n++){var a=e[n];if(a.type===AvgData.AvgType.VideoPlot.type){i=a;break}}if(i){window.VideoLogicGroup.adjustVideoAttributeWithX5(),window.VideoLogicGroup.setVideoSrcOnPublishEnv();var c=i.src;o.getVideoInfo(c,function(e){var i=window.VideoLogicGroup.videoDom,n=e.start;i.currentTime===n||0===i.currentTime?t&&t():(void 0===i.onseeked?cc.log("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301seeked"):null===i.onseeked&&cc.log("\u6d4f\u89c8\u5668\u652f\u6301seeked"),i.onseeked=function(){cc.log("video seeked: ".concat(n)),i.onseeked=null,t&&t()},console.log("on video seed:".concat(i.currentTime,"/ ").concat(n)),i.currentTime=n)})}else t&&t()},createPiece:function(t){var i=this;if(this.loadingNode.active=!0,cc.log("create piece: ".concat(JSON.stringify(t))),this._updateAvgBagMenuVisible(t),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!1),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ActiveSkipBtn,!1),t&&t.type===AvgData.Type.Pieces.Content){e("PieceNextPreload").preload(t);var n=t.cfg,o=t.id;n?(a.resetPieceAnimation(),s.onLoadPieceEvent(),AvgPlayer.MaskBeganGroup.cleanAllBeganMask(),e("QTEPieceMgr").onPieceLoaded(),this._loadPieceCfg(o,n,function(n){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!0),i._piece.node&&(i._piece.node.removeComponent("StoryPiece"),i._piece.node.stopAllActions()),g.onPieceResAllLoaded(n,function(){i.onVideoSeeked(n,function(){AvgPlayer.convertElementToNodeByData(n,o,function(n,o){n?cc.error(n):(i._addPieceNode(o,t),i._updateCurPieceVisibleSkipBtn(o,t),i.loadingNode.active=!1,l.onTransition(i._piece,{node:o,data:t},function(){var n=e("StoryPieceUtil");n.pieceID=t.id,n.pieceNode=o,i._piece.node=o,i._piece.data=t,cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!0),a.sortAnimation(t.id),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPieceAnimationPlayBefore),a.playPieceAnimation()}))})})})})):cc.log("piece.cfg \u65e0\u6548!")}else cc.log("\u672a\u77e5\u7684piece:".concat(JSON.stringify(t)))}}),cc._RF.pop()},{Assets:"Assets",AudioMgr:"AudioMgr",CalcTips:"CalcTips",GameData:"GameData",GameFullScreen:"GameFullScreen",GameUtil:"GameUtil",LocalStorage:"LocalStorage",Observer:"Observer",PieceNextPreload:"PieceNextPreload",PieceShader:"PieceShader",PieceTransition:"PieceTransition",QTEPieceMgr:"QTEPieceMgr",ShieldStoryAnyTouch:"ShieldStoryAnyTouch",StoryAnimations:"StoryAnimations",StoryBagUI:"StoryBagUI",StoryConfig:"StoryConfig",StoryData:"StoryData",StoryEvents:"StoryEvents",StoryPieceAniMgr:"StoryPieceAniMgr",StoryPieceResLoader:"StoryPieceResLoader",StoryPieceUtil:"StoryPieceUtil",StoryPlotSkipMgr:"StoryPlotSkipMgr",StoryTimelines:"StoryTimelines",ValueJudgeCalcTool:"ValueJudgeCalcTool",ValueMgr:"ValueMgr",VideoGroupInit:"VideoGroupInit",VideoUtil:"VideoUtil",transitions:"transitions"}],StoryMenuItem:[function(e,t,i){"use strict";cc._RF.push(t,"a44147YfYdDGLqyw82EC3HP","StoryMenuItem");e("StoryData"),e("ValueMgr"),e("GameUtil");cc.Class({extends:e("Observer"),properties:{audio:{default:null,displayName:"\u6309\u94ae\u58f0\u97f3",type:cc.AudioClip},_plotMenuItemData:null,_pieceID:null,_isClicked:!1,storyMenuScript:e("StoryMenu")},_getMsgList:function(){return[cc.AvgMsg.Msg.OnPlotMenuItemSelected,cc.AvgMsg.Msg.OnPlotMenuOffTouchEvent]},_onMsg:function(e,t){e===cc.AvgMsg.Msg.OnPlotMenuItemSelected?this._isClicked=!0:e===cc.AvgMsg.Msg.OnPlotMenuOffTouchEvent&&this.node.off(cc.Node.EventType.TOUCH_END,this._onItemClick,this)},onLoad:function(){AVG_EDITOR||(this._initMsg(),this.node.on(cc.Node.EventType.TOUCH_END,this._onItemClick,this))},_onItemClick:function(t){if(t.stopPropagation(),!this.storyMenuScript||this.storyMenuScript.isResponseClick){if(!this._isChecked){if(cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPlotMenuItemSelected),this.audio){var i=cc.audioEngine.playEffect(this.audio,!1);AudioMgr.setAudioPlayBackRate(i)}if(null!==this._pieceID&&null!==this._plotMenuItemData)e("EventExecute").execute(this._pieceID,this._plotMenuItemData.id,!0,{noEventTips:"\u5267\u60c5\u9009\u9879\u672a\u53d1\u73b0\u4efb\u4f55\u4e8b\u4ef6!",morePlotEventTips:"\u8be5\u9009\u9879[".concat(this._plotMenuItemData.text,"]\u51fa\u73b0\u591a\u4e2a\u5267\u60c5\u4e8b\u4ef6!"),noPlotEventCallBack:function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPlotMenuRemoveWithNoPlotEvents)}});else cc.warn("\u8be5\u9009\u9879\u5e76\u672a\u8bbe\u7f6e\u8df3\u8f6c\u5267\u60c5")}}else cc.log("\u52a8\u753b\u9636\u6bb5,\u4e0d\u54cd\u5e94\u5267\u60c5\u9009\u9879\u6309\u94ae\u70b9\u51fb")},updatePlotMenuItemData:function(e,t){this._plotMenuItemData=e,this._pieceID=t}}),cc._RF.pop()},{EventExecute:"EventExecute",GameUtil:"GameUtil",Observer:"Observer",StoryData:"StoryData",StoryMenu:"StoryMenu",ValueMgr:"ValueMgr"}],StoryMenu:[function(e,t,i){"use strict";cc._RF.push(t,"33446Vjl45KL4PWyaIJCAxN","StoryMenu");e("GameUtil"),e("ValueMgr"),e("StoryData");cc.Class({extends:e("Observer"),properties:{data:null,timeLabel:cc.Label,isResponseClick:!0},onLoad:function(){this._initMsg()},_getMsgList:function(){return[cc.AvgMsg.Msg.OnPlotMenuRemove]},_onMsg:function(e,t){cc.AvgMsg.Msg.OnPlotMenuRemove},onAnimationPlay:function(){this.isResponseClick=!1},onAnimationOver:function(){this.isResponseClick=!0},initLimit:function(e,t){this.limitNode=t,this.timeLabel=e},setPlotMenuData:function(e,t){this._pieceID=t,this.data=e},onLimitStart:function(){var e=this.data.limit;e.enabled&&(this.timeCur=e.time,this.schedule(this._scheduleTime,1),this._scheduleTime())},_scheduleTime:function(){this.timeLabel.string="".concat(this.timeCur,"s"),this.timeCur--,this.timeCur<0&&(this.unschedule(this._scheduleTime),this.limitNode.active=!1,this._runLimitEvent(),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPlotMenuLimitTimeOver))},_runLimitEvent:function(){return e("EventExecute").execute(this._pieceID,this.data.limit.id,!0,{noEventTips:"\u672a\u53d1\u73b0\u5267\u60c5\u9009\u62e9\u5668\u9650\u65f6[".concat(this.data.id,"]\u7684\u4e8b\u4ef6"),morePlotEventTips:"\u5267\u60c5\u9009\u62e9\u5668\u9650\u65f6\u7684\u89e6\u53d1\u60c5\u51b5[".concat(this.data.limit.id,"]\u5305\u542b\u591a\u4e2a\u5267\u60c5\u4e8b\u4ef6")})}}),cc._RF.pop()},{EventExecute:"EventExecute",GameUtil:"GameUtil",Observer:"Observer",StoryData:"StoryData",ValueMgr:"ValueMgr"}],StoryPieceAniMgr:[function(e,t,i){"use strict";cc._RF.push(t,"40b2dqNC3BCRaurs79HC81Y","StoryPieceAniMgr");var n=e("StoryData"),o=(e("AvgPlayer"),e("QTEPieceMgr")),a=AvgData.Type.TimelineType;t.exports={_init:!1,allPieceAnimation:[],transformAnimation:[],actionNode:[],isActionBreak:!1,initPieceAniMgr:function(){var e=this;this._init||(this._init=!0,cc.ObserverMgr.addEventListener(cc.AvgMsg.Msg.OnPieceAnimationSpawnNext,function(t,i){e.transformAnimation.splice(0,1),e.playPieceAnimation()},this),cc.ObserverMgr.addEventListener(cc.AvgMsg.Msg.OnPieceAnimationSpawnReplay,function(){e.playPieceAnimation()},this))},resetPieceAnimation:function(){this.allPieceAnimation=[],this.transformAnimation=[],this.actionNode=[]},addPieceAnimation:function(e){e.onAniAdd&&e.onAniAdd(),this.allPieceAnimation.push(e)},_findAniComponent:function(e){for(var t=0;t<this.allPieceAnimation.length;t++){var i=this.allPieceAnimation[t];if(i.actionData&&i.actionData.id===e)return i}return null},sortAnimation:function(e){var t=n.getPieceTimeLineData(e);if(t){for(var i=[],c=0,s=0;s<t.length;s++){var r=t[s];if(Array.isArray(r)){for(var l=[],d=0;d<r.length;d++){var u=r[d],h=this._findAniComponent(u.id);if(h){h.setTimeLineData(u);for(var g=h.node.uuid,p=!1,f=0;f<l.length;f++){var v=l[f];v.uuid===g&&(v.node=h.node,v.acts.push(h),p=!0)}p||(c++,o.onAnimationIndex(h.node,c),l.push({uuid:g,node:h.node,acts:[h]}))}else cc.log("\u672a\u627e\u5230\u52a8\u753b\u6570\u636e: ".concat(u.id))}l.length>0&&(l=this._adjustStopGlobalSequence(l),i.push(l))}else if(r.type===a.Element.type){var y=this._findAniComponent(r.id);y?i.push(y):console.error("\u9519\u8bef: \u672a\u627e\u5230\u52a8\u753b".concat(r.id))}}o.onAniSortOver(),this.transformAnimation=i}else cc.log("\u672a\u53d1\u73b0\u52a8\u753b\u6570\u636e!")},_adjustStopGlobalSequence:function(e){for(var t=[],i=null,n=AvgData.AvgType,o=0;o<e.length;o++){var a=e[o];a.node.avgSyncData.type===n.AudioBgStopGlobal.type?i=a:t.push(a)}return i&&t.push(i),t},_playSpawnAnimation:function(e){var t=this,i=e.node,n=e.acts;if(n.length<=0)console.error("\u6570\u636e\u6709\u8bef!");else{for(var o=[],a=[],c=0;c<n.length;c++){var s=n[c],r=s.genAction();r.isBreak&&(this.isActionBreak=!0);var l=r.action,d=s.getCurActionName();a.push(d),o.push(l)}cc.log("\u5e76\u884c\u6267\u884c\u7684\u52a8\u753b: ".concat(a.toString()," "));var u=null;if(o.length>1?u=cc.spawn(o):1===o.length&&(u=o[0]),u){var h=cc.sequence(u,cc.callFunc(function(){var n=i.getComponent("QTE");n&&n.startUpQTE(),t._emitAniOverCB(i),t._nodeAnimationCallBack(e.uuid)}));i.active||console.error("\u9690\u85cf\u7684\u8282\u70b9\u65e0\u6cd5\u6267\u884c\u52a8\u753b:".concat(a.toString())),i.stopAllActions(),i.runAction(h),this._emitAniPlayCB(i)}else console.error("\u6ca1\u6709\u53ef\u4ee5\u6267\u884c\u7684\u52a8\u753b")}},_emitAniOverCB:function(e){for(var t=e._components,i=0;i<t.length;i++){var n=t[i];n.onAnimationOver&&n.onAnimationOver()}},_emitAniPlayCB:function(e){for(var t=e._components,i=0;i<t.length;i++){var n=t[i];n.onAnimationPlay&&n.onAnimationPlay()}},_spliceActionNode:function(e){for(var t=0;t<this.actionNode.length;){this.actionNode[t].uuid===e?this.actionNode.splice(t,1):t++}},_nodeAnimationCallBack:function(e){this._spliceActionNode(e),0===this.actionNode.length&&(this.isActionBreak?cc.warn("\u52a8\u753b\u5e8f\u5217\u4e2d\u65ad,\u7b49\u5f85\u4ea4\u4e92"):(cc.log("\u64ad\u653e\u4e0b\u4e2a\u52a8\u753b\u5408\u96c6"),this.playPieceAnimation()))},playPieceAnimation:function(){if(this.actionNode=[],this.isActionBreak=!1,this.transformAnimation.length>0){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!1);var e=this.transformAnimation[0];if(Array.isArray(e))if(e.length>0){for(var t=0;t<e.length;t++){var i=e[t];this.actionNode.push(i),this._playSpawnAnimation(i)}this.isActionBreak||this.transformAnimation.splice(0,1)}else cc.log("\u7a7a\u52a8\u753b\u5408\u96c6, \u76f4\u63a5\u8df3\u8fc7"),this.playPieceAnimation();else cc.warn("\u4e0d\u518d\u517c\u5bb9Object\u7c7b\u578b\u7684\u52a8\u753b\u6570\u636e")}else this._playPieceAnimationOver()},_playPieceAnimationOver:function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PieceAnimationOver),cc.log("\u52a8\u753b\u64ad\u653e\u5b8c\u6bd5")}},cc._RF.pop()},{AvgPlayer:"AvgPlayer",QTEPieceMgr:"QTEPieceMgr",StoryData:"StoryData"}],StoryPieceResLoader:[function(e,t,i){"use strict";cc._RF.push(t,"0823dVR+KNP2YQOCC4sS5Qn","StoryPieceResLoader");var n=e("Assets");t.exports={_init:!1,_cb:null,_unLoadRes:null,initPieceResLoader:function(){!1===this._init&&(this._init=!0)},_onResLoaded:function(e){if(null!==this._unLoadRes){for(var t=e.url,i=!1,n=0;n<this._unLoadRes.length;){if(this._unLoadRes[n].url===t){this._unLoadRes[n].loaded=!0,i=!0;break}n++}if(i){for(var o=0;o<this._unLoadRes.length;o++){if(!this._unLoadRes[o].loaded)return}this._unLoadRes=null,this._cb&&this._cb()}else console.log("\u8d44\u6e90\u4e0d\u5728\u91cc\u9762: ".concat(t))}},_filterDefaultFont:function(e){return e.filter(function(e){return e!==AvgData.DefaultValue.Font0})},onPieceResAllLoaded:function(e,t){for(var i=AvgUtil.getPieceAllUseRes(e),o=[].concat(i.image,this._filterDefaultFont(i.font),i.audio),a=[],c=0;c<o.length;c++){var s=o[c],r=n.getUrlByUUID(s);if(r)cc.loader.getRes(r)||a.push({url:r,loaded:!1,uuid:s});else cc.error("\u65e0\u6548\u7684\u8d44\u6e90:".concat(s))}a.length>0?(this._unLoadRes=a,this._loadRes(a),this._cb=t):t&&t()},_loadRes:function(e){for(var t=this,i=function(i){var n=e[i];cc.loader.load(n.url,function(e,i){e||t._onResLoaded(n)})},n=0;n<e.length;n++)i(n)}},cc._RF.pop()},{Assets:"Assets"}],StoryPieceUtil:[function(e,t,i){"use strict";cc._RF.push(t,"f69d0uhSptGm4TjcOzGQqrk","StoryPieceUtil"),t.exports={pieceID:null,pieceNode:null,getAllElementEvent:function(){for(var e=[],t=this.pieceNode.children,i=0;i<t.length;i++){var n=t[i],o=n.avgSyncData,a=o.type;if(a===AvgData.AvgType.PlotMenu.type)for(var c=o.items,s=0;s<c.length;s++)e.push({eventID:c[s].id,node:n});else a===AvgData.AvgType.PlotJump.type||a===AvgData.AvgType.ValueJudge.type||(a===AvgData.AvgType.QTE.type?(e.push({eventID:o.result.succeed.id,node:n}),e.push({eventID:o.result.failed.id,node:n})):e.push({eventID:o.id,node:n}))}return e},getIsContentUnTargetGoodsEventElement:function(){for(var t=e("StoryData"),i=e("GameUtil"),n=this.getAllElementEvent(),o=0;o<n.length;o++)for(var a=n[o],c=a.eventID,s=a.node,r=t.getPieceElementEventDataByID(this.pieceID,c),l=i.filterGoodsEvents(r),d=0;d<l.length;d++){l[d];var u=s.getComponent("ElementEvent");if(u&&!u.isEmit)return!0}return!1}},cc._RF.pop()},{GameUtil:"GameUtil",StoryData:"StoryData"}],StoryPiece:[function(e,t,i){"use strict";cc._RF.push(t,"bdb458kLPpJxJi4DX7NH/Om","StoryPiece");e("LocalStorage");var n=e("PieceUtil");cc.Class({extends:e("Observer"),properties:{_menuNode:null,_uiTalkNode:null,_uiPlotJump:null,_uiValueJudge:null,_storyTalk:null,pieceData:{default:null,visible:!1}},_getMsgList:function(){return[cc.AvgMsg.Msg.PieceShowOptions,cc.AvgMsg.Msg.OnPieceTalkOver,cc.AvgMsg.Msg.UserTouch,cc.AvgMsg.Msg.PieceAnimationOver,cc.AvgMsg.Msg.OnPlotMenuNoJump,cc.AvgMsg.Msg.OnPlotMenuRemoveWithNoPlotEvents,cc.AvgMsg.Msg.OnPlotMenuRemove,cc.AvgMsg.Msg.OnPieceTalkOverAutoRead]},_onMenuLimitStart:function(){var e=this._menuNode;if(e){e.active=!0;var t=e.getComponent("StoryMenu");t&&t.onLimitStart()}},_onMsg:function(e,t){if(e===cc.AvgMsg.Msg.PieceShowOptions)cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!1),this._onMenuLimitStart();else if(e===cc.AvgMsg.Msg.OnPieceTalkOver)this._goNextPiece();else if(e===cc.AvgMsg.Msg.UserTouch){if(this._tipsEventNode())return;if(this._uiTalkNode){var i=this._uiTalkNode.getComponent("StoryTalk");i&&i.onUserTouch()}else this._menuNode||this._goNextPiece()}else if(e===cc.AvgMsg.Msg.PieceAnimationOver)if(this._menuNode)cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!1),this._onMenuLimitStart();else if(this._uiTalkNode)cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!0);else{cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!0);var o=this._getPieceAutoWaitTime();cc.GameUtil.autoRead(this,o,function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.UserTouch,null)})}else if(e===cc.AvgMsg.Msg.OnPlotMenuNoJump)this._goNextPieceWithOutValueJudge();else if(e===cc.AvgMsg.Msg.OnPlotMenuRemove)this._menuNode&&(this._menuNode.destroy(),this._menuNode=null,cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PieceHasOptions,!1));else if(e===cc.AvgMsg.Msg.OnPlotMenuRemoveWithNoPlotEvents){this._menuNode&&(cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!0),this._menuNode.destroy(),this._menuNode=null,cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PieceHasOptions,!1)),n.getPieceTipsNode(this.node).length>0||cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.UserTouch)}else if(e===cc.AvgMsg.Msg.OnPieceTalkOverAutoRead){var a=this._getPieceAutoWaitTime();cc.GameUtil.autoRead(this,a,function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPieceTalkOver,null)})}},_getPieceAutoWaitTime:function(){var e=GameDB.MultipleSpeed;void 0===e&&(e=1);var t=0;return void 0===this.pieceData.wait&&(t=0),0===e?t=0:t/=e,t},_tipsEventNode:function(){var e=n.getPieceTipsNode(this.node);return e.length>0&&(n.blinkNodes(e),!0)},_goNextPiece:function(){var e=!1;if(this._uiValueJudge){var t=this._uiValueJudge.getComponent("ValueJudgeEvent");t?e=t.runEvents(this.pieceData.id):cc.warn("\u672a\u77e5\u9519\u8bef,\u672a\u53d1\u73b0ValueJudgeEvent\u811a\u672c!")}e||this._goNextPieceWithOutValueJudge()},_goNextPieceWithOutValueJudge:function(){if(this._uiPlotJump){var e=null;this._uiPlotJump.avgSyncData&&(e=this._uiPlotJump.avgSyncData.jumpPlotID),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnJumpNewPlot,e)}else cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnGoNextPiece,this.pieceData)},onLoad:function(){if(!AVG_EDITOR){this._initMsg();for(var e=AvgData.AvgType,t=this.node.children,i=0;i<t.length;i++){var n=t[i],o=n.type;o===e.PlotMenu.type&&null===this._menuNode&&(this._menuNode=n),o===e.Talk.type&&null===this._uiTalkNode&&(this._uiTalkNode=n),o===e.PlotJump.type&&null===this._uiPlotJump&&(this._uiPlotJump=n),o===e.ValueJudge.type&&null===this._uiValueJudge&&(this._uiValueJudge=n)}this._uiPlotJump&&this._menuNode&&cc.warn("[\u914d\u7f6e\u5f02\u5e38]: \u5267\u60c5\u9009\u62e9\u548c\u5267\u60c5\u9009\u9879\u5171\u5b58!"),this._uiTalkNode?this._menuNode:this._menuNode&&cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnEnableGlobalTouch,!1)}},start:function(){this._menuNode&&cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PieceHasOptions,!0)},onDestroy:function(){cc.ObserverMgr.removeEventListenerWithObject(this)}}),cc._RF.pop()},{LocalStorage:"LocalStorage",Observer:"Observer",PieceUtil:"PieceUtil"}],StoryPlotSkipMgr:[function(e,t,i){"use strict";cc._RF.push(t,"dbb35f1zjBABZwMvXQ5cBbM","StoryPlotSkipMgr");e("StoryData"),e("LocalStorage");t.exports={plotData:null,resetPlot:function(e){this.recordPlotSkip(),this.plotData=e},recordPlotSkip:function(){if(this.plotData&&this.plotData.skip===AvgData.Type.PieceAniSkip.Once.type){var e=this.plotData.id;GameDB.setPlotSkip(e)}},getPlotCanSkip:function(){var e=this.plotData;return!!e&&(!e.end&&!!this._checkingPlotCanSkip(e))},_checkingPlotCanSkip:function(e){var t=AvgData.Type.PieceAniSkip,i=e.skip;return!!i&&(i===t.Always.type||(i===t.Once.type?GameDB.getPlotSkip(e.id)?(cc.log("\u66fe\u7ecf\u8df3\u8fc7\u8fc7\u8be5\u753b\u5e03\u52a8\u753b,\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7"),!0):(cc.log("\u672a\u8df3\u8fc7\u8be5\u753b\u5e03\u52a8\u753b,\u4e0d\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7"),!1):i!==t.Forbid.type&&void 0))}},cc._RF.pop()},{LocalStorage:"LocalStorage",StoryData:"StoryData"}],StoryTalk:[function(e,t,i){"use strict";cc._RF.push(t,"65757LGwZdBcJEd9tHbaPeG","StoryTalk");var n=cc.Enum({Slow1:7,Slow2:6,Slow3:5,Normal:4,Fast1:3,Fast2:2,Fast3:1}),o=cc.Enum({None:0,Running:1,Waiting:2,Over:3});cc.Class({extends:e("Observer"),properties:{isTalkPlayOnce:!1,state:o.None,_bOptions:!1,word:{default:null,displayName:"\u5bf9\u8bdd\u5185\u5bb9",type:cc.Label,visible:!1},talkSpeed:{default:n.Normal,displayName:"\u8bed\u901f",type:n,notify:function(){this.wordIntervalTime=.05*this.talkSpeed,this.onWordEffect()}},wordIntervalTime:{tooltip:"\u6bcf\u4e2a\u5b57\u7b26\u51fa\u73b0\u7684\u95f4\u9694\u65f6\u95f4",default:.05,displayName:"\u95f4\u9694\u65f6\u95f4",type:cc.Float,visible:!1},preview:{default:"0",notify:!1}},onLoad:function(){AVG_EDITOR||this._initMsg()},_getMsgList:function(){return[cc.AvgMsg.Msg.PieceHasOptions,cc.AvgMsg.Msg.OnPieceAnimationPlayBefore,cc.AvgMsg.Msg.PauseStory]},_onMsg:function(e,t){if(e===cc.AvgMsg.Msg.PieceHasOptions)this._bOptions=!!t;else if(e===cc.AvgMsg.Msg.OnPieceAnimationPlayBefore){var i=this.node.getComponents("Animation");i&&i.length>0||this.onWordEffect()}else e===cc.AvgMsg.Msg.PauseStory&&(t?cc.director.getScheduler().pauseTarget(this):cc.director.getScheduler().resumeTarget(this))},onAnimationPlay:function(){this.isTalkPlayOnce||this.onWordEffect()},onUserTouch:function(){this.state===o.Running?this.onTalkFast():this.state===o.Waiting||this.state===o.Over&&(this._bOptions?cc.log("\u7b49\u5f85\u7528\u6237\u9009\u62e9!"):cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPieceTalkOver,null))},start:function(){},onTalkFast:function(){this.wordIntervalTime=.03,this.unschedule(this._updateWord),this.schedule(this._updateWord,this.wordIntervalTime)},onWordEffect:function(){var e=this;if(this.word){this.isTalkPlayOnce=!0,this.state=o.Running;var t=this.wordIntervalTime;this.index=0,this.allWord=this.word.string,this.unschedule(this._updateWord),this.word.string="",this.scheduleOnce(function(){e.schedule(e._updateWord,t),e._updateWord()},.3)}},_updateWord:function(){this.index>=this.allWord.length&&(this._updateWordByIndex(this.index),this.onTalkOver()),this._updateWordByIndex(this.index),this.index++},onTalkOver:function(){this.state=o.Waiting,this.unschedule(this._updateWord),this.word.string=this.allWord,this.scheduleOnce(function(){this.state=o.Over,this._bOptions?cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PieceShowOptions,null):cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.OnPieceTalkOverAutoRead)}.bind(this),.3)},_updateWordByIndex:function(e){if(this.allWord&&e<=this.allWord.length){var t=this.allWord.slice(0,e);this.word.string=t}}}),cc._RF.pop()},{Observer:"Observer"}],StoryTimelines:[function(e,t,i){"use strict";cc._RF.push(t,"67fb8QzWS1Ber7pwNKdzAcI","StoryTimelines"),t.exports={allTimelines:{},add:function(e,t){this.allTimelines[e]=t}},cc._RF.pop()},{}],TalkSpeedTool:[function(e,t,i){"use strict";cc._RF.push(t,"b2477dk3oRGKL1nB9ElJwpw","TalkSpeedTool"),cc._RF.pop()},{}],TestFit:[function(e,t,i){"use strict";cc._RF.push(t,"a4bf5Rer2VEqY5fCPKkjGre","TestFit");var n=e("DisplayImageSize");cc.Class({extends:cc.Component,properties:{screenNode:cc.Node,imageNode:cc.Node,tips:cc.Label,button:cc.Button},onLoad:function(){this.index=0,this.cases=[{screen:cc.size(200,100),image:cc.size(50,25)},{screen:cc.size(200,100),image:cc.size(100,50)},{screen:cc.size(200,100),image:cc.size(200,100)},{screen:cc.size(200,100),image:cc.size(400,200)},{screen:cc.size(200,100),image:cc.size(100,100)},{screen:cc.size(200,100),image:cc.size(200,200)},{screen:cc.size(200,100),image:cc.size(400,400)},{screen:cc.size(200,100),image:cc.size(800,200)},{screen:cc.size(200,100),image:cc.size(100,25)},{screen:cc.size(200,100),image:cc.size(200,50)},{screen:cc.size(100,200),image:cc.size(25,50)},{screen:cc.size(100,200),image:cc.size(50,100)},{screen:cc.size(100,200),image:cc.size(100,200)},{screen:cc.size(100,200),image:cc.size(200,400)},{screen:cc.size(100,200),image:cc.size(100,100)},{screen:cc.size(100,200),image:cc.size(200,200)},{screen:cc.size(100,200),image:cc.size(400,400)},{screen:cc.size(100,200),image:cc.size(200,800)},{screen:cc.size(100,200),image:cc.size(25,100)},{screen:cc.size(100,200),image:cc.size(50,200)}]},start:function(){},onClickTest:function(){var e=this;this.index>=this.cases.length&&(this.index=0);var t=this.cases[this.index];this.screenNode.setContentSize(t.screen),this.imageNode.setContentSize(t.image),this.tips.string="".concat(this.index+1,"/").concat(this.cases.length),setTimeout(function(){var i=n.calcSize(t.screen,t.image);e.imageNode.setContentSize(i.width,i.height)},1e3),this.index++}}),cc._RF.pop()},{DisplayImageSize:"DisplayImageSize"}],TestPrefab:[function(e,t,i){"use strict";cc._RF.push(t,"cb3c9eUgElM7Zv5GqXVYDVT","TestPrefab"),cc.Class({extends:cc.Component,properties:{prefab:cc.Prefab},onLoad:function(){},start:function(){var e=cc.instantiate(this.prefab);this.node.addChild(e)}}),cc._RF.pop()},{}],TipsItem:[function(e,t,i){"use strict";cc._RF.push(t,"c85af5FVKtBUYesJZc9D6fO","TipsItem"),cc.Class({extends:cc.Component,properties:{text:cc.Label,time:2},onLoad:function(){this.text.string=""},setTips:function(e){this.text.string=e},setFont:function(e){e&&AvgPlayer._addLabelComponent(this.text.node).updateLabelByFontInfo(e)},start:function(){}}),cc._RF.pop()},{}],UiEnv:[function(e,t,i){"use strict";cc._RF.push(t,"8fb3cwqqa1E7a+1r8Wh6v11","UiEnv");e("LocalStorage");cc.Class({extends:e("Observer"),properties:{slider:cc.Slider,progress:cc.ProgressBar,_data:null},_getMsgList:function(){return[cc.AvgMsg.Msg.UpdateVolume]},_onMsg:function(e,t){e===cc.AvgMsg.Msg.UpdateVolume&&this.setMusic()},onLoad:function(){this._initMsg(),this.slider=this.node.getComponent(cc.Slider),this.progress=this.node.getComponent(cc.ProgressBar)},start:function(){var e=this._data;e.type===AvgData.Type.UiButton.EnvSetTalkSpeed?this.setTalkSpeed():e.type===AvgData.Type.UiButton.EnvSetVolume&&this.setMusic()},setData:function(e){this._data=e},setMusic:function(){var e=GameDB.MusicVolume;this.slider.progress=this.progress.progress=e},setTalkSpeed:function(){var e=GameDB.TalkSpeed;this.slider.progress=this.progress.progress=e},onButtonClick:function(e,t){var i=this.slider.progress;this.slider&&this.progress&&(this.progress.progress=i),t.type===AvgData.Type.UiButton.EnvSetVolume?(GameDB.MusicVolume=i,cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.InSetLayerUpdateVolume)):t.type===AvgData.Type.UiButton.EnvSetTalkSpeed&&(GameDB.TalkSpeed=i)}}),cc._RF.pop()},{LocalStorage:"LocalStorage",Observer:"Observer"}],UiFileItem:[function(e,t,i){"use strict";cc._RF.push(t,"cc10feoo/FHv5/FQkFqMqL7","UiFileItem");e("GameData");cc.Class({extends:cc.Component,properties:{timeLabel:cc.Label,nameLabel:cc.Label,iconSprite:cc.Sprite},setUiFileItemData:function(e){this.node.on(cc.Node.EventType.TOUCH_END,function(){var t=cc.AvgGameData.recordEnterFileMgrSource;t===AvgData.Type.UiButton.CoverContinue?(GameDB.loadArchive(e),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.EnterGameFromFileItem,e)):t===AvgData.Type.UiButton.MenuRead?(GameDB.loadArchive(e),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.EnterGameFromFileItem,e)):t===AvgData.Type.UiButton.MenuSave&&(cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ClearAllUI,e),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.PauseStory,!1))})},onLoad:function(){},start:function(){}}),cc._RF.pop()},{GameData:"GameData"}],ValueDebugTool:[function(e,t,i){"use strict";cc._RF.push(t,"9dc4fh2PzNIOLbKEs8TLWUM","ValueDebugTool");var n={isEnabled:!1,init:function(){var e=this;if(window.require){this.isEnabled=!0;var t=window.require("electron");t&&(t.ipcRenderer.on("updateValues",function(t,i){e.updatePage()}),t.ipcRenderer.on("clearStorage",function(e,t){GameDB.clearStorage()}))}else this.isEnabled=!1},updatePage:function(){if(this.isEnabled){var t=window.require("electron"),i=e("ValueMgr");t.ipcRenderer.sendToHost("updateValues",i._allValue)}}};n.init(),t.exports=n,cc._RF.pop()},{ValueMgr:"ValueMgr"}],ValueJudgeCalcTool:[function(e,t,i){"use strict";cc._RF.push(t,"7010eeoWiRO9ZExQuCQhxdc","ValueJudgeCalcTool");var n=e("ValueMgr");e("StoryData"),e("GameUtil");t.exports={calcWithData:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=n.parseExec(t);if(null===o)return!1;var a=n.getValueDataByID(t.valueID).value,c=t.situation;return a>o?this._emitSituation(e,c.greater,i):a===o?this._emitSituation(e,c.equal,i):a<o?this._emitSituation(e,c.less,i):void 0},_emitSituation:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t.emitType;return AvgData.Type.ValueJudgeSituationEmitType.None.type===n?(cc.log("\u89e6\u53d1\u4e86\u8be5\u60c5\u51b5,\u4f46\u662f\u7528\u6237\u9009\u62e9\u4e0d\u89e6\u53d1\u8be5\u60c5\u51b5\u7684\u4e8b\u4ef6"),!1):AvgData.Type.ValueJudgeSituationEmitType.EmitEvent.type===n?this._emitEvent(e,t,i):void 0},_emitEvent:function(t,i){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e("EventExecute").execute(t,i.id,n,{noEventTips:"\u6570\u503c\u5224\u65ad\u5668\u672a\u53d1\u73b0\u5339\u914d\u60c5\u51b5\u7684\u4e8b\u4ef6:".concat(i.text),morePlotEventTips:"\u6570\u503c\u5224\u65ad\u5668\u7684\u89e6\u53d1\u60c5\u51b5[".concat(i.text,"]\u5305\u542b\u591a\u4e2a\u5267\u60c5\u4e8b\u4ef6")})}},cc._RF.pop()},{EventExecute:"EventExecute",GameUtil:"GameUtil",StoryData:"StoryData",ValueMgr:"ValueMgr"}],ValueJudgeEvent:[function(e,t,i){"use strict";cc._RF.push(t,"eb60csYzrdPno7MbXBT2oN/","ValueJudgeEvent"),cc.Class({extends:cc.Component,properties:{_itemData:null,_pieceID:null},setValueJudgeEventData:function(e){this._itemData=e},start:function(){},runEvents:function(t){return this._pieceID=t,!!this._itemData&&e("ValueJudgeCalcTool").calcWithData(t,this._itemData)}}),cc._RF.pop()},{ValueJudgeCalcTool:"ValueJudgeCalcTool"}],ValueMerge:[function(e,t,i){"use strict";cc._RF.push(t,"6eb77V7JR1JnrG/TGPDG9Mn","ValueMerge"),t.exports={MergeGlobalData:function(e){var t=this._getNumericalCfgData();return this._Merge(e,t.global)},MergeNormalData:function(e){var t=this._getNumericalCfgData();return this._Merge(e,t.common)},_Merge:function(e,t){if(!t)return e;var i={};if(t.forEach(function(e){i[e.id]=e.default}),!e)return i;for(var n in i){var o=i[n];void 0===e[n]&&(e[n]=o)}return e},_getNumericalCfgData:function(){return cc.StoryConfig.file.numerical.data}},cc._RF.pop()},{}],ValueMgr:[function(e,t,i){"use strict";cc._RF.push(t,"62dc6wIeIRLEpgsH9dJujxG","ValueMgr");e("LocalStorage");var n={_allValue:{},_isInit:!1,initValue:function(){if(!1===this._isInit){this._isInit=!0;var t=cc.StoryConfig.file.numerical.data;this._initValueItem(t.common),this._initValueItem(t.global),this._initValueItem(t.system),e("ValueDebugTool").updatePage()}},saveValue:function(){GameDB.updateAllValues(this._allValue),e("ValueDebugTool").updatePage()},_initValueItem:function(e){for(var t=0;t<e.length;t++){var i=e[t];if(this._allValue[i.id])console.error("\u91cd\u590d\u7684\u503c:".concat(i.id,"_").concat(i.name,"_").concat(i.desc));else{var n=i.default;i.type===AvgData.Type.Value.GameType.Global.type?n=GameDB.getGlobalValue(i.id):i.type===AvgData.Type.Value.GameType.Normal.type?n=GameDB.getNormalValue(i.id):(i.type,AvgData.Type.Value.GameType.System.type),this._allValue[i.id]={value:n,type:i.type,desc:i.desc,name:i.name}}}},getValueDataByID:function(e){return this._allValue[e]},runValueEvent:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var i=this.parseExec(e);if(null!==i){var n=e.valueID;if(null===n||""===n||void 0===this._allValue[n])return void console.error("\u5de6\u503c\u5f02\u5e38,\u6570\u503c\u4e8b\u4ef6\u6267\u884c\u5931\u8d25!");this._allValue[n].value=i,this.saveValue(),t&&this._showText(e),cc.log("\u8ba1\u7b97\u7ed3\u679c: ".concat(this._allValue[n].desc,"=").concat(this._allValue[n].value))}else cc.warn("\u6570\u503c\u4e8b\u4ef6\u53c2\u6570\u5f02\u5e38:".concat(JSON.stringify(e)))}},parseExec:function(e){var t=e.exec;if(!t)return cc.warn("\u6570\u503c\u8ba1\u7b97\u516c\u5f0f\u4e3a\u7a7a!"),null;if(!Array.isArray(t))return cc.warn("\u6267\u884c\u4e8b\u4ef6\u8ba1\u7b97\u516c\u5f0f\u5e94\u8be5\u4e3a\u6570\u7ec4"),null;if(0===t.length)return cc.warn("\u8ba1\u7b97\u516c\u5f0f\u6570\u7ec4\u957f\u5ea6\u4e3a0,\u4e0d\u7b26\u5408\u8981\u6c42!"),null;for(var i=0,n="",o=AvgData.Type.ValueCalculatorType,a="+",c="-",s="*",r=function(e,t,i){return t===a?e+i:t===s?e*i:t===c?e-i:void 0},l=a,d=0;d<t.length;d++){var u=t[d];if(o.Number===u.type)u.value.toString(),n+=u.value,i=r(i,l,parseFloat(u.value.toString()));else if(o.Symbol===u.type)u.value,n+=u.value,l=u.value;else if(o.Variable===u.type){if(void 0===this._allValue[u.value])return console.error("\u8ba1\u7b97\u5f02\u5e38,\u65e0\u6548\u7684\u53d8\u91cfID:".concat(u.value)),null;'ValueMgr._allValue["'.concat(u.value,'"].value');var h=this._allValue[u.value];n+=h.desc,i=r(i,l,parseFloat(h.value.toString()))}}return n.length>0&&cc.log("\u8ba1\u7b97\u8fc7\u7a0b\u4e3a: ".concat(n)),i},_showText:function(e){var t=e.text;if(!(void 0===t||null===t||t.length<=0)){for(var i in this._allValue){var n=this._allValue[i];t=t.replace(new RegExp("<".concat(n.name,">"),"g"),n.value)}t.length>0&&cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowValueEvenShowText,{text:t,font:e.font})}}};cc.ValueMgr=t.exports=n,cc._RF.pop()},{LocalStorage:"LocalStorage",ValueDebugTool:"ValueDebugTool"}],VideoDebugButton:[function(e,t,i){"use strict";cc._RF.push(t,"a3cfaRQiwtBO7nHwkNYha5o","VideoDebugButton"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var e=0;this.node.on(cc.Node.EventType.TOUCH_START,function(t){e=(new Date).getTime(),console.log("btn-star:".concat(e))}),this.node.on(cc.Node.EventType.TOUCH_END,function(t){((new Date).getTime()-e)/1e3>=5&&cc.VideoDebugTool.emitShowView()})},start:function(){},update:function(e){var t=cc.view.getFrameSize(),i=cc.view.getDesignResolutionSize();t.width/t.height>i.width/i.height?(this.node.width=200,this.node.height=30,this.node.x=0,this.node.y=-(i.height/2-this.node.height/2)):(this.node.width=60,this.node.height=200,this.node.x=-(i.width/2-this.node.width/2),this.node.y=0)}}),cc._RF.pop()},{}],VideoDebugLayer:[function(e,t,i){"use strict";cc._RF.push(t,"30600zxuYZAUo7aca65UGTY","VideoDebugLayer"),cc.Class({extends:cc.Component,properties:{playBtn:cc.Node,tipsLabel:cc.Label},onLoad:function(){this.node.setContentSize(cc.view.getVisibleSize()),cc.VideoDebugTool.curVideoLogic?(this.playBtn.active=!0,this.tipsLabel.string=""):(this.playBtn.active=!1,this.tipsLabel.string="\u6682\u65e0\u64ad\u653e\u7684\u89c6\u9891")},start:function(){},onBtnClickPlayVideo:function(){var e=cc.VideoDebugTool.curVideoLogic;e&&e.playVideo()}}),cc._RF.pop()},{}],VideoDebugTool:[function(e,t,i){"use strict";cc._RF.push(t,"9425aQEf1JJErOiVwOtwJd4","VideoDebugTool");var n={init:function(){if(cc.sys.isBrowser){var e=document.createElement("button");e.style.position="absolute",e.style.width="100px",e.style.height="40px",document.body.append(e)}},emitShowView:function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.ShowVideoDebugView)},createView:function(e){var t=new cc.Node("debug-view");t.setContentSize(cc.view.getVisibleSize()),t.addComponent(cc.BlockInputEvents),t.on(cc.Node.EventType.TOUCH_END,function(e){e.stopPropagation(),t.destroy()});var i=cc.instantiate(e);return t.addChild(i),t},curVideoLogic:null};t.exports=cc.VideoDebugTool=n,window&&(window.ve=n.emitShowView),cc._RF.pop()},{}],VideoElement:[function(e,t,i){"use strict";cc._RF.push(t,"b88c6oa5k9NabWAr6/AdWYs","VideoElement");var n=e("VideoLogic");cc.Class({extends:cc.Component,properties:{},onInit:function(e){this.moviePlayerScript=e,this.videoLogic=new n,this.videoLogic.attachVideoNode(this.node)},update:function(){this.videoLogic.update()},playVideoFull:function(e){var t=this.videoLogic.videoPlayer;if(t){var i=new cc.Component.EventHandler;i.target=this.node.parent,i.component="MoviePlayer",i.handler="onVideoPlayerEvent",i.customEventData="",t.videoPlayerEvent.push(i),this.videoLogic.playVideo()}},_onVideoUpdateSchedule:function(){var e=this.videoLogic.videoDom;e&&(e.currentTime>=this.deadTime&&(this.unschedule(this._onVideoUpdateSchedule),this.videoLogic.onVideoPlayFinish(),this.moviePlayerScript&&this.moviePlayerScript.emitFinishCallBack()))},playVideoFragment:function(e){var t=e.time,i=this.videoLogic.videoDom;if(i){this.deadTime=t;var n=function(){};this.schedule(this._onVideoUpdateSchedule,.1),i.addEventListener("timeupdate",n),i.addEventListener("ended",function(){i.removeEventListener("timeupdate",n),this.unschedule(this._onVideoUpdateSchedule),this.videoLogic.onVideoPlayFinish(),this.moviePlayerScript&&this.moviePlayerScript.emitFinishCallBack()}.bind(this)),this.videoLogic.playVideo()}},setVideoSrc:function(t){var i=null,n=this.videoLogic.videoPlayer;return!t.src&&t.src.length<=0?(cc.log("\u89c6\u9891\u672a\u8bbe\u7f6e\u64ad\u653e\u6e90\u6587\u4ef6"),n.remoteURL="",!1):t.isRemote?(i=AVG_EDITOR?Editor.AssetDB.uuidToPath(t.src):e("Assets").getUrlByUUID(t.src)).startsWith("https://")||i.startsWith("http://")?(n.remoteURL=i,!0):(console.error("\u65e0\u6548\u7684\u89c6\u9891\u5730\u5740: ".concat(i)),!1):AVG_EDITOR?Editor.AssetDB.isValidByUUID(t.src)?(n.remoteURL="".concat(Editor.PreviewServer.url,"/").concat(Editor.AssetDB.uuidToPath(t.src)),!0):(n.remoteURL="",this.videoLogic.cleanVideoSource(),!1):!!((i=e("Assets").getUrlByUUID(t.src))&&i.length>0)&&(n.remoteURL=this.videoLogic.getVideoFullSiteUrl(i),!0)},onDestroy:function(){this.videoLogic.removeBgDom()}}),cc._RF.pop()},{Assets:"Assets",VideoLogic:"VideoLogic"}],VideoGroupInit:[function(e,t,i){"use strict";cc._RF.push(t,"e601d0So2tMnLDzrCHJ/eCt","VideoGroupInit"),t.exports={ready:function(t){if(e("StoryData").getIsPublish()){var i=new(e("VideoLogic"));i.attachVideoNode(t),window.VideoLogicGroup=i,cc.ObserverMgr.addEventListener(cc.AvgMsg.Msg.WindowResize,function(e,i){e===cc.AvgMsg.Msg.WindowResize&&t.setContentSize(cc.view.getVisibleSize())},this)}}},cc._RF.pop()},{StoryData:"StoryData",VideoLogic:"VideoLogic"}],VideoGroupQuickTestTool:[function(e,t,i){"use strict";cc._RF.push(t,"1f938NGax5DFohfcxrIU80v","VideoGroupQuickTestTool");var n="video-group-quick-test-tool",o={isEnableTest:!1,enableTest:function(e){this.isEnableTest=!!e,cc.sys.localStorage.setItem(n,e)},initTools:function(){this.isEnableTest=!!cc.sys.localStorage.getItem(n)},clear:function(){this.isEnableTest=!1,cc.sys.localStorage.clear()}};t.exports=window.VideoGroupQuickTestTool=o,cc._RF.pop()},{}],VideoGroup:[function(e,t,i){"use strict";cc._RF.push(t,"398a33ECGtCfZuprE3O6pNW","VideoGroup");e("Assets"),e("VideoLogic");var n=e("StoryData"),o=e("VideoUtil");cc.Class({extends:cc.Component,properties:{},onInit:function(e){var t=this;this.moviePlayerScript=e,this.videoLogic=window.VideoLogicGroup;for(var i=[cc.Node.EventType.SCALE_CHANGED,cc.Node.EventType.SIZE_CHANGED,cc.Node.EventType.POSITION_CHANGED],n=0;n<i.length;n++)this.node.on(i[n],function(){var e=t.node.getPosition();t.videoLogic.node.setPosition(e);var i=t.node.getContentSize();t.videoLogic.node.setContentSize(i),t.videoLogic.node.scaleX=t.node.scaleX,t.videoLogic.node.scaleY=t.node.scaleY});this.videoLogic.node.setContentSize(cc.view.getVisibleSize())},start:function(){},update:function(){this.videoLogic.update()},playVideoFull:function(e){this._play(e)},playVideoFragment:function(e){this._play(e)},_onVideoUpdateSchedule:function(){var e=this.videoLogic.videoDom;if(e){var t=e.currentTime;cc.log("video time: ".concat(t,"/ ").concat(this.deadTime)),t>=this.deadTime&&(this.unschedule(this._onVideoUpdateSchedule),this.videoLogic.onVideoPlayFinish(),this.moviePlayerScript&&this.moviePlayerScript.emitFinishCallBack())}},_play:function(e){var t=this;this.videoLogic.setEnableVideoPlayer(!0);var i=this.videoLogic.videoDom;if(i){var o=null;this.moviePlayerScript&&this.moviePlayerScript.avgData&&(o=this.moviePlayerScript.avgData.src),n.getVideoInfo(o,function(n){if(n){var a=n.start,c=n.duration;void 0!==c&&void 0!==a||console.error("\u89c6\u9891\u4fe1\u606f\u5f02\u5e38[".concat(o,"]: start=").concat(a,", duration=").concat(c)),i.currentTime=a,t.videoLogic.videoPlayer.currentTime=a;var s=a;if(e.isFullPlay)s=a+c;else{var r=e.time;s=r<=c?a+r:a+c}t.deadTime=s;i.addEventListener("timeupdate",function(){}),t.schedule(t._onVideoUpdateSchedule,.1),t.videoEndedFunc=t._onVideoEnded.bind(t),i.addEventListener("ended",t.videoEndedFunc),t._playVideoLogic()}else cc.error("\u83b7\u53d6\u89c6\u9891\u4fe1\u606f\u5931\u8d25:".concat(o))})}},_onVideoEnded:function(){this.unschedule(this._onVideoUpdateSchedule),this.videoLogic.onVideoPlayFinish(),this.moviePlayerScript&&this.moviePlayerScript.emitFinishCallBack()},onDestroy:function(){this.videoLogic.setEnableVideoPlayer(!1);var e=this.videoLogic.videoDom;e&&this.videoEndedFunc&&e.removeEventListener("ended",this.videoEndedFunc)},_playVideoLogic:function(){cc.GameUtil.getIsWeiXinBrowser()?o.isFirstPlayInWX()?(console.log("[\u5fae\u4fe1\u6d4f\u89c8\u5668]\u64ad\u653e\u89c6\u9891:1"),cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.AddVideoPlayBtn)):(console.log("[\u5fae\u4fe1\u6d4f\u89c8\u5668]\u64ad\u653e\u89c6\u9891:1+"),this.videoLogic.playVideo()):this.videoLogic.playVideo()},setVideoSrc:function(e){}}),cc._RF.pop()},{Assets:"Assets",StoryData:"StoryData",VideoLogic:"VideoLogic",VideoUtil:"VideoUtil"}],VideoLogic:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}cc._RF.push(t,"6e486n1uKFM0YE+pJBVCXYz","VideoLogic");e("LocalStorage");var c=null,s=function(){function t(){n(this,t),this.isPlaying=!0,this.videoPlayer=null,this.VideoVolume=1,this.node=null,this.bgDom=null,c=this}return a(t,[{key:"onVideoPlayFinish",value:function(){this.pauseVideo()}},{key:"getVideoFullSiteUrl",value:function(e){var t=window.location.origin+window.location.pathname;return"/"===t[t.length-1]?t+e:"".concat(t,"/").concat(e)}},{key:"cleanVideoSource",value:function(){var e=this.videoDom;if(e){e.src="";for(var t=e.getElementsByTagName("source"),i=0;i<t.length;i++)e.removeChild(t[i])}}},{key:"attachVideoNode",value:function(e){this.node=e,this.videoPlayer=null;var t=e.getComponent(cc.VideoPlayer);t||(t=e.addComponent(cc.VideoPlayer)),t.ResourceType=cc.VideoPlayer.ResourceType.REMOTE,t.keepAspectRatio=!1,t.isFullscreen=!1,t.mute=!1,this.videoPlayer=t,this._createBgDom(),this.adjustVideoAttributeWithX5()}},{key:"adjustVideoAttributeWithX5",value:function(){var t=this.videoDom;if(t){t.style.position="absolute",t.setAttribute("playsinline","true"),t.setAttribute("webkit-playsinline","true"),t.setAttribute("x-webkit-airplay","allow"),t.setAttribute("width","".concat(window.innerWidth)),t.setAttribute("height","".concat(window.innerHeight)),t.setAttribute("x5-video-player-type","h5"),t.setAttribute("x5-video-player-fullscreen","true"),t.setAttribute("autoplay","");var i=e("StoryConfig").file.init.data.size;i?i.width>i.height?(console.log("\u89c6\u9891\u6a2a\u5c4f"),t.setAttribute("x5-video-orientation","landscape")):(console.log("\u89c6\u9891\u7ad6\u5c4f"),t.setAttribute("x5-video-orientation","portrait")):cc.warn("\u672a\u53d1\u73b0\u6e38\u620f\u8bbe\u7f6e\u7684\u5206\u8fa8\u7387\u4fe1\u606f")}}},{key:"_createBgDom",value:function(){var e=this;if(cc.sys.isBrowser){var t=document.getElementById("Cocos2dGameContainer");if(t){var i=document.createElement("div");t.appendChild(i),this.bgDom=i,this.node.on(cc.Node.EventType.SCALE_CHANGED,function(){e.updateBgDom()}),this.node.on(cc.Node.EventType.SIZE_CHANGED,function(){e.updateBgDom()}),this.node.on(cc.Node.EventType.POSITION_CHANGED,function(){e.updateBgDom()}),this.updateBgDom()}}}},{key:"removeBgDom",value:function(){var e=document.getElementById("Cocos2dGameContainer");e&&this.bgDom&&e.removeChild(this.bgDom)}},{key:"updateVideoDisplayMode",value:function(e){if(this.videoDom){var t=this.videoDom.style;e.displayMode&&(e.displayMode===AvgData.Type.VideoDisplayMode.Full.type?t.objectFit="fill":(e.displayMode,AvgData.Type.VideoDisplayMode.Fit.type,t.objectFit="contain"))}}},{key:"update",value:function(){this.updateBgDom()}},{key:"_watchVideoFullScreen",value:function(){var e=this.videoDom;e&&(e.removeEventListener("x5videoenterfullscreen",this._onX5VideoEnterFullScreen),e.removeEventListener("x5videoexitfullscreen",this._onX5VideoExitFullScreen),e.addEventListener("x5videoenterfullscreen",this._onX5VideoEnterFullScreen),e.addEventListener("x5videoexitfullscreen",this._onX5VideoExitFullScreen))}},{key:"_onX5VideoEnterFullScreen",value:function(){cc.PlatformVar.X5VideoIsFullScreenPlay=!0,cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.X5VideoFullScreen,!0),console.log("player x5videoenterfullscreen")}},{key:"_onX5VideoExitFullScreen",value:function(){cc.PlatformVar.X5VideoIsFullScreenPlay=!1,cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.X5VideoFullScreen,!1),console.log("player x5videoexitfullscreen");var e=c;e.isPlaying&&e.videoPlayer.play()}},{key:"playWithButton",value:function(){this.videoPlayer.play(),this.isPlaying=!0,this._watchVideoFullScreen()}},{key:"playVideo",value:function(){var e=this;if(cc.VideoDebugTool.curVideoLogic=this,this.videoPlayer&&!this.videoPlayer.isPlaying()){console.log("\u64ad\u653e\u89c6\u9891"),this.adjustVideoAttributeWithX5(),this.videoPlayer.play(),this._watchVideoFullScreen();var t=this.videoDom.play();void 0!==t&&t.then(function(){e.isPlaying=!0,console.log("\u81ea\u52a8\u64ad\u653e\u4e2d...")}).catch(function(t){console.log(t),e.isPlaying=!1,console.log("\u7981\u6b62\u81ea\u52a8\u64ad\u653e"),e._dealVideoAutoPlay()})}}},{key:"_dealVideoAutoPlay",value:function(){cc.ObserverMgr.dispatchMsg(cc.AvgMsg.Msg.AddVideoPlayBtn)}},{key:"_onClickToPlay",value:function(){document.removeEventListener("click",this._onClickPlay),this.videoDom&&this.videoDom.play()}},{key:"_onClickPlay",value:function(){console.log("click document"),c._onClickToPlay()}},{key:"pauseVideo",value:function(){this.videoPlayer&&(this.videoPlayer.pause(),this.videoDom.pause(),this.isPlaying=!1)}},{key:"setVideoVolume",value:function(e){this.videoPlayer&&(this.VideoVolume=e,this.updateVideoVolume())}},{key:"updateVideoVolume",value:function(){var e=this._calcVolume(this.VideoVolume);this.videoPlayer.volume=e,this.videoDom.volume=e}},{key:"_calcVolume",value:function(e){return e/100*GameDB.MusicVolume}},{key:"setEnableVideoPlayer",value:function(e){this.videoPlayer.enabled=e,this.updateBgDom()}},{key:"updateBgDom",value:function(){if(this.videoDom&&this.bgDom){var e=this.videoDom.style,t=this.bgDom.style;t.backgroundColor="#1a1a1a",t.position="absolute",t.bottom="0px",t.left="0px",t.visibility=e.visibility;var i=parseInt(e.zIndex.toString())-1;t.zIndex=i.toString(),t.display="inline-block",t.transformOrigin=e.transformOrigin,t.transform=e.transform,t.width=e.width,t.height=e.height}}},{key:"updateOpacity",value:function(e){this.videoDom&&(this.videoDom.style.opacity=e/255)}},{key:"setVideoSrcOnPublishEnv",value:function(){var t=cc.StoryConfig.file.init.data;if(t.youkuEnabled){var i=t.youkuVideo;this.videoDom.src=remoteURL,cc.log("mp4 link: ".concat(i))}else{var n=e("Assets").getRealUrl(AvgData.ProjectCfg.videoFile),o=this.getVideoFullSiteUrl(n);console.log("video url: ".concat(o)),this.videoDom.src=o}}},{key:"videoDom",get:function(){return this.videoPlayer&&this.videoPlayer._impl&&this.videoPlayer._impl._video?this.videoPlayer._impl._video:null}}]),t}();t.exports=s,cc._RF.pop()},{Assets:"Assets",LocalStorage:"LocalStorage",StoryConfig:"StoryConfig"}],VideoTestScene2:[function(e,t,i){"use strict";cc._RF.push(t,"928f9fMReRMr5ccXkpeCH2l","VideoTestScene2"),cc._RF.pop()},{VideoGroup:"VideoGroup",VideoGroupInit:"VideoGroupInit"}],VideoTestScene:[function(e,t,i){"use strict";cc._RF.push(t,"2e90dpVXKFLAbCh/WuZFsZT","VideoTestScene"),cc._RF.pop()},{}],VideoUtil:[function(e,t,i){"use strict";cc._RF.push(t,"6146c0JHRRF+IGD2deEf0KB","VideoUtil"),t.exports={_playCount:!1,isFirstPlayInWX:function(){return!1===this._playCount&&(this._playCount=!0,!0)},resetFirstPlay:function(){this._playCount=!1}},cc._RF.pop()},{}],chroma:[function(e,t,i){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cc._RF.push(t,"c048fYwRSNLbr5nYp4kAcdg","chroma"),function(e,o){"object"===(void 0===i?"undefined":n(i))&&void 0!==t?t.exports=o():"function"==typeof define&&define.amd?define(o):(void 0).chroma=o()}(0,function(){for(var e=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),e<t?t:e>i?i:e},t={},i=0,n=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];i<n.length;i+=1){var o=n[i];t["[object "+o+"]"]=o.toLowerCase()}var a=function(e){return t[Object.prototype.toString.call(e)]||"object"},c=Math.PI,s={clip_rgb:function(t){t._clipped=!1,t._unclipped=t.slice(0);for(var i=0;i<=3;i++)i<3?((t[i]<0||t[i]>255)&&(t._clipped=!0),t[i]=e(t[i],0,255)):3===i&&(t[i]=e(t[i],0,1));return t},limit:e,type:a,unpack:function(e,t){return void 0===t&&(t=null),e.length>=3?Array.prototype.slice.call(e):"object"==a(e[0])&&t?t.split("").filter(function(t){return void 0!==e[0][t]}).map(function(t){return e[0][t]}):e[0]},last:function(e){if(e.length<2)return null;var t=e.length-1;return"string"==a(e[t])?e[t].toLowerCase():null},PI:c,TWOPI:2*c,PITHIRD:c/3,DEG2RAD:c/180,RAD2DEG:180/c},r={format:{},autodetect:[]},l=s.last,d=s.clip_rgb,u=s.type,h=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if("object"===u(e[0])&&e[0].constructor&&e[0].constructor===this.constructor)return e[0];var i=l(e),n=!1;if(!i){n=!0,r.sorted||(r.autodetect=r.autodetect.sort(function(e,t){return t.p-e.p}),r.sorted=!0);for(var o=0,a=r.autodetect;o<a.length;o+=1){var c=a[o];if(i=c.test.apply(c,e))break}}if(!r.format[i])throw new Error("unknown format: "+e);var s=r.format[i].apply(null,n?e:e.slice(0,-1));this._rgb=d(s),3===this._rgb.length&&this._rgb.push(1)};h.prototype.toString=function(){return"function"==u(this.hex)?this.hex():"["+this._rgb.join(",")+"]"};var g=h,p=function e(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(e.Color,[null].concat(t)))};p.Color=g,p.version="2.0.4";var f=p,v=s.unpack,y=Math.max,m=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=v(e,"rgb"),n=i[0],o=i[1],a=i[2],c=1-y(n/=255,y(o/=255,a/=255)),s=c<1?1/(1-c):0;return[(1-n-c)*s,(1-o-c)*s,(1-a-c)*s,c]},_=s.unpack,A=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=(e=_(e,"cmyk"))[0],n=e[1],o=e[2],a=e[3],c=e.length>4?e[4]:1;return 1===a?[0,0,0,c]:[i>=1?0:255*(1-i)*(1-a),n>=1?0:255*(1-n)*(1-a),o>=1?0:255*(1-o)*(1-a),c]},b=s.unpack,S=s.type;g.prototype.cmyk=function(){return m(this._rgb)},f.cmyk=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["cmyk"])))},r.format.cmyk=A,r.autodetect.push({p:2,test:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(e=b(e,"cmyk"),"array"===S(e)&&4===e.length)return"cmyk"}});var D=s.unpack,T=s.last,E=function(e){return Math.round(100*e)/100},P=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=D(e,"hsla"),n=T(e)||"lsa";return i[0]=E(i[0]||0),i[1]=E(100*i[1])+"%",i[2]=E(100*i[2])+"%","hsla"===n||i.length>3&&i[3]<1?(i[3]=i.length>3?i[3]:1,n="hsla"):i.length=3,n+"("+i.join(",")+")"},M=s.unpack,N=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=(e=M(e,"rgba"))[0],n=e[1],o=e[2];i/=255,n/=255,o/=255;var a,c,s=Math.min(i,n,o),r=Math.max(i,n,o),l=(r+s)/2;return r===s?(a=0,c=Number.NaN):a=l<.5?(r-s)/(r+s):(r-s)/(2-r-s),i==r?c=(n-o)/(r-s):n==r?c=2+(o-i)/(r-s):o==r&&(c=4+(i-n)/(r-s)),(c*=60)<0&&(c+=360),e.length>3&&void 0!==e[3]?[c,a,l,e[3]]:[c,a,l]},w=s.unpack,C=s.last,I=Math.round,B=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=w(e,"rgba"),n=C(e)||"rgb";return"hsl"==n.substr(0,3)?P(N(i),n):(i[0]=I(i[0]),i[1]=I(i[1]),i[2]=I(i[2]),("rgba"===n||i.length>3&&i[3]<1)&&(i[3]=i.length>3?i[3]:1,n="rgba"),n+"("+i.slice(0,"rgb"===n?3:4).join(",")+")")},k=s.unpack,L=Math.round,R=function(){for(var e,t=[],i=arguments.length;i--;)t[i]=arguments[i];var n,o,a,c=(t=k(t,"hsl"))[0],s=t[1],r=t[2];if(0===s)n=o=a=255*r;else{var l=[0,0,0],d=[0,0,0],u=r<.5?r*(1+s):r+s-r*s,h=2*r-u,g=c/360;l[0]=g+1/3,l[1]=g,l[2]=g-1/3;for(var p=0;p<3;p++)l[p]<0&&(l[p]+=1),l[p]>1&&(l[p]-=1),6*l[p]<1?d[p]=h+6*(u-h)*l[p]:2*l[p]<1?d[p]=u:3*l[p]<2?d[p]=h+(u-h)*(2/3-l[p])*6:d[p]=h;n=(e=[L(255*d[0]),L(255*d[1]),L(255*d[2])])[0],o=e[1],a=e[2]}return t.length>3?[n,o,a,t[3]]:[n,o,a,1]},O=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,F=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,V=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,x=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,z=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,U=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,G=Math.round,Q=function(e){var t;if(e=e.toLowerCase().trim(),r.format.named)try{return r.format.named(e)}catch(e){}if(t=e.match(O)){for(var i=t.slice(1,4),n=0;n<3;n++)i[n]=+i[n];return i[3]=1,i}if(t=e.match(F)){for(var o=t.slice(1,5),a=0;a<4;a++)o[a]=+o[a];return o}if(t=e.match(V)){for(var c=t.slice(1,4),s=0;s<3;s++)c[s]=G(2.55*c[s]);return c[3]=1,c}if(t=e.match(x)){for(var l=t.slice(1,5),d=0;d<3;d++)l[d]=G(2.55*l[d]);return l[3]=+l[3],l}if(t=e.match(z)){var u=t.slice(1,4);u[1]*=.01,u[2]*=.01;var h=R(u);return h[3]=1,h}if(t=e.match(U)){var g=t.slice(1,4);g[1]*=.01,g[2]*=.01;var p=R(g);return p[3]=+t[4],p}};Q.test=function(e){return O.test(e)||F.test(e)||V.test(e)||x.test(e)||z.test(e)||U.test(e)};var H=Q,q=s.type;g.prototype.css=function(e){return B(this._rgb,e)},f.css=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["css"])))},r.format.css=H,r.autodetect.push({p:5,test:function(e){for(var t=[],i=arguments.length-1;i-- >0;)t[i]=arguments[i+1];if(!t.length&&"string"===q(e)&&H.test(e))return"css"}});var J=s.unpack;r.format.gl=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=J(e,"rgba");return i[0]*=255,i[1]*=255,i[2]*=255,i},f.gl=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["gl"])))},g.prototype.gl=function(){var e=this._rgb;return[e[0]/255,e[1]/255,e[2]/255,e[3]]};var W=s.unpack,j=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i,n=W(e,"rgb"),o=n[0],a=n[1],c=n[2],s=Math.min(o,a,c),r=Math.max(o,a,c),l=r-s,d=100*l/255,u=s/(255-l)*100;return 0===l?i=Number.NaN:(o===r&&(i=(a-c)/l),a===r&&(i=2+(c-o)/l),c===r&&(i=4+(o-a)/l),(i*=60)<0&&(i+=360)),[i,d,u]},X=s.unpack,Y=Math.floor,Z=function(){for(var e,t,i,n,o,a,c=[],s=arguments.length;s--;)c[s]=arguments[s];var r,l,d,u=(c=X(c,"hcg"))[0],h=c[1],g=c[2];g*=255;var p=255*h;if(0===h)r=l=d=g;else{360===u&&(u=0),u>360&&(u-=360),u<0&&(u+=360);var f=Y(u/=60),v=u-f,y=g*(1-h),m=y+p*(1-v),_=y+p*v,A=y+p;switch(f){case 0:r=(e=[A,_,y])[0],l=e[1],d=e[2];break;case 1:r=(t=[m,A,y])[0],l=t[1],d=t[2];break;case 2:r=(i=[y,A,_])[0],l=i[1],d=i[2];break;case 3:r=(n=[y,m,A])[0],l=n[1],d=n[2];break;case 4:r=(o=[_,y,A])[0],l=o[1],d=o[2];break;case 5:r=(a=[A,y,m])[0],l=a[1],d=a[2]}}return[r,l,d,c.length>3?c[3]:1]},K=s.unpack,$=s.type;g.prototype.hcg=function(){return j(this._rgb)},f.hcg=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["hcg"])))},r.format.hcg=Z,r.autodetect.push({p:1,test:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(e=K(e,"hcg"),"array"===$(e)&&3===e.length)return"hcg"}});var ee=s.unpack,te=s.last,ie=Math.round,ne=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=ee(e,"rgba"),n=i[0],o=i[1],a=i[2],c=i[3],s=te(e)||"auto";void 0===c&&(c=1),"auto"===s&&(s=c<1?"rgba":"rgb");var r="000000"+((n=ie(n))<<16|(o=ie(o))<<8|(a=ie(a))).toString(16);r=r.substr(r.length-6);var l="0"+ie(255*c).toString(16);switch(l=l.substr(l.length-2),s.toLowerCase()){case"rgba":return"#"+r+l;case"argb":return"#"+l+r;default:return"#"+r}},oe=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,ae=/^#?([A-Fa-f0-9]{8})$/,ce=function(e){if(e.match(oe)){4!==e.length&&7!==e.length||(e=e.substr(1)),3===e.length&&(e=(e=e.split(""))[0]+e[0]+e[1]+e[1]+e[2]+e[2]);var t=parseInt(e,16);return[t>>16,t>>8&255,255&t,1]}if(e.match(ae)){9===e.length&&(e=e.substr(1));var i=parseInt(e,16);return[i>>24&255,i>>16&255,i>>8&255,Math.round((255&i)/255*100)/100]}throw new Error("unknown hex color: "+e)},se=s.type;g.prototype.hex=function(e){return ne(this._rgb,e)},f.hex=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["hex"])))},r.format.hex=ce,r.autodetect.push({p:4,test:function(e){for(var t=[],i=arguments.length-1;i-- >0;)t[i]=arguments[i+1];if(!t.length&&"string"===se(e)&&[3,4,6,7,8,9].includes(e.length))return"hex"}});var re=s.unpack,le=s.TWOPI,de=Math.min,ue=Math.sqrt,he=Math.acos,ge=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i,n=re(e,"rgb"),o=n[0],a=n[1],c=n[2],s=de(o/=255,a/=255,c/=255),r=(o+a+c)/3,l=r>0?1-s/r:0;return 0===l?i=NaN:(i=(o-a+(o-c))/2,i/=ue((o-a)*(o-a)+(o-c)*(a-c)),i=he(i),c>a&&(i=le-i),i/=le),[360*i,l,r]},pe=s.unpack,fe=s.limit,ve=s.TWOPI,ye=s.PITHIRD,me=Math.cos,_e=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i,n,o,a=(e=pe(e,"hsi"))[0],c=e[1],s=e[2];return isNaN(a)&&(a=0),isNaN(c)&&(c=0),a>360&&(a-=360),a<0&&(a+=360),(a/=360)<1/3?n=1-((o=(1-c)/3)+(i=(1+c*me(ve*a)/me(ye-ve*a))/3)):a<2/3?o=1-((i=(1-c)/3)+(n=(1+c*me(ve*(a-=1/3))/me(ye-ve*a))/3)):i=1-((n=(1-c)/3)+(o=(1+c*me(ve*(a-=2/3))/me(ye-ve*a))/3)),[255*(i=fe(s*i*3)),255*(n=fe(s*n*3)),255*(o=fe(s*o*3)),e.length>3?e[3]:1]},Ae=s.unpack,be=s.type;g.prototype.hsi=function(){return ge(this._rgb)},f.hsi=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["hsi"])))},r.format.hsi=_e,r.autodetect.push({p:2,test:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(e=Ae(e,"hsi"),"array"===be(e)&&3===e.length)return"hsi"}});var Se=s.unpack,De=s.type;g.prototype.hsl=function(){return N(this._rgb)},f.hsl=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["hsl"])))},r.format.hsl=R,r.autodetect.push({p:2,test:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(e=Se(e,"hsl"),"array"===De(e)&&3===e.length)return"hsl"}});var Te=s.unpack,Ee=Math.min,Pe=Math.max,Me=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i,n,o,a=(e=Te(e,"rgb"))[0],c=e[1],s=e[2],r=Ee(a,c,s),l=Pe(a,c,s),d=l-r;return o=l/255,0===l?(i=Number.NaN,n=0):(n=d/l,a===l&&(i=(c-s)/d),c===l&&(i=2+(s-a)/d),s===l&&(i=4+(a-c)/d),(i*=60)<0&&(i+=360)),[i,n,o]},Ne=s.unpack,we=Math.floor,Ce=function(){for(var e,t,i,n,o,a,c=[],s=arguments.length;s--;)c[s]=arguments[s];var r,l,d,u=(c=Ne(c,"hsv"))[0],h=c[1],g=c[2];if(g*=255,0===h)r=l=d=g;else{360===u&&(u=0),u>360&&(u-=360),u<0&&(u+=360);var p=we(u/=60),f=u-p,v=g*(1-h),y=g*(1-h*f),m=g*(1-h*(1-f));switch(p){case 0:r=(e=[g,m,v])[0],l=e[1],d=e[2];break;case 1:r=(t=[y,g,v])[0],l=t[1],d=t[2];break;case 2:r=(i=[v,g,m])[0],l=i[1],d=i[2];break;case 3:r=(n=[v,y,g])[0],l=n[1],d=n[2];break;case 4:r=(o=[m,v,g])[0],l=o[1],d=o[2];break;case 5:r=(a=[g,v,y])[0],l=a[1],d=a[2]}}return[r,l,d,c.length>3?c[3]:1]},Ie=s.unpack,Be=s.type;g.prototype.hsv=function(){return Me(this._rgb)},f.hsv=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["hsv"])))},r.format.hsv=Ce,r.autodetect.push({p:2,test:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(e=Ie(e,"hsv"),"array"===Be(e)&&3===e.length)return"hsv"}});var ke=18,Le=.95047,Re=1,Oe=1.08883,Fe=.137931034,Ve=.206896552,xe=.12841855,ze=.008856452,Ue=s.unpack,Ge=Math.pow,Qe=function(e){return(e/=255)<=.04045?e/12.92:Ge((e+.055)/1.055,2.4)},He=function(e){return e>ze?Ge(e,1/3):e/xe+Fe},qe=function(e,t,i){return e=Qe(e),t=Qe(t),i=Qe(i),[He((.4124564*e+.3575761*t+.1804375*i)/Le),He((.2126729*e+.7151522*t+.072175*i)/Re),He((.0193339*e+.119192*t+.9503041*i)/Oe)]},Je=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=Ue(e,"rgb"),n=i[0],o=i[1],a=i[2],c=qe(n,o,a),s=c[0],r=c[1],l=c[2],d=116*r-16;return[d<0?0:d,500*(s-r),200*(r-l)]},We=s.unpack,je=Math.pow,Xe=function(e){return 255*(e<=.00304?12.92*e:1.055*je(e,1/2.4)-.055)},Ye=function(e){return e>Ve?e*e*e:xe*(e-Fe)},Ze=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i,n,o,a=(e=We(e,"lab"))[0],c=e[1],s=e[2];return n=(a+16)/116,i=isNaN(c)?n:n+c/500,o=isNaN(s)?n:n-s/200,n=Re*Ye(n),i=Le*Ye(i),o=Oe*Ye(o),[Xe(3.2404542*i-1.5371385*n-.4985314*o),Xe(-.969266*i+1.8760108*n+.041556*o),Xe(.0556434*i-.2040259*n+1.0572252*o),e.length>3?e[3]:1]},Ke=s.unpack,$e=s.type;g.prototype.lab=function(){return Je(this._rgb)},f.lab=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["lab"])))},r.format.lab=Ze,r.autodetect.push({p:2,test:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(e=Ke(e,"lab"),"array"===$e(e)&&3===e.length)return"lab"}});var et=s.unpack,tt=s.RAD2DEG,it=Math.sqrt,nt=Math.atan2,ot=Math.round,at=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=et(e,"lab"),n=i[0],o=i[1],a=i[2],c=it(o*o+a*a),s=(nt(a,o)*tt+360)%360;return 0===ot(1e4*c)&&(s=Number.NaN),[n,c,s]},ct=s.unpack,st=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=ct(e,"rgb"),n=i[0],o=i[1],a=i[2],c=Je(n,o,a),s=c[0],r=c[1],l=c[2];return at(s,r,l)},rt=s.unpack,lt=s.DEG2RAD,dt=Math.sin,ut=Math.cos,ht=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=rt(e,"lch"),n=i[0],o=i[1],a=i[2];return isNaN(a)&&(a=0),[n,ut(a*=lt)*o,dt(a)*o]},gt=s.unpack,pt=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=(e=gt(e,"lch"))[0],n=e[1],o=e[2],a=ht(i,n,o),c=a[0],s=a[1],r=a[2],l=Ze(c,s,r);return[l[0],l[1],l[2],e.length>3?e[3]:1]},ft=s.unpack,vt=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=ft(e,"hcl").reverse();return pt.apply(void 0,i)},yt=s.unpack,mt=s.type;g.prototype.lch=function(){return st(this._rgb)},g.prototype.hcl=function(){return st(this._rgb).reverse()},f.lch=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["lch"])))},f.hcl=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["hcl"])))},r.format.lch=pt,r.format.hcl=vt,["lch","hcl"].forEach(function(e){return r.autodetect.push({p:2,test:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];if(t=yt(t,e),"array"===mt(t)&&3===t.length)return e}})});var _t={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},At=s.type;g.prototype.name=function(){for(var e=ne(this._rgb,"rgb"),t=0,i=Object.keys(_t);t<i.length;t+=1){var n=i[t];if(_t[n]===e)return n.toLowerCase()}return e},r.format.named=function(e){if(e=e.toLowerCase(),_t[e])return ce(_t[e]);throw new Error("unknown color name: "+e)},r.autodetect.push({p:5,test:function(e){for(var t=[],i=arguments.length-1;i-- >0;)t[i]=arguments[i+1];if(!t.length&&"string"===At(e)&&_t[e.toLowerCase()])return"named"}});var bt=s.unpack,St=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=bt(e,"rgb");return(i[0]<<16)+(i[1]<<8)+i[2]},Dt=s.type,Tt=function(e){if("number"==Dt(e)&&e>=0&&e<=16777215)return[e>>16,e>>8&255,255&e,1];throw new Error("unknown num color: "+e)},Et=s.type;g.prototype.num=function(){return St(this._rgb)},f.num=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["num"])))},r.format.num=Tt,r.autodetect.push({p:5,test:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(1===e.length&&"number"===Et(e[0])&&e[0]>=0&&e[0]<=16777215)return"num"}});var Pt=s.unpack,Mt=s.type,Nt=Math.round;g.prototype.rgb=function(e){return void 0===e&&(e=!0),!1===e?this._rgb.slice(0,3):this._rgb.slice(0,3).map(Nt)},g.prototype.rgba=function(e){return void 0===e&&(e=!0),this._rgb.slice(0,4).map(function(t,i){return i<3?!1===e?t:Nt(t):t})},f.rgb=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["rgb"])))},r.format.rgb=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var i=Pt(e,"rgba");return void 0===i[3]&&(i[3]=1),i},r.autodetect.push({p:3,test:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(e=Pt(e,"rgba"),"array"===Mt(e)&&(3===e.length||4===e.length&&"number"==Mt(e[3])&&e[3]>=0&&e[3]<=1))return"rgb"}});var wt=Math.log,Ct=function(e){var t,i,n,o=e/100;return o<66?(t=255,i=-155.25485562709179-.44596950469579133*(i=o-2)+104.49216199393888*wt(i),n=o<20?0:.8274096064007395*(n=o-10)-254.76935184120902+115.67994401066147*wt(n)):(t=351.97690566805693+.114206453784165*(t=o-55)-40.25366309332127*wt(t),i=325.4494125711974+.07943456536662342*(i=o-50)-28.0852963507957*wt(i),n=255),[t,i,n,1]},It=s.unpack,Bt=Math.round,kt=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var i,n=It(e,"rgb"),o=n[0],a=n[2],c=1e3,s=4e4;s-c>.4;){var r=Ct(i=.5*(s+c));r[2]/r[0]>=a/o?s=i:c=i}return Bt(i)};g.prototype.temp=g.prototype.kelvin=g.prototype.temperature=function(){return kt(this._rgb)},f.temp=f.kelvin=f.temperature=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new(Function.prototype.bind.apply(g,[null].concat(e,["temp"])))},r.format.temp=r.format.kelvin=r.format.temperature=Ct;var Lt=s.type;g.prototype.alpha=function(e,t){return void 0===t&&(t=!1),void 0!==e&&"number"===Lt(e)?t?(this._rgb[3]=e,this):new g([this._rgb[0],this._rgb[1],this._rgb[2],e],"rgb"):this._rgb[3]},g.prototype.clipped=function(){return this._rgb._clipped||!1},g.prototype.darken=function(e){void 0===e&&(e=1);var t=this.lab();return t[0]-=ke*e,new g(t,"lab").alpha(this.alpha(),!0)},g.prototype.brighten=function(e){return void 0===e&&(e=1),this.darken(-e)},g.prototype.darker=g.prototype.darken,g.prototype.brighter=g.prototype.brighten,g.prototype.get=function(e){var t=e.split("."),i=t[0],n=t[1],o=this[i]();if(n){var a=i.indexOf(n);if(a>-1)return o[a];throw new Error("unknown channel "+n+" in mode "+i)}return o};var Rt=s.type,Ot=Math.pow;g.prototype.luminance=function(e){if(void 0!==e&&"number"===Rt(e)){if(0===e)return new g([0,0,0,this._rgb[3]],"rgb");if(1===e)return new g([255,255,255,this._rgb[3]],"rgb");var t=20,i=function i(n,o){var a=n.interpolate(o,.5,"rgb"),c=a.luminance();return Math.abs(e-c)<1e-7||!t--?a:c>e?i(n,a):i(a,o)},n=(this.luminance()>e?i(new g([0,0,0]),this):i(this,new g([255,255,255]))).rgb();return new g(n.concat([this._rgb[3]]))}return Ft.apply(void 0,this._rgb.slice(0,3))};var Ft=function(e,t,i){return.2126*(e=Vt(e))+.7152*(t=Vt(t))+.0722*(i=Vt(i))},Vt=function(e){return(e/=255)<=.03928?e/12.92:Ot((e+.055)/1.055,2.4)},xt={},zt=s.type,Ut=function(e,t,i){void 0===i&&(i=.5);for(var n=[],o=arguments.length-3;o-- >0;)n[o]=arguments[o+3];var a=n[0]||"lrgb";if(xt[a]||n.length||(a=Object.keys(xt)[0]),!xt[a])throw new Error("interpolation mode "+a+" is not defined");return"object"!==zt(e)&&(e=new g(e)),"object"!==zt(t)&&(t=new g(t)),xt[a](e,t,i).alpha(e.alpha()+i*(t.alpha()-e.alpha()))};g.prototype.mix=g.prototype.interpolate=function(e,t){void 0===t&&(t=.5);for(var i=[],n=arguments.length-2;n-- >0;)i[n]=arguments[n+2];return Ut.apply(void 0,[this,e,t].concat(i))},g.prototype.premultiply=function(e){void 0===e&&(e=!1);var t=this._rgb,i=t[3];return e?(this._rgb=[t[0]*i,t[1]*i,t[2]*i,i],this):new g([t[0]*i,t[1]*i,t[2]*i,i],"rgb")},g.prototype.saturate=function(e){void 0===e&&(e=1);var t=this.lch();return t[1]+=ke*e,t[1]<0&&(t[1]=0),new g(t,"lch").alpha(this.alpha(),!0)},g.prototype.desaturate=function(e){return void 0===e&&(e=1),this.saturate(-e)};var Gt=s.type;g.prototype.set=function(e,t,i){void 0===i&&(i=!1);var n=e.split("."),o=n[0],a=n[1],c=this[o]();if(a){var s=o.indexOf(a);if(s>-1){if("string"==Gt(t))switch(t.charAt(0)){case"+":case"-":c[s]+=+t;break;case"*":c[s]*=+t.substr(1);break;case"/":c[s]/=+t.substr(1);break;default:c[s]=+t}else{if("number"!==Gt(t))throw new Error("unsupported value for Color.set");c[s]=t}var r=new g(c,o);return i?(this._rgb=r._rgb,this):r}throw new Error("unknown channel "+a+" in mode "+o)}return c};xt.rgb=function(e,t,i){var n=e._rgb,o=t._rgb;return new g(n[0]+i*(o[0]-n[0]),n[1]+i*(o[1]-n[1]),n[2]+i*(o[2]-n[2]),"rgb")};var Qt=Math.sqrt,Ht=Math.pow;xt.lrgb=function(e,t,i){var n=e._rgb,o=n[0],a=n[1],c=n[2],s=t._rgb,r=s[0],l=s[1],d=s[2];return new g(Qt(Ht(o,2)*(1-i)+Ht(r,2)*i),Qt(Ht(a,2)*(1-i)+Ht(l,2)*i),Qt(Ht(c,2)*(1-i)+Ht(d,2)*i),"rgb")};xt.lab=function(e,t,i){var n=e.lab(),o=t.lab();return new g(n[0]+i*(o[0]-n[0]),n[1]+i*(o[1]-n[1]),n[2]+i*(o[2]-n[2]),"lab")};var qt=function(e,t,i,n){var o,a,c,s,r,l,d,u,h,p,f,v;return"hsl"===n?(c=e.hsl(),s=t.hsl()):"hsv"===n?(c=e.hsv(),s=t.hsv()):"hcg"===n?(c=e.hcg(),s=t.hcg()):"hsi"===n?(c=e.hsi(),s=t.hsi()):"lch"!==n&&"hcl"!==n||(n="hcl",c=e.hcl(),s=t.hcl()),"h"===n.substr(0,1)&&(r=(o=c)[0],d=o[1],h=o[2],l=(a=s)[0],u=a[1],p=a[2]),isNaN(r)||isNaN(l)?isNaN(r)?isNaN(l)?v=Number.NaN:(v=l,1!=h&&0!=h||"hsv"==n||(f=u)):(v=r,1!=p&&0!=p||"hsv"==n||(f=d)):v=r+i*(l>r&&l-r>180?l-(r+360):l<r&&r-l>180?l+360-r:l-r),void 0===f&&(f=d+i*(u-d)),new g([v,f,h+i*(p-h)],n)},Jt=function(e,t,i){return qt(e,t,i,"lch")};xt.lch=Jt,xt.hcl=Jt;xt.num=function(e,t,i){var n=e.num(),o=t.num();return new g(n+i*(o-n),"num")};xt.hcg=function(e,t,i){return qt(e,t,i,"hcg")};xt.hsi=function(e,t,i){return qt(e,t,i,"hsi")};xt.hsl=function(e,t,i){return qt(e,t,i,"hsl")};xt.hsv=function(e,t,i){return qt(e,t,i,"hsv")};var Wt=s.clip_rgb,jt=Math.pow,Xt=Math.sqrt,Yt=Math.PI,Zt=Math.cos,Kt=Math.sin,$t=Math.atan2,ei=function(e){for(var t=1/e.length,i=[0,0,0,0],n=0,o=e;n<o.length;n+=1){var a=o[n]._rgb;i[0]+=jt(a[0],2)*t,i[1]+=jt(a[1],2)*t,i[2]+=jt(a[2],2)*t,i[3]+=a[3]*t}return i[0]=Xt(i[0]),i[1]=Xt(i[1]),i[2]=Xt(i[2]),i[3]>.9999999&&(i[3]=1),new g(Wt(i))},ti=s.type,ii=Math.pow,ni=function(e){var t="rgb",i=f("#ccc"),n=0,o=[0,1],a=[],c=[0,0],s=!1,r=[],l=!1,d=0,u=1,h=!1,g={},p=!0,v=1,y=function(e){if((e=e||["#fff","#000"])&&"string"===ti(e)&&f.brewer&&f.brewer[e.toLowerCase()]&&(e=f.brewer[e.toLowerCase()]),"array"===ti(e)){1===e.length&&(e=[e[0],e[0]]),e=e.slice(0);for(var t=0;t<e.length;t++)e[t]=f(e[t]);a.length=0;for(var i=0;i<e.length;i++)a.push(i/(e.length-1))}return b(),r=e},m=function(e){if(null!=s){for(var t=s.length-1,i=0;i<t&&e>=s[i];)i++;return i-1}return 0},_=function(e){return e},A=function(e,n){var o,l;if(null==n&&(n=!1),isNaN(e)||null===e)return i;n?l=e:l=s&&s.length>2?m(e)/(s.length-2):u!==d?(e-d)/(u-d):1;n||(l=_(l)),1!==v&&(l=ii(l,v)),l=c[0]+l*(1-c[0]-c[1]),l=Math.min(1,Math.max(0,l));var h=Math.floor(1e4*l);if(p&&g[h])o=g[h];else{if("array"===ti(r))for(var y=0;y<a.length;y++){var A=a[y];if(l<=A){o=r[y];break}if(l>=A&&y===a.length-1){o=r[y];break}if(l>A&&l<a[y+1]){l=(l-A)/(a[y+1]-A),o=f.interpolate(r[y],r[y+1],l,t);break}}else"function"===ti(r)&&(o=r(l));p&&(g[h]=o)}return o},b=function(){return g={}};y(e);var S=function(e){var t=f(A(e));return l&&t[l]?t[l]():t};return S.classes=function(e){if(null!=e){if("array"===ti(e))s=e,o=[e[0],e[e.length-1]];else{var t=f.analyze(o);s=0===e?[t.min,t.max]:f.limits(t,"e",e)}return S}return s},S.domain=function(e){if(!arguments.length)return o;d=e[0],u=e[e.length-1],a=[];var t=r.length;if(e.length===t&&d!==u)for(var i=0,n=Array.from(e);i<n.length;i+=1){var c=n[i];a.push((c-d)/(u-d))}else for(var s=0;s<t;s++)a.push(s/(t-1));return o=[d,u],S},S.mode=function(e){return arguments.length?(t=e,b(),S):t},S.range=function(e,t){return y(e),S},S.out=function(e){return l=e,S},S.spread=function(e){return arguments.length?(n=e,S):n},S.correctLightness=function(e){return null==e&&(e=!0),h=e,b(),_=h?function(e){for(var t=A(0,!0).lab()[0],i=A(1,!0).lab()[0],n=t>i,o=A(e,!0).lab()[0],a=t+(i-t)*e,c=o-a,s=0,r=1,l=20;Math.abs(c)>.01&&l-- >0;)n&&(c*=-1),c<0?(s=e,e+=.5*(r-e)):(r=e,e+=.5*(s-e)),o=A(e,!0).lab()[0],c=o-a;return e}:function(e){return e},S},S.padding=function(e){return null!=e?("number"===ti(e)&&(e=[e,e]),c=e,S):c},S.colors=function(t,i){arguments.length<2&&(i="hex");var n=[];if(0===arguments.length)n=r.slice(0);else if(1===t)n=[S(.5)];else if(t>1){var a=o[0],c=o[1]-a;n=oi(0,t,!1).map(function(e){return S(a+e/(t-1)*c)})}else{e=[];var l=[];if(s&&s.length>2)for(var d=1,u=s.length,h=1<=u;h?d<u:d>u;h?d++:d--)l.push(.5*(s[d-1]+s[d]));else l=o;n=l.map(function(e){return S(e)})}return f[i]&&(n=n.map(function(e){return e[i]()})),n},S.cache=function(e){return null!=e?(p=e,S):p},S.gamma=function(e){return null!=e?(v=e,S):v},S.nodata=function(e){return null!=e?(i=f(e),S):i},S};function oi(e,t,i){for(var n=[],o=e<t,a=i?o?t+1:t-1:t,c=e;o?c<a:c>a;o?c++:c--)n.push(c);return n}var ai=function e(t){var i,n,o,a,c,s,r;if(2===(t=t.map(function(e){return new g(e)})).length)i=t.map(function(e){return e.lab()}),c=i[0],s=i[1],a=function(e){var t=[0,1,2].map(function(t){return c[t]+e*(s[t]-c[t])});return new g(t,"lab")};else if(3===t.length)n=t.map(function(e){return e.lab()}),c=n[0],s=n[1],r=n[2],a=function(e){var t=[0,1,2].map(function(t){return(1-e)*(1-e)*c[t]+2*(1-e)*e*s[t]+e*e*r[t]});return new g(t,"lab")};else if(4===t.length){var l;o=t.map(function(e){return e.lab()}),c=o[0],s=o[1],r=o[2],l=o[3],a=function(e){var t=[0,1,2].map(function(t){return(1-e)*(1-e)*(1-e)*c[t]+3*(1-e)*(1-e)*e*s[t]+3*(1-e)*e*e*r[t]+e*e*e*l[t]});return new g(t,"lab")}}else if(5===t.length){var d=e(t.slice(0,3)),u=e(t.slice(2,5));a=function(e){return e<.5?d(2*e):u(2*(e-.5))}}return a},ci=function e(t,i,n){if(!e[n])throw new Error("unknown blend mode "+n);return e[n](t,i)},si=function(e){return function(t,i){var n=f(i).rgb(),o=f(t).rgb();return f.rgb(e(n,o))}},ri=function(e){return function(t,i){var n=[];return n[0]=e(t[0],i[0]),n[1]=e(t[1],i[1]),n[2]=e(t[2],i[2]),n}};ci.normal=si(ri(function(e){return e})),ci.multiply=si(ri(function(e,t){return e*t/255})),ci.screen=si(ri(function(e,t){return 255*(1-(1-e/255)*(1-t/255))})),ci.overlay=si(ri(function(e,t){return t<128?2*e*t/255:255*(1-2*(1-e/255)*(1-t/255))})),ci.darken=si(ri(function(e,t){return e>t?t:e})),ci.lighten=si(ri(function(e,t){return e>t?e:t})),ci.dodge=si(ri(function(e,t){return 255===e?255:(e=t/255*255/(1-e/255))>255?255:e})),ci.burn=si(ri(function(e,t){return 255*(1-(1-t/255)/(e/255))}));for(var li=ci,di=s.type,ui=s.clip_rgb,hi=s.TWOPI,gi=Math.pow,pi=Math.sin,fi=Math.cos,vi=Math.floor,yi=Math.random,mi=Math.log,_i=Math.pow,Ai=Math.floor,bi=Math.abs,Si=function(e,t){void 0===t&&(t=null);var i={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0};return"object"===a(e)&&(e=Object.values(e)),e.forEach(function(e){t&&"object"===a(e)&&(e=e[t]),void 0===e||null===e||isNaN(e)||(i.values.push(e),i.sum+=e,e<i.min&&(i.min=e),e>i.max&&(i.max=e),i.count+=1)}),i.domain=[i.min,i.max],i.limits=function(e,t){return Di(i,e,t)},i},Di=function(e,t,i){void 0===t&&(t="equal"),void 0===i&&(i=7),"array"==a(e)&&(e=Si(e));var n=e.min,o=e.max,c=e.values.sort(function(e,t){return e-t});if(1===i)return[n,o];var s=[];if("c"===t.substr(0,1)&&(s.push(n),s.push(o)),"e"===t.substr(0,1)){s.push(n);for(var r=1;r<i;r++)s.push(n+r/i*(o-n));s.push(o)}else if("l"===t.substr(0,1)){if(n<=0)throw new Error("Logarithmic scales are only possible for values > 0");var l=Math.LOG10E*mi(n),d=Math.LOG10E*mi(o);s.push(n);for(var u=1;u<i;u++)s.push(_i(10,l+u/i*(d-l)));s.push(o)}else if("q"===t.substr(0,1)){s.push(n);for(var h=1;h<i;h++){var g=(c.length-1)*h/i,p=Ai(g);if(p===g)s.push(c[p]);else{var f=g-p;s.push(c[p]*(1-f)+c[p+1]*f)}}s.push(o)}else if("k"===t.substr(0,1)){var v,y=c.length,m=new Array(y),_=new Array(i),A=!0,b=0,S=null;(S=[]).push(n);for(var D=1;D<i;D++)S.push(n+D/i*(o-n));for(S.push(o);A;){for(var T=0;T<i;T++)_[T]=0;for(var E=0;E<y;E++)for(var P=c[E],M=Number.MAX_VALUE,N=void 0,w=0;w<i;w++){var C=bi(S[w]-P);C<M&&(M=C,N=w),_[N]++,m[E]=N}for(var I=new Array(i),B=0;B<i;B++)I[B]=null;for(var k=0;k<y;k++)null===I[v=m[k]]?I[v]=c[k]:I[v]+=c[k];for(var L=0;L<i;L++)I[L]*=1/_[L];A=!1;for(var R=0;R<i;R++)if(I[R]!==S[R]){A=!0;break}S=I,++b>200&&(A=!1)}for(var O={},F=0;F<i;F++)O[F]=[];for(var V=0;V<y;V++)O[v=m[V]].push(c[V]);for(var x=[],z=0;z<i;z++)x.push(O[z][0]),x.push(O[z][O[z].length-1]);x=x.sort(function(e,t){return e-t}),s.push(x[0]);for(var U=1;U<x.length;U+=2){var G=x[U];isNaN(G)||-1!==s.indexOf(G)||s.push(G)}}return s},Ti={analyze:Si,limits:Di},Ei=Math.sqrt,Pi=Math.atan2,Mi=Math.abs,Ni=Math.cos,wi=Math.PI,Ci={cool:function(){return ni([f.hsl(180,1,.9),f.hsl(250,.7,.4)])},hot:function(){return ni(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Ii={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Bi=0,ki=Object.keys(Ii);Bi<ki.length;Bi+=1){var Li=ki[Bi];Ii[Li.toLowerCase()]=Ii[Li]}var Ri=Ii;return f.average=function(e,t){void 0===t&&(t="lrgb");var i=e.length;if(e=e.map(function(e){return new g(e)}),"lrgb"===t)return ei(e);for(var n=e.shift(),o=n.get(t),a=[],c=0,s=0,r=0;r<o.length;r++)if(o[r]=o[r]||0,a.push(isNaN(o[r])?0:1),"h"===t.charAt(r)&&!isNaN(o[r])){var l=o[r]/180*Yt;c+=Zt(l),s+=Kt(l)}var d=n.alpha();e.forEach(function(e){var i=e.get(t);d+=e.alpha();for(var n=0;n<o.length;n++)if(!isNaN(i[n]))if(a[n]++,"h"===t.charAt(n)){var r=i[n]/180*Yt;c+=Zt(r),s+=Kt(r)}else o[n]+=i[n]});for(var u=0;u<o.length;u++)if("h"===t.charAt(u)){for(var h=$t(s/a[u],c/a[u])/Yt*180;h<0;)h+=360;for(;h>=360;)h-=360;o[u]=h}else o[u]=o[u]/a[u];return d/=i,new g(o,t).alpha(d>.99999?1:d,!0)},f.bezier=function(e){var t=ai(e);return t.scale=function(){return ni(t)},t},f.blend=li,f.cubehelix=function(e,t,i,n,o){void 0===e&&(e=300),void 0===t&&(t=-1.5),void 0===i&&(i=1),void 0===n&&(n=1),void 0===o&&(o=[0,1]);var a,c=0;"array"===di(o)?a=o[1]-o[0]:(a=0,o=[o,o]);var s=function(s){var r=hi*((e+120)/360+t*s),l=gi(o[0]+a*s,n),d=(0!==c?i[0]+s*c:i)*l*(1-l)/2,u=fi(r),h=pi(r);return f(ui([255*(l+d*(-.14861*u+1.78277*h)),255*(l+d*(-.29227*u-.90649*h)),255*(l+d*(1.97294*u)),1]))};return s.start=function(t){return null==t?e:(e=t,s)},s.rotations=function(e){return null==e?t:(t=e,s)},s.gamma=function(e){return null==e?n:(n=e,s)},s.hue=function(e){return null==e?i:("array"===di(i=e)?0==(c=i[1]-i[0])&&(i=i[1]):c=0,s)},s.lightness=function(e){return null==e?o:("array"===di(e)?(o=e,a=e[1]-e[0]):(o=[e,e],a=0),s)},s.scale=function(){return f.scale(s)},s.hue(i),s},f.mix=f.interpolate=Ut,f.random=function(){for(var e="#",t=0;t<6;t++)e+="0123456789abcdef".charAt(vi(16*yi()));return new g(e,"hex")},f.scale=ni,f.analyze=Ti.analyze,f.contrast=function(e,t){e=new g(e),t=new g(t);var i=e.luminance(),n=t.luminance();return i>n?(i+.05)/(n+.05):(n+.05)/(i+.05)},f.deltaE=function(e,t,i,n){void 0===i&&(i=1),void 0===n&&(n=1),e=new g(e),t=new g(t);for(var o=Array.from(e.lab()),a=o[0],c=o[1],s=o[2],r=Array.from(t.lab()),l=r[0],d=r[1],u=r[2],h=Ei(c*c+s*s),p=Ei(d*d+u*u),f=a<16?.511:.040975*a/(1+.01765*a),v=.0638*h/(1+.0131*h)+.638,y=h<1e-6?0:180*Pi(s,c)/wi;y<0;)y+=360;for(;y>=360;)y-=360;var m=y>=164&&y<=345?.56+Mi(.2*Ni(wi*(y+168)/180)):.36+Mi(.4*Ni(wi*(y+35)/180)),_=h*h*h*h,A=Ei(_/(_+1900)),b=v*(A*m+1-A),S=h-p,D=c-d,T=s-u,E=(a-l)/(i*f),P=S/(n*v);return Ei(E*E+P*P+(D*D+T*T-S*S)/(b*b))},f.distance=function(e,t,i){void 0===i&&(i="lab"),e=new g(e),t=new g(t);var n=e.get(i),o=t.get(i),a=0;for(var c in n){var s=(n[c]||0)-(o[c]||0);a+=s*s}return Math.sqrt(a)},f.limits=Ti.limits,f.valid=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];try{return new(Function.prototype.bind.apply(g,[null].concat(e))),!0}catch(e){return!1}},f.scales=Ci,f.colors=_t,f.brewer=Ri,f}),cc._RF.pop()},{}],renderer:[function(e,t,i){"use strict";cc._RF.push(t,"60e1bRJiI1Iy5bWPuv1WRnJ","renderer"),cc._RF.pop()},{}],switchBtn:[function(e,t,i){"use strict";cc._RF.push(t,"27a0ayLTNhNwpbw6X7V/lk4","switchBtn"),cc.Class({extends:cc.Component,properties:{enabledBg:cc.Node,disabledBg:cc.Node,handNode:cc.Node,open:!1,switchCallBack:null},onLoad:function(){var e=this;this._updateState(),this.node.on(cc.Node.EventType.TOUCH_START,function(){e.setOpenState(!e.open)})},setOpenState:function(e){e!==this.open&&(this.open=e,this._updateState(),this._updateHand(),this.switchCallBack&&this.switchCallBack(this.open))},_updateState:function(){this.enabledBg.active=this.open,this.disabledBg.active=!this.open;var e=this._getHandPos();this.handNode.stopAllActions(),this.open?this.handNode.setPosition(e.p2):this.handNode.setPosition(e.p1)},_updateHand:function(){var e=this._getHandPos();this.open?this._handMove(e.p1,e.p2):this._handMove(e.p2,e.p1)},_handMove:function(e,t){this.handNode.setPosition(e);var i=cc.moveTo(.3,t).easing(cc.easeOut(3));this.handNode.stopAllActions(),this.handNode.runAction(i)},_getHandPos:function(){return{p1:cc.v2(-23,0),p2:cc.v2(23,0)}},start:function(){}}),cc._RF.pop()},{}],"transition-materials":[function(e,t,i){"use strict";cc._RF.push(t,"f0ae4vfa41KnqZDrdPXlP7n","transition-materials"),Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n={};cc.game.on(cc.game.EVENT_GAME_INITED,function(){cc.loader.loadResDir("transitions",cc.Material,function(e,t){if(e)cc.error(e);else{n.length=0;for(var i=0;i<t.length;i++){var o=t[i];n[o.name]?cc.warn("has ".concat(o.name," material")):n[o.name]=o}cc.log(n)}})});var o=n;i.default=o,t.exports=i.default,cc._RF.pop()},{}],"transitions-inspector":[function(e,t,i){"use strict";cc._RF.push(t,"71a0bxK615KUpG3F4y4AWg7","transitions-inspector"),cc._RF.pop()},{}],transitionsTest:[function(e,t,i){"use strict";cc._RF.push(t,"06eacSUpadPmoACU9P4RGkr","transitionsTest"),cc._RF.pop()},{PieceShader:"PieceShader",transitions:"transitions"}],transitions:[function(e,t,i){"use strict";cc._RF.push(t,"24cfdwVNiRAr45L2SE+u3Ib","transitions");var n=null;"undefined"!=typeof AVG_EDITOR?n=null:"undefined"!=typeof Editor&&(n=Editor.url(" db://assets/resources/transitions/editor/transitions-inspector.js"));cc.Class({extends:cc.Component,editor:{inspector:n},properties:{_material:{default:null,type:cc.Material},material:{get:function(){return this._material},set:function(e){this._material=e,this.updateSpriteMaterial()},type:cc.Material,readonly:!0},transitionTime:1},onLoad:function(){cc.game.addPersistRootNode(this.node)},init:function(){if(!this._inited){this._inited=!0,this.time=0,this._texture1=this.createTexture(),this._texture2=this.createTexture();var e=cc.find("TRANSITION_SPRITE",this.node);e?this._sprite=e.getComponent(cc.Sprite):(e=new cc.Node("TRANSITION_SPRITE"),this._sprite=e.addComponent(cc.Sprite),e.parent=this.node);var t=new cc.SpriteFrame;t.setTexture(this._texture1),this._sprite.spriteFrame=t;var i=cc.view.getDesignResolutionSize();e.setContentSize(i),e.active=!1,e.scaleY=-1,this._spriteNode=e;var n=cc.find("TRANSITION_CAMERA",this.node);n?this._camera=n.getComponent(cc.Camera):(n=new cc.Node("TRANSITION_CAMERA"),this._camera=n.addComponent(cc.Camera),n.parent=this.node),n.active=!1,this._cameraNode=n,this.node.groupIndex=cc.Node.BuiltinGroupIndex.DEBUG-1,this._camera.cullingMask=1<<this.node.groupIndex,this.updateSpriteMaterial()}},updateSpriteMaterial:function(){if(this._sprite){var e=cc.MaterialVariant.create(this._material);e.setProperty("texture2",this._texture2),e.setProperty("ratio",this._texture2.width/this._texture2.height),this._sprite.setMaterial(0,e),this._spriteMaterial=e}},createTexture:function(){var e=new cc.RenderTexture,t=cc.view.getDesignResolutionSize();return e.initWithSize(t.width,t.height,cc.gfx.RB_FMT_D24S8),e},_loadScene:function(e,t,i,n,o){var a=this;this.init(),this._spriteNode.active=!0,this._cameraNode.active=!0;var c=cc.find(t);if(c=c&&c.getComponent(cc.Camera)){var s=c.targetTexture;return c.cullingMask&=~this._camera.cullingMask,c.targetTexture=this._texture1,c.render(cc.director.getScene()),c.targetTexture=s,cc.director.loadScene(e,function(){n&&n();var e=cc.find(i);if(e=e&&e.getComponent(cc.Camera)){e.cullingMask&=~a._camera.cullingMask;var t=e.targetTexture;e.targetTexture=a._texture2,e.render(cc.director.getScene()),a._camera.depth=e.depth,a._camera.clearFlags=e.clearFlags,a._onLoadFinished=function(){e.targetTexture=t,a._spriteNode.active=!1,a._cameraNode.active=!1,o&&o()},a.time=0,a.loading=!0}else cc.warn("Can not find toCamera with path ".concat(i))})}cc.warn("Can not find fromCamera with path ".concat(t))},loadScene:function(e,t,i,n){var o=this;return this.scheduleOnce(function(){cc.director.preloadScene(e,null,function(){o._loadScene(e,t,i,n)})}),!0},loadNode:function(e,t,i,n,o){var a=this;if(this.init(),this._spriteNode.active=!0,this._cameraNode.active=!0,e=e&&e.getComponent(cc.Camera)){var c=e.targetTexture;if(e.cullingMask&=~this._camera.cullingMask,e.targetTexture=this._texture1,e.node.active=!0,t.active=!0,e.render(t),t.active=!1,e.node.active=!1,e.targetTexture=c,i=i&&i.getComponent(cc.Camera)){i.cullingMask&=~this._camera.cullingMask;var s=i.targetTexture;i.node.active=!0,i.targetTexture=this._texture2,n.active=!0,i.render(n),n.active=!1,i.node.active=!1,this._camera.depth=i.depth,this._camera.clearFlags=i.clearFlags,this._onLoadFinished=function(){n.active=!0,i.node.active=!0,i.targetTexture=s,a._spriteNode.active=!1,a._cameraNode.active=!1,o&&o()},this.time=0,this.loading=!0,this._spriteMaterial.setProperty("time",0)}else cc.warn("Can not find toCamera with path ".concat(toCameraPath))}else cc.warn("Can not find fromCamera with path ".concat(fromCameraPath))},update:function(e){this.loading&&(this.time+=e,this.time>=this.transitionTime&&(this.time=this.transitionTime,this.loading=!1,this._onLoadFinished&&this._onLoadFinished(),this._onLoadFinished=null),this._spriteMaterial.setProperty("time",this.time/this.transitionTime))}});cc._RF.pop()},{}],"use_v2.1-2.2.1_cc.Toggle_event":[function(e,t,i){"use strict";cc._RF.push(t,"deb03+7RXJOfbweOms6HDvq","use_v2.1-2.2.1_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_isChecked=!0),cc._RF.pop()},{}]},{},["AvgMsg","AVGPrefabPreload","AvgBag","AvgNodeRender","AvgPlayer","AvgUI","ElementBase","ElementPlotMenu","GameDB","Account","Archive","LocalServe","Project","ValueMerge","Animation","Assets","AudioMgr","AudioUtil","AvgEnv","GameData","GameUtil","LocalStorage","Observer","ObserverMgr","StoryPieceAniMgr","StoryPlotSkipMgr","ElementEvent","EventExecute","GoodsEvent","ValueDebugTool","ValueJudgeCalcTool","ValueJudgeEvent","ValueMgr","renderer","use_v2.1-2.2.1_cc.Toggle_event","Loading","BagGetItems","BagItem","BagItemDetails","BagItemList","GoodsItem","BagItemDisplayImages","BagItemDisplayVideo","DisplayImageSize","AudioDanceBtn","BagItemDisplayAudio","DanceLine","CalcTips","CalcTipsEditor","TipsItem","PasswordLock","PasswordLockBox","PasswordLockDisplay","PasswordLockDisplayLight","PasswordLockDisplayNum","PasswordLockEvent","PasswordLockKeyBoard","MessageItem","PhoneIM","ArrowNode","QTE","QTECircleProgressDot","QTEEvent","QTENode","QTEPieceMgr","QTEProgress","chroma","MousePointer","QuickInsert","QuickInsertNode","SetButton","SetPanel","switchBtn","transitions-inspector","transition-materials","transitions","AvgBackground","GameFullScreen","PieceNextPreload","PieceShader","PieceTransition","PieceUtil","PlatformVar","StoryBagUI","StoryGame","ShieldStoryAnyTouch","UiEnv","UiFileItem","AvgServer","ParticleCtrl","StoryAudioMgr","StoryBag","StoryMenu","StoryMenuItem","StoryPiece","StoryPieceResLoader","StoryPieceUtil","StoryTalk","AvgGoods","StoryAnimations","StoryConfig","StoryData","StoryEvents","StoryTimelines","ActionSpeed","AudioPlayTest","BagScene","ChildrenPosReset","EffectTest","PieceTransitionTest","QTETest","SetNodeTest","TalkSpeedTool","TestFit","TestPrefab","transitionsTest","BeginMask","EndMask","MaskBeganGroup","MoviePlayer","VideoDebugButton","VideoDebugLayer","VideoDebugTool","VideoElement","VideoGroup","VideoGroupInit","VideoGroupQuickTestTool","VideoLogic","VideoTestScene","VideoTestScene2","VideoUtil"]);